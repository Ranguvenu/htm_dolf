/**
 * Add a create new group modal to the page.
 *
 * @module     local_hall/reserve
 * @class      NewCourse
 * @package    local_hall
 * @copyright  2022 Revanth kumar Grandhi
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_hall/hallreserve",["local_trainingprogram/dynamicform","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates"],(function(TPDynamicForm,$,Str,ModalFactory,ModalEvents,Fragment,Ajax,Y,Templates){var NewCategory=function(selector,contextid,categoryid,hallid,typeid,type){let startdate=arguments.length>6&&void 0!==arguments[6]&&arguments[6],enddate=arguments.length>7&&void 0!==arguments[7]&&arguments[7],duration=arguments.length>8&&void 0!==arguments[8]&&arguments[8],entitiesseats=arguments.length>9&&void 0!==arguments[9]&&arguments[9],hallseats=arguments.length>10&&void 0!==arguments[10]&&arguments[10],entityname=arguments.length>11&&void 0!==arguments[11]&&arguments[11],entityid=arguments.length>12&&void 0!==arguments[12]&&arguments[12],starttime=arguments.length>13&&void 0!==arguments[13]&&arguments[13],reservationid=arguments.length>14&&void 0!==arguments[14]&&arguments[14],submit_type=arguments.length>15&&void 0!==arguments[15]&&arguments[15];this.contextid=contextid,this.categoryid=categoryid,this.hallid=hallid,this.typeid=typeid,this.type=type,this.startdate=startdate,this.enddate=enddate,this.duration=duration,this.entitiesseats=entitiesseats,this.hallseats=hallseats,this.entityname=entityname,this.entityid=entityid,this.starttime=starttime,this.reservationid=reservationid,this.submit_type=submit_type;var self=this;self.init(selector,entitiesseats,hallseats,entityname)};return NewCategory.prototype.modal=null,NewCategory.prototype.contextid=-1,NewCategory.prototype.init=function(selector,entitiesseats,hallseats,entityname){var self=this;if(self.categoryid)var head=Str.get_string("reservation","local_hall");else head=Str.get_string("reservation","local_hall");var data={};if(data.entityname=entityname,data.entityseats=entitiesseats,data.hallseats=hallseats,"Current Offering"==entityname)var showing=Str.get_string("currentoffering","local_hall",data);else if("Current Event"==entityname)showing=Str.get_string("currentevent","local_hall",data);else if("Current Questionbank"==entityname)showing=Str.get_string("currentquestionbank","local_hall",data);else{data.entityname=entityname;showing=Str.get_string("entityshowing","local_hall",data)}showing.done((function(html,js){return head.then(function(title){return ModalFactory.create({title:html,body:self.getBody()})}.bind(self)).then(function(modal){return self.modal=modal,self.modal.show(),$("#city").on("change",(function(e){$("#buildingname").prop("selected",!1),$("#buildingname").parent().find(".badge-info").html(""),$("#id_halls option:selected").prop("selected",!1),$("#id_halls").parent().find(".badge-info").html("");var city=$(this).text();city=JSON.stringify(city),$(this).closest("form").find("select[name='halls']").data("city",city)})),$("select[name='buildingname']").on("change",(function(e){$("#id_halls option:selected").prop("selected",!1),$("#id_halls").parent().find(".badge-info").html("");var building=$("#buildingname option:selected").text();building=JSON.stringify(building),$(this).closest("form").find("select[name='halls']").data("buildingname",building)})),$("#id_halls").on("change",(function(e){$(".selecthall").html(""),$(".entityhall .badge-info").html(""),$(".entityhall .badge-info").html($("#id_halls option:selected").text()),$("select[name='halladdress']").val($("#id_halls option:selected").val());var params={};params.sessionkey=$("input[name='sesskey']").val(),params.type=$("select[name='halladdress']").data("type"),Ajax.call([{methodname:"remove_reservations",args:params}])[0].done((function(resp){$(".entityhalldetails").html(""),console.log("Successfully reservations removed")})).fail((function(){console.log("exception")}))})),$("#id_moduledates").on("change",(function(){$(".selecthall").html("")})),self.modal.setLarge(),self.modal.getRoot().addClass("reservationhallmodal"),self.modal.getRoot().find(".modal-dialog").addClass("modal-xl"),self.modal.getRoot().on(ModalEvents.hidden,function(){self.modal.setBody(""),self.modal.getRoot().animate({right:"-85%"},500),setTimeout((function(){modal.destroy()}),1e3)}.bind(this)),self.modal.getRoot().on(ModalEvents.shown,function(){self.modal.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>")}.bind(this)),self.modal.getRoot().on(ModalEvents.save,self.submitForm.bind(self)),self.modal.getRoot().on("submit","form",self.submitFormAjax.bind(self)),self.modal.getRoot().animate({right:"0%"},500),self.modal.getRoot().on(ModalEvents.bodyRendered,(e=>{$("#city").on("change",(function(e){$("#buildingname").prop("selected",!1),$("#buildingname").parent().find(".badge-info").html(""),$("#id_halls option:selected").prop("selected",!1),$("#id_halls").parent().find(".badge-info").html("");var city=$(this).text();city=JSON.stringify(city),$(this).closest("form").find("select[name='halls']").data("city",city)})),$("select[name='buildingname']").on("change",(function(e){$("#id_halls option:selected").prop("selected",!1),$("#id_halls").parent().find(".badge-info").html("");var building=$("#buildingname option:selected").text();building=JSON.stringify(building),$(this).closest("form").find("select[name='halls']").data("buildingname",building)})),$("#id_halls").on("change",(function(e){$(".selecthall").html(""),$(".entityhall .badge-info").html(""),$(".entityhall .badge-info").html($("#id_halls option:selected").text()),$("select[name='halladdress']").val($("#id_halls option:selected").val());var params={};params.sessionkey=$("input[name='sesskey']").val(),params.type=$("select[name='halladdress']").data("type"),Ajax.call([{methodname:"remove_reservations",args:params}])[0].done((function(resp){$(".entityhalldetails").html(""),console.log("Successfully reservations removed")})).fail((function(){console.log("exception")}))})),$("#id_moduledates").on("change",(function(){$(".selecthall").html("")}))})),this.modal}.bind(this))}))},NewCategory.prototype.getBody=function(formdata){return void 0===formdata&&(formdata={}),params={},params.jsonformdata=JSON.stringify(formdata),params.categoryid=this.categoryid,params.hallid=this.hallid,params.typeid=this.typeid,params.type=this.type,params.startdate=this.startdate,params.enddate=this.enddate,params.duration=this.duration,params.entitiesseats=this.entitiesseats,params.entityid=this.entityid,params.starttime=this.starttime,params.reservationid=this.reservationid,params.submit_type=this.submit_type,Fragment.loadFragment("local_hall","listofhallsform",this.contextid,params)},NewCategory.prototype.handleFormSubmissionResponse=function(formData){},NewCategory.prototype.handleFormSubmissionFailure=function(data){this.modal.setBody(this.getBody(data))},NewCategory.prototype.submitFormAjax=function(e){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize();Ajax.call([{methodname:"local_hall_reservation",args:{contextid:this.contextid,jsonformdata:JSON.stringify(formData)},done:this.handleFormSubmissionResponse.bind(this,formData),fail:this.handleFormSubmissionFailure.bind(this,formData)}])},NewCategory.prototype.submitForm=function(e){e.preventDefault();this.modal.getRoot().find("form").submit()},{init:function(args){return new NewCategory(args.selector,args.contextid,args.categoryid,args.hallid,args.typeid,args.type,0,0,0,args.entitytotalseats,args.hallseats,args.entityname,args.typeid,args.starttime,args.hallreservationid)},load:function(){},reservation:function(type){if("tprogram"==type){var hallid=$("select[name='halladdress']").val();var starttime=3600*(starthours=$("select[name='starttime[hours]']").val())+60*(startminutes=$("select[name='starttime[minutes]']").val()),typeid=0;var duration=3600*$("select[name='endtime[hours]']").val()+60*$("select[name='endtime[minutes]']").val()-starttime,entitiesseats=$("input[name='availableseats']").val(),entityname="Current Offering",entityid=$("input[name='trainingid']").val(),contextid=$("input[name='contextid']").val(),submit_type=$("input[name='submit_type']").val()}else if("questionbank"==type){hallid=$("select[name='halladdress']").val(),$("select[name='halladdress']").data("id");var starthours=$("select[name='starttime[hours]']").val(),startminutes=$("select[name='starttime[minutes]']").val();typeid=$("input[name='id']").val(),submit_type=$("input[name='submit_type']").val();(""==typeid||typeid<0)&&(typeid=0);duration=$("input[name='duration[number]']").val(),entityname="Current Questionbank",entityid=0,entitiesseats=0,contextid=$("input[name='contextid']").val()}else{type="event",hallid=$("select[name='halladdress']").val(),starthours=$("select[name='eventslothour']").val(),startminutes=$("select[name='eventslotmin']").val(),typeid=$("input[name='id']").val(),submit_type=$("input[name='submit_type']").val();""==typeid&&(typeid=0);duration=$("input[name='eventduration[number]']").val(),entityname="Current Event",entityid=0,entitiesseats=0,contextid=$("input[name='contextid']").val()}var params={};params.sessionkey=$("input[name='sesskey']").val(),params.halls=hallid,params.type=type,Ajax.call([{methodname:"remove_reservations",args:params}])[0].done((function(resp){$(".entityhalldetails").html(""),console.log("Successfully reservations removed")})).fail((function(){console.log("exception")}));starttime=3600*starthours+60*startminutes;var city=$("#city option:selected").val();""==city&&(city=0);var buildingname=$("#buildingname option:selected").val();if(""==buildingname&&(buildingname=0),hallid>0){(params={}).hallid=hallid,params.entitiesseats=entitiesseats,params.type=type;var hallseats=Fragment.loadFragment("local_hall","hallseats",contextid,params),hallseatscount="";hallseats.done((function(html,js){response=JSON.parse(html),hallseatscount=response.hallseats,entitiesseats=response.entitiesseats;var startdate=$("select[name='startdate[year]']").val()+"-"+$("select[name='startdate[month]']").val()+"-"+$("select[name='startdate[day]']").val();if("questionbank"==type)var enddate=$("select[name='startdate[year]']").val()+"-"+$("select[name='startdate[month]']").val()+"-"+$("select[name='startdate[day]']").val();else enddate=$("select[name='enddate[year]']").val()+"-"+$("select[name='enddate[month]']").val()+"-"+$("select[name='enddate[day]']").val();return new NewCategory("reservationmodal",contextid,0,hallid,typeid,type,startdate,enddate,duration,entitiesseats,hallseatscount,entityname,entityid,starttime,0,submit_type)}))}else alert("Please select proper Hall")}}}));

//# sourceMappingURL=hallreserve.min.js.map