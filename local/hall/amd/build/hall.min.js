define("local_hall/hall",["exports","local_trainingprogram/dynamicform","core_form/modalform","core/modal_factory","core/modal_events","theme_academy/homepage","core/fragment","core/ajax","core/templates","core/str","jquery"],(function(_exports,_dynamicform,_modalform,_modal_factory,_modal_events,_homepage,_fragment,_ajax,_templates,_str,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_homepage=_interopRequireDefault(_homepage),_fragment=_interopRequireDefault(_fragment),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery);const Selectors_actions={editCategory:'[data-action="edithall"]',deletehall:'[data-action="deletehall"]',viewhall:'[data-action="viewhall"]',hallreserve:'[data-action="hallreserve"]',hallbtn:'[data-action="hallbtn"]',createhallchedule:'[data-action="createhallchedule"]',deleteschedulehall:'[data-action="deleteschedulehall"]',hallcodes:'[data-action="hallcodes"]'};let HomePage=new _homepage.default;_exports.init=()=>{document.addEventListener("click",(function(e){let element=e.target.closest(Selectors_actions.editCategory);if(element){e.preventDefault();const title=element.getAttribute("data-id")?(0,_str.get_string)("edithall","local_hall",element.getAttribute("data-name")):(0,_str.get_string)("createhall","local_hall"),form=new _dynamicform.default({formClass:"local_hall\\form\\hallform",args:{id:element.getAttribute("data-id"),halllocation:element.getAttribute("data-halllocation"),type:element.getAttribute("data-type")},modalConfig:{title:title},returnFocus:element});form.addEventListener(form.events.FORM_SUBMITTED,(e=>{document.getElementsByName("_qf__local_trainingprogram_form_schedule")?this.modal.destroy():window.location.reload(!0)})),form.show()}let scheduleelement=e.target.closest(Selectors_actions.createhallchedule);if(scheduleelement){e.preventDefault();const title=scheduleelement.getAttribute("data-id")?(0,_str.get_string)("edithallschedule","local_hall",scheduleelement.getAttribute("data-name")):(0,_str.get_string)("createhallschedule","local_hall"),form=new _dynamicform.default({formClass:"local_hall\\form\\schedulehallform",args:{id:scheduleelement.getAttribute("data-id"),hallid:scheduleelement.getAttribute("data-hallid")},modalConfig:{title:title},returnFocus:scheduleelement});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{if(event.detail){var type=event.detail.type,typeid=event.detail.typeid,errors=event.detail.errors;window.location=M.cfg.wwwroot+"/local/hall/schedulenotices.php?type="+type+"&typeid="+typeid+"&errors="+errors}else window.location.reload()})),form.show()}let hallelement=e.target.closest(Selectors_actions.deletehall);if(hallelement){const hallid=hallelement.getAttribute("data-id");_modal_factory.default.create({title:(0,_str.get_string)("deletehall","local_hall"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deleteallconfirm","local_hall")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("delete","local_hall")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.hallid=hallid,_ajax.default.call([{methodname:"local_deletehall",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}let deleteschedulehall=e.target.closest(Selectors_actions.deleteschedulehall);if(deleteschedulehall){const id=deleteschedulehall.getAttribute("data-id");_modal_factory.default.create({title:(0,_str.get_string)("deleteschedule","local_hall"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deletescheduleconfirm","local_hall")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("deleteschedule","local_hall")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.id=id,_ajax.default.call([{methodname:"local_deleteschedulehall",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}let viewhall=e.target.closest(Selectors_actions.viewhall);if(viewhall){const hallid=viewhall.getAttribute("data-id");(params={}).hallid=hallid,_ajax.default.call([{methodname:"local_hall_info",args:params}])[0].done((function(resp){_modal_factory.default.create({title:(0,_str.get_string)("viewhall","local_hall"),body:resp.options}).done(function(modal){this.modal=modal,modal.show(),modal.setLarge()}.bind(this))})).fail((function(){console.log("exception")}))}let hallreserve=e.target.closest(Selectors_actions.hallreserve);if(hallreserve){var params;e.preventDefault(),(params={}).hallid=hallreserve.getAttribute("data-hallid"),slid=hallreserve.getAttribute("data-slid"),params.typeid=hallreserve.getAttribute("data-typeid"),params.examdate=hallreserve.getAttribute("data-examdate"),params.start=hallreserve.getAttribute("data-start"),params.end=hallreserve.getAttribute("data-end"),params.type=hallreserve.getAttribute("data-type"),params.seats=(0,_jquery.default)(".selectedseats"+slid).val(),available=hallreserve.getAttribute("data-available"),entitiesseats=hallreserve.getAttribute("data-entitiesseats"),params.entityid=hallreserve.getAttribute("data-entityid"),params.reservationid=hallreserve.getAttribute("data-reservationid"),params.submit_type=hallreserve.getAttribute("data-submit_type"),""==params.entityid&&(params.entityid=params.typeid),params.referencecode=(0,_jquery.default)("input[name='sesskey']").val();var data={};data.available=available,data.entitiesseats=entitiesseats,isNaN(params.seats)?HomePage.confirmbox((0,_str.get_string)("seatsshouldbenumaric","local_hall")):+params.seats<0?HomePage.confirmbox((0,_str.get_string)("seatscannotbenegative","local_hall")):0==+params.seats?HomePage.confirmbox((0,_str.get_string)("seatscannotbezero","local_hall")):+available<+params.seats?HomePage.confirmbox((0,_str.get_string)("hallavailableseats","local_hall",data)):""==params.seats?HomePage.confirmbox((0,_str.get_string)("selectseats","local_hall")):+entitiesseats<+params.seats&&"event"!=params.type?HomePage.confirmbox((0,_str.get_string)("entityseats","local_hall",data)):_modal_factory.default.create({title:(0,_str.get_string)("confirm","local_hall"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("selectedseats","local_hall",params.seats)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("reserve","local_hall")),modal.getRoot().on(_modal_events.default.save,function(e){modal.hide();var options={};options.hallid=params.hallid,options.typeid=params.typeid,options.type=params.type,options.examdate=params.examdate,options.starttime=params.start,options.duration=(0,_jquery.default)(".duration").val(),""==options.duration&&(options.duration=0);var city=(0,_jquery.default)("#city option:selected").val();""==city&&(city=0);var buildingname=(0,_jquery.default)("#buildingname option:selected").val();""==buildingname&&(buildingname=0),""==(entitiesseats=(0,_jquery.default)(".entitiesseats").val())&&(entitiesseats=0),options.city=city,options.buildingname=buildingname,options.entitiesseats=entitiesseats,options.entityid=params.entityid,options.referencecode=params.referencecode,options.reservationid=params.reservationid,options.submit_type=params.submit_type,options.temp="hallreservation",options.methodName="local_hall_data",e.preventDefault(),_ajax.default.call([{methodname:"hall_slotbooking",args:params}])[0].done((function(resp){HomePage.confirmbox((0,_str.get_string)("reservationsuccess","local_hall")),_templates.default.render("local_hall/testing",options).done((function(html,js){(0,_jquery.default)(".selecthall").html("")})),modal.hide(),(0,_jquery.default)("#hallinformation").css("display","block"),(0,_jquery.default)(".entityhalldetails").html("<tr><td>"+resp.name+"</td><td>"+resp.examdate+"</td><td>"+resp.seats+"</td></tr>")})).fail((function(){console.log("hallexception")}))}.bind(this)),modal.show()}.bind(this))}if(e.target.closest(Selectors_actions.hallbtn)){var typeid=(0,_jquery.default)(".typeid").val(),type=(0,_jquery.default)(".type").val(),duration=(0,_jquery.default)(".duration").val(),entityid=(0,_jquery.default)(".entityid").val(),starttime=(0,_jquery.default)(".starttime").val(),reservationid=(0,_jquery.default)(".reservationid").val(),submit_type=(0,_jquery.default)("input[name='submit_type']").val(),contextid=(0,_jquery.default)(".contextid").val();""==duration&&(duration=0);var city=(0,_jquery.default)("#city option:selected").val();""==city&&(city=0);var buildingname=(0,_jquery.default)("#buildingname option:selected").val();""==buildingname&&(buildingname=0);var entitiesseats=(0,_jquery.default)(".entitiesseats").val();""==entitiesseats&&(entitiesseats=0);var hallid=(0,_jquery.default)("#id_halls option:selected").val(),moduledates=(0,_jquery.default)("select[name='moduledates']").val(),options={};options.hallid=hallid,options.examdate=moduledates,options.typeid=typeid,options.type=type,options.duration=duration,options.city=city,options.buildingname=buildingname,options.entitiesseats=entitiesseats,options.entityid=entityid,options.starttime=starttime,options.reservationid=reservationid,options.submit_type=submit_type,options.referencecode=(0,_jquery.default)("input[name='sesskey']").val(),options.temp="hallreservation",options.methodName="local_hall_data",_fragment.default.loadFragment("local_hall","hallvalidations",contextid,options).done((function(html,js){if(response=JSON.parse(html),hallseatscount=response.hallseats,hallstarttime=response.hallstarttime,hallendtime=response.hallendtime,entityduration=response.entityduration,entityendtime=+options.starttime+ +entityduration,hallseatscount.halls&&hallseatscount.moduledates)(0,_jquery.default)(".selecthall").html(""),HomePage.confirmbox((0,_str.get_string)("reservationrequirements","local_hall"));else if(hallseatscount.halls)(0,_jquery.default)(".selecthall").html(""),HomePage.confirmbox((0,_str.get_string)("selecthallforreservation","local_hall"));else if(hallseatscount.moduledates)(0,_jquery.default)(".selecthall").html(""),HomePage.confirmbox((0,_str.get_string)("selectdateforreservation","local_hall"));else if(+options.starttime<+hallstarttime||+entityendtime>+hallendtime){var hallstart=new Date(1e3*hallstarttime).toISOString().substring(11,16),hallend=new Date(1e3*hallendtime).toISOString().substring(11,16),data={};data.hallstart=hallstart,data.hallend=hallend,HomePage.confirmbox((0,_str.get_string)("hallentitytimenotmatch","local_hall",data))}else{(0,_jquery.default)(".halldatemandatory").html(""),_templates.default.render("local_hall/testing",options).done((function(html,js){(0,_jquery.default)(".selecthall").html(html)}));setTimeout(myGreeting,2e3);function myGreeting(){(0,_jquery.default)(".selectedseats0").attr("size",4),(0,_jquery.default)(".selectedseats0").prop("readonly",!1)}}}))}let hallcodes=e.target.closest(Selectors_actions.hallcodes);if(hallcodes){e.preventDefault();const title=(0,_str.get_string)("hallcodes","local_hall"),form=new _dynamicform.default({formClass:"local_hall\\form\\hallcodes",args:{id:hallcodes.getAttribute("data-id")},modalConfig:{title:title},returnFocus:hallcodes});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}}))}}));

//# sourceMappingURL=hall.min.js.map