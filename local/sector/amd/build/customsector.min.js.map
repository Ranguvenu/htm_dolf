{"version":3,"file":"customsector.min.js","sources":["../src/customsector.js"],"sourcesContent":["    // This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\nimport TPDynamicForm from 'local_trainingprogram/dynamicform';\nimport ModalForm from 'core_form/modalform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport homepage from 'theme_academy/homepage';\nimport {get_string as getString} from 'core/str';\n\nconst Selectors = {\n    actions: {\n        createSectors: '[data-action=\"createsector\"]',\n        createSegment: '[data-action=\"createsegment\"]',\n        createjobfamily: '[data-action=\"createjobfamily\"]',\n        deletesector: '[data-action=\"deletesector\"]',\n        deletesegment: '[data-action=\"deletesegment\"]',\n        deletejobfamily: '[data-action=\"deletejobfamily\"]',\n    },\n};\nlet HomePage = new homepage();\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        let element = e.target.closest(Selectors.actions.createSectors);\n        e.stopImmediatePropagation();\n        if (element) {\n            e.preventDefault();\n            const title = element.getAttribute('data-id') ?\n                getString('edit_sector', 'local_sector', element.getAttribute('data-name')) :\n                getString('add_sector', 'local_sector');\n            const form = new ModalForm({\n                formClass: 'local_sector\\\\form\\\\customsector',\n                args: {id: element.getAttribute('data-id')},\n                modalConfig: {title},\n                returnFocus: element,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        element = e.target.closest(Selectors.actions.createSegment);\n        if (element) {\n            e.preventDefault();\n            const title = element.getAttribute('data-id') ?\n                getString('edit_segment', 'local_sector', element.getAttribute('data-name')) :\n                getString('add_segmentname', 'local_sector', element.getAttribute('data-sectorname'));\n            const form = new ModalForm({\n                formClass: 'local_sector\\\\form\\\\customsegment',\n                args: {id: element.getAttribute('data-id'),sectorid: element.getAttribute('data-sectorid')},\n                modalConfig: {title},\n                returnFocus: element,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        element = e.target.closest(Selectors.actions.createjobfamily);\n        if (element) {\n            e.preventDefault();\n            var shared=0;\n        \n            if(element.getAttribute('data-shared')){\n                shared = 1;\n           \n            } \n            const title = element.getAttribute('data-id') ?\n            getString('edit_jobfamily', 'local_sector') :(element.getAttribute('data-shared') ? getString('add_jobfamilyname', 'local_sector'): \n            getString('add_jobname', 'local_sector',element.getAttribute('data-jobname')));\n        \n            const form = new TPDynamicForm({\n                formClass: 'local_sector\\\\form\\\\customjobfamily',\n                args: {id: element.getAttribute('data-id'),segmentid: element.getAttribute('data-segmentid'), shared: shared},\n                modalConfig: {title},\n                returnFocus: element,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        sectorelement = e.target.closest(Selectors.actions.deletesector);\n        if (sectorelement) {\n            const sectorid = sectorelement.getAttribute('data-id');\n            const candeletesector = sectorelement.getAttribute('data-candeletesector');\n            ModalFactory.create({\n                title: getString('deletesector', 'local_sector'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('deleteallconfirm', 'local_sector')\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('delete', 'local_sector'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.elementid = sectorid;\n                    params.elementtype = 'sector';\n                    var promise = Ajax.call([{\n                        methodname: 'local_sector_candeleteelement',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        if(resp.candelete == 1) {\n                            modal.hide();\n                            HomePage.confirmbox(getString('remove_dependency', 'local_sector'));\n                            \n                        } else {\n                            var params = {};\n                            params.id = sectorid;\n                            var promise = Ajax.call([{\n                                methodname: 'local_sector_deletesector',\n                                args: params\n                            }]);\n                            promise[0].done(function(resp) {\n                                window.location.reload(true);\n                            }).fail(function() {\n                                // do something with the exception\n                                 console.log('exception');\n                            });\n                        }\n                    }).fail(function() {\n                        console.log('exception');\n                    });\n                    \n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n        segmentelement = e.target.closest(Selectors.actions.deletesegment);\n        if (segmentelement) {\n            const segmentid = segmentelement.getAttribute('data-id');\n            const candeletesegment = segmentelement.getAttribute('data-candeletesegment');\n            ModalFactory.create({\n                title: getString('deletesegment', 'local_sector'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('deletesegmentconf', 'local_sector')\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('delete', 'local_sector'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.elementid = segmentid;\n                    params.elementtype = 'segment';\n                    var promise = Ajax.call([{\n                        methodname: 'local_sector_candeleteelement',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        if(resp.candelete == 1) {\n                            modal.hide();\n                            HomePage.confirmbox(getString('remove_dependency', 'local_sector'));\n                        } else {\n                            var params = {};\n                            params.id = segmentid;\n                            var promise = Ajax.call([{\n                                methodname: 'local_sector_deletesegment',\n                                args: params\n                            }]);\n                            promise[0].done(function(resp) {\n                                window.location.reload(true);\n                            }).fail(function() {\n                                // do something with the exception\n                                console.log('exception');\n                            });\n                        }\n                    }).fail(function() {\n                        console.log('exception');\n                    });    \n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n        jobfamilyelement = e.target.closest(Selectors.actions.deletejobfamily);\n        if (jobfamilyelement) {\n            const jobid = jobfamilyelement.getAttribute('data-id');\n            const candeletejobfamily = jobfamilyelement.getAttribute('data-candeletejobfamily');\n            ModalFactory.create({\n                title: getString('deletejobfamily', 'local_sector'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('deletejobfamilyconf', 'local_sector')\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('delete', 'local_sector'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.elementid = jobid;\n                    params.elementtype = 'jobfamily';\n                    var promise = Ajax.call([{\n                        methodname: 'local_sector_candeleteelement',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        if(resp.candelete == 1) {\n                            modal.hide();\n                            HomePage.confirmbox(getString('remove_dependency', 'local_sector'));\n                        } else {\n                            var params = {};\n                            params.id = jobid;\n                            var promise = Ajax.call([{\n                                methodname: 'local_sector_deletejobfamily',\n                                args: params\n                            }]);\n                            promise[0].done(function(resp) {\n                                window.location.reload(true);\n                            }).fail(function() {\n                                // do something with the exception\n                                console.log('exception');\n                            });\n                        }\n                    }).fail(function() {\n                        console.log('exception');\n                    });      \n                   \n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n    });\n};\n"],"names":["Selectors","createSectors","createSegment","createjobfamily","deletesector","deletesegment","deletejobfamily","HomePage","homepage","document","addEventListener","e","element","target","closest","stopImmediatePropagation","preventDefault","title","getAttribute","form","ModalForm","formClass","args","id","modalConfig","returnFocus","events","FORM_SUBMITTED","window","location","reload","show","sectorid","shared","TPDynamicForm","segmentid","sectorelement","create","type","ModalFactory","types","SAVE_CANCEL","body","done","modal","setSaveButtonText","getRoot","on","ModalEvents","save","params","elementid","elementtype","Ajax","call","methodname","resp","candelete","hide","confirmbox","fail","console","log","bind","this","segmentelement","jobfamilyelement","jobid"],"mappings":"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"}