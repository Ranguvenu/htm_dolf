{"version":3,"file":"jobrole_level.min.js","sources":["../src/jobrole_level.js"],"sourcesContent":["    // This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\nimport TPDynamicForm from 'local_trainingprogram/dynamicform';\nimport ModalForm from 'core_form/modalform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Templates from 'core/templates';\nimport Ajax from 'core/ajax';\nimport {get_string as getString} from 'core/str';\nimport $ from 'jquery';\nimport homepage from 'theme_academy/homepage';\n\nconst Selectors = {\n    actions: {\n        createJobrole: '[data-action=\"createjobrole_level\"]',\n        deletejobrole_level: '[data-action=\"deletejobrole_level\"]',\n        responsibilityview: '[data-action=\"responsibilityview\"]',\n        createJobrole_resp: '[data-action=\"createjobrole_resp\"]',\n        deleteresponsibility: '[data-action=\"deleteresponsibility\"]',\n    },\n};\nlet HomePage = new homepage();\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        let element = e.target.closest(Selectors.actions.createJobrole);\n\n        e.stopImmediatePropagation();\n        if (element) {\n            e.preventDefault();\n            const title = element.getAttribute('data-id') ?\n                getString('editlevel', 'local_sector', element.getAttribute('data-name')) :\n                getString('addlevel', 'local_sector');\n            const form = new ModalForm({\n                formClass: 'local_sector\\\\form\\\\jobrole_level',\n                args: {id: element.getAttribute('data-id'),jobfamilyid: element.getAttribute('data-jobfamilyid')},\n                modalConfig: {title},\n                returnFocus: element,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n\n        let deletejobrole_level = e.target.closest(Selectors.actions.deletejobrole_level);\n        if (deletejobrole_level) {\n             e.preventDefault();\n             const roleid = deletejobrole_level.getAttribute('data-id');\n             const rolename = deletejobrole_level.getAttribute('data-name');\n            ModalFactory.create({\n                title: getString('deletelevelconfirm', 'local_sector'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('leveldeleteconfirm', 'local_sector',rolename)\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deletetext', 'local_sector'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.elementid = roleid;\n                    params.elementtype = 'jobrole';\n                    var promise = Ajax.call([{\n                        methodname: 'local_sector_candeleteelement',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        if(resp.candelete == 1) {\n                            modal.hide();\n                            HomePage.confirmbox(getString('remove_dependency', 'local_sector')); \n                        } else {\n                            var params = {};\n                            params.roleid = roleid;\n                            var promise = Ajax.call([{\n                                methodname: 'local_sector_deletejobrole_level',\n                                args: params\n                            }]);\n                            promise[0].done(function(resp) {\n                                window.location.reload(true);\n                            }).fail(function() {\n                                console.log('exception');\n                            });\n                        }\n                    }).fail(function() {\n                        console.log('exception');\n                    });    \n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n        let responsibilityview = e.target.closest(Selectors.actions.responsibilityview);\n        if (responsibilityview) {\n            e.stopImmediatePropagation();\n            const roleid = responsibilityview.getAttribute('data-roleid');\n            const jobfamilyid = responsibilityview.getAttribute('data-jobfamilyid');\n            var options = {};\n            options.roleid = roleid;\n            options.jobfamilyid = jobfamilyid;\n            var trigger = $(Selectors.actions.responsibilityview);\n            ModalFactory.create({\n                title: getString('responsibilityview', 'local_sector'),\n                body: Templates.render('local_sector/responsibilityview_display',options)\n            }, trigger)\n            .done(function(modal) {\n               this.modal = modal;\n               this.modal.setLarge();\n                modal.show();\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.destroy();\n                }.bind(this));\n            });\n        }\n\n        createJobrole_resp = e.target.closest(Selectors.actions. createJobrole_resp);\n        if (createJobrole_resp) {\n            e.preventDefault();\n            const title = createJobrole_resp.getAttribute('data-id') ?\n                getString('editsector', 'local_sector', createJobrole_resp.getAttribute('data-name')) :\n                getString('addresp', 'local_sector');\n            const form = new ModalForm({\n                formClass: 'local_sector\\\\form\\\\jobrole_resp',\n                args: {id: createJobrole_resp.getAttribute('data-id'),jobfamilyid: createJobrole_resp.getAttribute('data-jobfamilyid'),roleid: createJobrole_resp.getAttribute('data-roleid')},\n                modalConfig: {title},\n                returnFocus: createJobrole_resp,\n            });\n         \n        \n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n\n        let deleteresponsibility = e.target.closest(Selectors.actions.deleteresponsibility);\n        if (deleteresponsibility) {\n             e.preventDefault();\n             const responsibilityid = deleteresponsibility.getAttribute('data-id');\n            ModalFactory.create({\n                title: getString('deletelevelconfirm', 'local_sector'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('rsponsedeleteconfirm', 'local_sector')\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deletetext', 'local_sector'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.responseid = responsibilityid;\n                    var promise = Ajax.call([{\n                        methodname: 'local_sector_deleteresponsibility',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        window.location.reload(true);\n                    }).fail(function() {\n                        console.log('exception');\n                    });\n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n\n         \n    });\n};\n"],"names":["Selectors","createJobrole","deletejobrole_level","responsibilityview","createJobrole_resp","deleteresponsibility","HomePage","homepage","document","addEventListener","e","element","target","closest","stopImmediatePropagation","preventDefault","title","getAttribute","form","ModalForm","formClass","args","id","jobfamilyid","modalConfig","returnFocus","events","FORM_SUBMITTED","window","location","reload","show","roleid","rolename","create","type","ModalFactory","types","SAVE_CANCEL","body","done","modal","setSaveButtonText","getRoot","on","ModalEvents","save","params","elementid","elementtype","Ajax","call","methodname","resp","candelete","hide","confirmbox","fail","console","log","bind","this","options","trigger","Templates","render","setLarge","hidden","destroy","responsibilityid","responseid"],"mappings":"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"}