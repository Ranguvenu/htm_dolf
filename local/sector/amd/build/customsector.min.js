define("local_sector/customsector",["exports","local_trainingprogram/dynamicform","core_form/modalform","core/modal_factory","core/modal_events","core/ajax","theme_academy/homepage","core/str"],(function(_exports,_dynamicform,_modalform,_modal_factory,_modal_events,_ajax,_homepage,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_homepage=_interopRequireDefault(_homepage);const Selectors_actions={createSectors:'[data-action="createsector"]',createSegment:'[data-action="createsegment"]',createjobfamily:'[data-action="createjobfamily"]',deletesector:'[data-action="deletesector"]',deletesegment:'[data-action="deletesegment"]',deletejobfamily:'[data-action="deletejobfamily"]'};let HomePage=new _homepage.default;_exports.init=()=>{document.addEventListener("click",(function(e){let element=e.target.closest(Selectors_actions.createSectors);if(e.stopImmediatePropagation(),element){e.preventDefault();const title=element.getAttribute("data-id")?(0,_str.get_string)("edit_sector","local_sector",element.getAttribute("data-name")):(0,_str.get_string)("add_sector","local_sector"),form=new _modalform.default({formClass:"local_sector\\form\\customsector",args:{id:element.getAttribute("data-id")},modalConfig:{title:title},returnFocus:element});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}if(element=e.target.closest(Selectors_actions.createSegment),element){e.preventDefault();const title=element.getAttribute("data-id")?(0,_str.get_string)("edit_segment","local_sector",element.getAttribute("data-name")):(0,_str.get_string)("add_segmentname","local_sector",element.getAttribute("data-sectorname")),form=new _modalform.default({formClass:"local_sector\\form\\customsegment",args:{id:element.getAttribute("data-id"),sectorid:element.getAttribute("data-sectorid")},modalConfig:{title:title},returnFocus:element});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}if(element=e.target.closest(Selectors_actions.createjobfamily),element){e.preventDefault();var shared=0;element.getAttribute("data-shared")&&(shared=1);const title=element.getAttribute("data-id")?(0,_str.get_string)("edit_jobfamily","local_sector"):element.getAttribute("data-shared")?(0,_str.get_string)("add_jobfamilyname","local_sector"):(0,_str.get_string)("add_jobname","local_sector",element.getAttribute("data-jobname")),form=new _dynamicform.default({formClass:"local_sector\\form\\customjobfamily",args:{id:element.getAttribute("data-id"),segmentid:element.getAttribute("data-segmentid"),shared:shared},modalConfig:{title:title},returnFocus:element});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}if(sectorelement=e.target.closest(Selectors_actions.deletesector),sectorelement){const sectorid=sectorelement.getAttribute("data-id");sectorelement.getAttribute("data-candeletesector");_modal_factory.default.create({title:(0,_str.get_string)("deletesector","local_sector"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deleteallconfirm","local_sector")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("delete","local_sector")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.elementid=sectorid,params.elementtype="sector",_ajax.default.call([{methodname:"local_sector_candeleteelement",args:params}])[0].done((function(resp){if(1==resp.candelete)modal.hide(),HomePage.confirmbox((0,_str.get_string)("remove_dependency","local_sector"));else{var params={};params.id=sectorid,_ajax.default.call([{methodname:"local_sector_deletesector",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}if(segmentelement=e.target.closest(Selectors_actions.deletesegment),segmentelement){const segmentid=segmentelement.getAttribute("data-id");segmentelement.getAttribute("data-candeletesegment");_modal_factory.default.create({title:(0,_str.get_string)("deletesegment","local_sector"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deletesegmentconf","local_sector")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("delete","local_sector")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.elementid=segmentid,params.elementtype="segment",_ajax.default.call([{methodname:"local_sector_candeleteelement",args:params}])[0].done((function(resp){if(1==resp.candelete)modal.hide(),HomePage.confirmbox((0,_str.get_string)("remove_dependency","local_sector"));else{var params={};params.id=segmentid,_ajax.default.call([{methodname:"local_sector_deletesegment",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}if(jobfamilyelement=e.target.closest(Selectors_actions.deletejobfamily),jobfamilyelement){const jobid=jobfamilyelement.getAttribute("data-id");jobfamilyelement.getAttribute("data-candeletejobfamily");_modal_factory.default.create({title:(0,_str.get_string)("deletejobfamily","local_sector"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deletejobfamilyconf","local_sector")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("delete","local_sector")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.elementid=jobid,params.elementtype="jobfamily",_ajax.default.call([{methodname:"local_sector_candeleteelement",args:params}])[0].done((function(resp){if(1==resp.candelete)modal.hide(),HomePage.confirmbox((0,_str.get_string)("remove_dependency","local_sector"));else{var params={};params.id=jobid,_ajax.default.call([{methodname:"local_sector_deletejobfamily",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}}))}}));

//# sourceMappingURL=customsector.min.js.map