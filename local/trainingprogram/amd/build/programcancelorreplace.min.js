define("local_trainingprogram/programcancelorreplace",["exports","local_trainingprogram/dynamicform","core/modal_factory","core/modal_events","theme_academy/homepage","core/ajax","core/str"],(function(_exports,_dynamicform,_modal_factory,_modal_events,_homepage,_ajax,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_homepage=_interopRequireDefault(_homepage),_ajax=_interopRequireDefault(_ajax);var Selectors_actions={replaceprogramuser:'[data-action="replaceprogramuser"]',cancelprogramuser:'[data-action="cancelprogramuser"]'},HomePage=new _homepage.default;_exports.init=function(){document.addEventListener("click",(function(e){var replaceprogramuser=e.target.closest(Selectors_actions.replaceprogramuser);if(replaceprogramuser){e.preventDefault(),e.stopImmediatePropagation();var programid=replaceprogramuser.getAttribute("data-programid"),offeringid=replaceprogramuser.getAttribute("data-offeringid"),userid=replaceprogramuser.getAttribute("data-userid"),username=replaceprogramuser.getAttribute("data-username"),programname=replaceprogramuser.getAttribute("data-programname"),programprice=replaceprogramuser.getAttribute("data-programprice"),useridnumber=replaceprogramuser.getAttribute("data-useridnumber"),replacementfee=replaceprogramuser.getAttribute("data-replacementfee"),isadmin=replaceprogramuser.getAttribute("data-currentuserisadmin");(displayparams={}).programid=programid,displayparams.offeringid=offeringid,displayparams.userid=userid,displayparams.useridnumber=useridnumber,displayparams.username=username,displayparams.programname=programname,displayparams.programprice=programprice,displayparams.isadmin=isadmin,_modal_factory.default.create({title:(0,_str.get_string)("replaceconfirm","local_trainingprogram"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("replaceconfirmmessage","local_trainingprogram",displayparams)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("replace","local_trainingprogram")),modal.getRoot().on(_modal_events.default.save,function(e){if(0==programprice||1==isadmin){e.preventDefault(),e.stopImmediatePropagation(),modal.hide();var title=(0,_str.get_string)("replaceuser","local_trainingprogram"),form=new _dynamicform.default({formClass:"local_trainingprogram\\form\\replaceuserform",args:{programid:replaceprogramuser.getAttribute("data-programid"),offeringid:replaceprogramuser.getAttribute("data-offeringid"),userid:replaceprogramuser.getAttribute("data-userid"),username:replaceprogramuser.getAttribute("data-username"),useridnumber:replaceprogramuser.getAttribute("data-useridnumber"),programprice:replaceprogramuser.getAttribute("data-programprice")},modalConfig:{title:title},returnFocus:replaceprogramuser});form.addEventListener(form.events.FORM_SUBMITTED,(function(){return window.location.reload()})),form.show()}else _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("replacementproceedmessage","local_trainingprogram",replacementfee)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_trainingprogram")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),e.stopImmediatePropagation(),modal.hide();var title=(0,_str.get_string)("replaceuser","local_trainingprogram"),form=new _dynamicform.default({formClass:"local_trainingprogram\\form\\replaceuserform",args:{programid:replaceprogramuser.getAttribute("data-programid"),offeringid:replaceprogramuser.getAttribute("data-offeringid"),userid:replaceprogramuser.getAttribute("data-userid"),username:replaceprogramuser.getAttribute("data-username"),useridnumber:replaceprogramuser.getAttribute("data-useridnumber"),programprice:replaceprogramuser.getAttribute("data-programprice"),replacementfee:replaceprogramuser.getAttribute("data-replacementfee")},modalConfig:{title:title},returnFocus:replaceprogramuser});form.addEventListener(form.events.FORM_SUBMITTED,(function(event){var productdata;event.preventDefault(),e.preventDefault(),productdata=event.detail;var replaceparams={};replaceparams.programid=productdata.programid,replaceparams.offeringid=productdata.offeringid,replaceparams.productid=productdata.productid,replaceparams.fromuserid=productdata.fromuserid,replaceparams.touserid=productdata.touserid,replaceparams.replacementfee=productdata.replacementfee,_ajax.default.call([{methodname:"local_trainingprogram_replaceprogramuser",args:replaceparams}])[0].done((function(resp){window.location=M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+programid})).fail((function(err){HomePage.confirmbox(err.message)}))})),form.show()}.bind(this)),modal.show()}.bind(this))}.bind(this)),modal.show()}.bind(this))}var cancelprogramuser=e.target.closest(Selectors_actions.cancelprogramuser);if(cancelprogramuser){e.preventDefault(),e.stopImmediatePropagation();var displayparams,_programid=cancelprogramuser.getAttribute("data-programid"),_offeringid=cancelprogramuser.getAttribute("data-offeringid"),_userid=cancelprogramuser.getAttribute("data-userid"),_username=cancelprogramuser.getAttribute("data-username"),_programname=cancelprogramuser.getAttribute("data-programname"),_programprice=cancelprogramuser.getAttribute("data-programprice"),programdate=(cancelprogramuser.getAttribute("data-remainingdays"),cancelprogramuser.getAttribute("data-programdate")),_isadmin=cancelprogramuser.getAttribute("data-isadmin");(displayparams={}).programid=_programid,displayparams.offeringid=_offeringid,displayparams.userid=_userid,displayparams.username=_username,displayparams.programname=_programname,displayparams.programprice=_programprice,_modal_factory.default.create({title:(0,_str.get_string)("cancelconfirm","local_trainingprogram"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("cancelconfirmmessage","local_trainingprogram",displayparams)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("yes","local_trainingprogram")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};if(0==_programprice){params.programid=_programid,params.offeringid=_offeringid,params.userid=_userid,params.programprice=0,params.amount=0,params.refundamount=0,params.newinvoiceamount=0,params.productid=0,params.programdate=programdate,params.policyconfirm=0,params.invoicenumber=0,params.isadmin=_isadmin,params.traineeenrolled=0,_ajax.default.call([{methodname:"local_trainingprogram_cancelprogramuser",args:params}])[0].done((function(resp){window.location=M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+_programid})).fail((function(err){HomePage.confirmbox(err.message)}))}else{var canceldataparams={};canceldataparams.programid=_programid,canceldataparams.offeringid=_offeringid,canceldataparams.userid=_userid,canceldataparams.programdate=programdate,_ajax.default.call([{methodname:"local_trainingprogram_getdataforprogramcancellation",args:canceldataparams}])[0].done((function(resp){var responsedata={};if(responsedata.amount=resp.amount,responsedata.refundamount=resp.refundamount,responsedata.newinvoiceamount=resp.newinvoiceamount,responsedata.invoicenumber=resp.invoicenumber,responsedata.productid=resp.productid,responsedata.orgofficialenrolled=resp.orgofficialenrolled,console.log(resp),1==resp.traineeenrolled&&1==_isadmin){var title=(0,_str.get_string)("reasoncancel","local_trainingprogram"),form=new Modalform({formClass:"local_trainingprogram\\form\\reasonform",args:{entitytype:"program",entityid:_programid,userid:_userid,productid:resp.productid},modalConfig:{title:title},returnFocus:cancelprogramuser});form.addEventListener(form.events.FORM_SUBMITTED,(function(event){var data=event.detail;if(console.log(data.policy),data.policy>0)var policyconfirm=1;else policyconfirm=0;var cancelprogramuserparams={};cancelprogramuserparams.programid=_programid,cancelprogramuserparams.offeringid=_offeringid,cancelprogramuserparams.userid=_userid,cancelprogramuserparams.programprice=1,cancelprogramuserparams.amount=responsedata.amount,cancelprogramuserparams.refundamount=responsedata.refundamount,cancelprogramuserparams.newinvoiceamount=0,cancelprogramuserparams.productid=responsedata.productid,cancelprogramuserparams.policyconfirm=policyconfirm,cancelprogramuserparams.programdate=programdate,cancelprogramuserparams.invoicenumber=0,cancelprogramuserparams.isadmin=1,cancelprogramuserparams.traineeenrolled=1,_ajax.default.call([{methodname:"local_trainingprogram_cancelprogramuser",args:cancelprogramuserparams}])[0].done((function(resp){window.location=M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+_programid})).fail((function(err){HomePage.confirmbox(err.message)}))})),form.show()}else if(1==resp.traineeenrolled&&0==_isadmin){var cancelprogramuserparams={};cancelprogramuserparams.programid=_programid,cancelprogramuserparams.offeringid=_offeringid,cancelprogramuserparams.userid=_userid,cancelprogramuserparams.programprice=1,cancelprogramuserparams.amount=responsedata.amount,cancelprogramuserparams.refundamount=responsedata.refundamount,cancelprogramuserparams.newinvoiceamount=0,cancelprogramuserparams.productid=responsedata.productid,cancelprogramuserparams.policyconfirm=1,cancelprogramuserparams.programdate=programdate,cancelprogramuserparams.invoicenumber=0,cancelprogramuserparams.isadmin=0,cancelprogramuserparams.traineeenrolled=1,_ajax.default.call([{methodname:"local_trainingprogram_cancelprogramuser",args:params}])[0].done((function(resp){window.location=M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+_programid})).fail((function(err){HomePage.confirmbox(err.message)}))}else if(0==resp.orgofficialenrolled){var ceparams={};ceparams.programid=_programid,ceparams.offeringid=_offeringid,ceparams.userid=_userid,ceparams.productid=resp.productid,ceparams.programprice=1,ceparams.amount=0,ceparams.refundamount=0,ceparams.newinvoiceamount=0,ceparams.programdate=programdate,ceparams.policyconfirm=0,ceparams.invoicenumber=0,ceparams.isadmin=_isadmin,ceparams.traineeenrolled=0,_ajax.default.call([{methodname:"local_trainingprogram_cancelprogramuser",args:ceparams}])[0].done((function(resp){window.location=M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+_programid})).fail((function(){console.log("exception")}))}else resp.invoicenumber<=0?HomePage.confirmbox((0,_str.get_string)("nopendinginvoiceavailable","local_trainingprogram")):resp.newinvoiceamount<50?HomePage.confirmbox((0,_str.get_string)("invoiceamountcantlower","local_trainingprogram")):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("generateinvoiceconfirmation","local_trainingprogram",responsedata)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_trainingprogram")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var ceparams={};ceparams.programid=_programid,ceparams.offeringid=_offeringid,ceparams.userid=_userid,ceparams.productid=resp.productid,ceparams.programprice=1,ceparams.amount=resp.amount,ceparams.refundamount=resp.refundamount,ceparams.newinvoiceamount=resp.newinvoiceamount,ceparams.programdate=programdate,ceparams.policyconfirm=0,ceparams.invoicenumber=resp.invoicenumber,ceparams.isadmin=_isadmin,ceparams.traineeenrolled=0,_ajax.default.call([{methodname:"local_trainingprogram_cancelprogramuser",args:ceparams}])[0].done((function(resp){window.location=M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+_programid})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))})).fail((function(err){HomePage.confirmbox(err.message)}))}}.bind(this)),modal.show()}.bind(this))}}))}}));

//# sourceMappingURL=programcancelorreplace.min.js.map