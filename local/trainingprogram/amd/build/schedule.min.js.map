{"version":3,"file":"schedule.min.js","sources":["../src/schedule.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport TPDynamicForm from 'local_trainingprogram/dynamicform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport ModalForm from 'core_form/modalform';\nimport {get_string as getString} from 'core/str';\nimport homepage from 'theme_academy/homepage';\n\nconst Selectors = {\n    actions: {\n        \n        schedule: '[data-action=\"schedule\"]',\n        deleteshedule: '[data-action=\"deleteshedule\"]',\n    },\n};\nlet HomePage = new homepage();\nexport const init = () => {\n\n    document.addEventListener('click', function(e) {\n        let schedule = e.target.closest(Selectors.actions.schedule);\n        if (schedule) {\n            e.preventDefault();\n             const name = schedule.getAttribute('data-programname'); \n             const title = schedule.getAttribute('data-id') ?\n                getString('editschedule', 'local_trainingprogram',name) :\n                getString('schedulenew', 'local_trainingprogram',name);\n            const form = new TPDynamicForm({\n                formClass: 'local_trainingprogram\\\\form\\\\schedule',\n                args: {id: schedule.getAttribute('data-id'),trainingid: schedule.getAttribute('data-traineeid'), entitycode:$(\"input[name='sesskey']\").val()},\n                modalConfig: {title},\n                returnFocus: schedule,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.addEventListener(form.events.FORM_CANCELLED, (e) => {\n                var params = {};\n                params.sessionkey = $(\"input[name='sesskey']\").val();\n                params.type = 'tprogram';\n                var promise = Ajax.call([{\n                    methodname: 'remove_reservations',\n                    args: params\n                }]);\n                promise[0].done(function(resp) {\n                    $(\".entityhalldetails\").html('');\n                    console.log('Successfully reservations removed');\n                }).fail(function() {\n                     console.log('exception');\n                });\n            });            \n            form.show();\n        }\n        let deleteshedule = e.target.closest(Selectors.actions.deleteshedule);\n        if (deleteshedule) {\n            e.preventDefault();\n            const sheduleid = deleteshedule.getAttribute('data-id');\n            const userroleshortname = deleteshedule.getAttribute('data-userroleshortname');\n            const code = deleteshedule.getAttribute('data-code');\n            \n            ModalFactory.create({\n                title: getString('deleteconfirm', 'local_trainingprogram'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('sheduledeleteconfirm', 'local_trainingprogram')\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deletetext', 'local_trainingprogram'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    if(userroleshortname == 'to') {\n                        var params = {};\n                        params.rootid = sheduleid;\n                        params.etype = 'offering';\n                        var promise = Ajax.call([{\n                            methodname: 'local_trainingprogram_tofficialdeleteaction',\n                            args: params\n                        }]);\n                        promise[0].done(function(resp) {\n                            if(resp.response == 'success') {\n                                modal.hide();\n                                HomePage.confirmbox(getString('offeringdeletionwaitingfortsuperviser', 'local_trainingprogram',code));\n                                setTimeout(function() {\n                                    location.reload();\n                                },4000);\n                                  \n                            } else {\n                                modal.hide();\n                                HomePage.confirmbox(resp.response);\n                            }\n                        }).fail(function() {\n                            console.log('exception');\n                        });\n                    } else {\n                        var params = {};\n                        params.sheduleid = sheduleid;\n                        var promise = Ajax.call([{\n                            methodname: 'local_trainingprogram_deleteshedule',\n                            args: params\n                        }]);\n                        promise[0].done(function(resp) {\n                            window.location.reload(true);\n                        }).fail(function() {\n                            console.log('exception');\n                        });\n                    }\n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n        $(document).on('change','select[name=\"type\"]', function(e){\n            var type = $(this).val();\n            if (type == 0) {\n                $('input[name=\"halllocation1\"]').removeAttr('checked');\n                $(\".entityhall\").removeAttr(\"hidden\");\n                $(\".entityhall\").css(\"display\", \"flex\");\n                $('select[name=\"halladdress\"]').removeAttr(\"disabled\");\n                // $(\".badge.badge-info\").html('Select Hall');\n                var trainingmethod = $(\"select[name='trainingmethod']\").val();\n\n                if (trainingmethod == 'offline') {\n                    $('*[data-groupname=\"hallalertgroup\"]').removeAttr(\"hidden\");\n                    $('*[data-groupname=\"hallalertgroup\"]').css(\"display\", \"flex\");\n                    $('*[data-groupname=\"reservationgroup\"]').removeAttr(\"hidden\");\n                    $('*[data-groupname=\"reservationgroup\"]').css(\"display\", \"flex\");\n                }\n            }\n        });\n        $(document).on('change','.time_selector select', function(e){\n\n            var timeSelector = $(this).parents().find('form').serializeArray();\n\n            var starttimehour = 0;\n            var starttimeminute = 0;\n            var endtimehour = 0;\n            var endtimeminute = 0;\n\n            $.each(timeSelector,function(index,value) {\n                if(value.name == 'starttime[hours]'){\n                    starttimehour = value.value;\n                }else if(value.name == 'starttime[minutes]'){\n                    starttimeminute = value.value;\n                }else if(value.name == 'endtime[hours]'){\n                    endtimehour = value.value;\n                }else if(value.name == 'endtime[minutes]'){\n                    endtimeminute = value.value;\n                }\n           });\n           var starttime = (starttimehour * 3600) + (starttimeminute * 60);\n           var endtime = (endtimehour * 3600) + (endtimeminute * 60);\n           var duration = Math.abs(starttime-endtime);\n           var dur_min = duration/60;\n           var hours = Math.floor(dur_min / 60);\n           var minutes = (dur_min % 60);\n            if(hours > 0) {\n              $('#offering_hours').parent().removeClass('hidden');\n            } \n            if(minutes > 0) {\n              $('#offering_minutes').parent().removeClass('hidden');\n            } \n            if(endtime <= starttime) {\n                $('#offering_hours').parent().addClass('hidden');\n                $('#offering_minutes').parent().addClass('hidden');\n            }\n            if(hours  == 1) {\n                var hourtext = getString('hour', 'local_trainingprogram');\n            } else {\n                var hourtext = getString('hours', 'local_trainingprogram');\n            }\n            var minutetext = getString('minutes', 'local_trainingprogram');\n            hourtext.done(function(html,js){\n                $('#offering_hours').html(hours +\" \"+ html);\n            });\n            minutetext.done(function(html,js){\n                $('#offering_minutes').html(minutes +\" \"+ html);\n            });\n        });\n\n        $(\"select[name='trainingmethod']\").on('change', function(e){\n                    \n            var trainingmethod = $(this).val();\n            if(trainingmethod == 'elearning')  {\n                $('#ofeering_duration').addClass('hidden');\n                $('#offering_hours').addClass('hidden');\n                $('#offering_minutes').addClass('hidden');\n            }\n\n        });\n        var halllocation = document.querySelectorAll('[name=\"halllocation\"]');\n        const addHallButton = document.querySelector('#create_hall');\n        for (let index = 0; index < halllocation.length; index++) {\n            if (halllocation[index].checked) {\n                if (halllocation[index].value == 'outside') {\n                    if(halllocation[index].value == 'outside'){\n                        addHallButton.style.display=\"block\";\n                    }\n                }else{\n                    addHallButton.style.display=\"none\";\n                }\n            }\n        }\n\n    });\n};\n"],"names":["Selectors","schedule","deleteshedule","HomePage","homepage","document","addEventListener","e","target","closest","preventDefault","name","getAttribute","title","form","TPDynamicForm","formClass","args","id","trainingid","entitycode","$","val","modalConfig","returnFocus","events","FORM_SUBMITTED","window","location","reload","FORM_CANCELLED","params","sessionkey","type","Ajax","call","methodname","done","resp","html","console","log","fail","show","sheduleid","userroleshortname","code","create","ModalFactory","types","SAVE_CANCEL","body","modal","setSaveButtonText","getRoot","on","ModalEvents","save","rootid","etype","response","hide","confirmbox","setTimeout","bind","this","removeAttr","css","timeSelector","parents","find","serializeArray","starttimehour","starttimeminute","endtimehour","endtimeminute","each","index","value","starttime","endtime","dur_min","Math","abs","hours","floor","minutes","parent","removeClass","addClass","hourtext","minutetext","js","halllocation","querySelectorAll","addHallButton","querySelector","length","checked","style","display"],"mappings":"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"}