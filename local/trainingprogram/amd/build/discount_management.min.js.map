{"version":3,"file":"discount_management.min.js","sources":["../src/discount_management.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module discount_management\n *\n * @module     local_trainingprogram/discount_management\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport TPDynamicForm from 'local_trainingprogram/dynamicform';\nimport ModalForm from 'core_form/modalform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport {get_string as getString} from 'core/str';\nconst Selectors = {\n    actions: {\n        createcoupon: '[data-action=\"createcoupon\"]',\n        couponmail: '[data-action=\"couponmail\"]',\n        deletecoupon: '[data-action=\"deletecoupon\"]',\n\n        createearlyregistration: '[data-action=\"createearlyregistration\"]',\n        deleteearlyregistration: '[data-action=\"deleteearlyregistration\"]',\n\n        creatediscountgroups: '[data-action=\"creatediscountgroups\"]',\n        deletediscountgroups: '[data-action=\"deletediscountgroups\"]',\n\n        viewdiscountentity: '[data-action=\"viewdiscountentity\"]',\n\n        \n    },\n};\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        let couponElement = e.target.closest(Selectors.actions.createcoupon);\n        if (couponElement) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = couponElement.getAttribute('data-id') ?\n                getString('editcoupon', 'local_trainingprogram') :\n                getString('createcoupon', 'local_trainingprogram');\n            const form = new TPDynamicForm({\n                formClass: 'local_trainingprogram\\\\form\\\\couponform',\n                args: {id: couponElement.getAttribute('data-id')},\n                modalConfig: {title},\n                returnFocus: couponElement,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        let couponmail = e.target.closest(Selectors.actions.couponmail);\n        if (couponmail) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = getString('couponmail', 'local_trainingprogram');\n            const form = new TPDynamicForm({\n                formClass: 'local_trainingprogram\\\\form\\\\coupon_mail_form',\n                args: {couponid: couponmail.getAttribute('data-couponid'),couponcode: couponmail.getAttribute('data-couponcode')},\n                modalConfig: {title},\n                returnFocus: couponmail,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        let deletecoupon = e.target.closest(Selectors.actions.deletecoupon);\n        if (deletecoupon) {\n            e.preventDefault();\n            e.stopImmediatePropagation()\n            const couponid = deletecoupon.getAttribute('data-couponid');\n            const couponcode = deletecoupon.getAttribute('data-couponcode');\n            ModalFactory.create({\n                title: getString('couponconfirm', 'local_trainingprogram'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('deletecouponconfirm', 'local_trainingprogram',couponcode)\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deletetext', 'local_trainingprogram'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.couponid = couponid;\n                    params.couponcode = couponcode;\n                    var promise = Ajax.call([{\n                        methodname: 'local_trainingprogram_deletecoupon',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        window.location.reload(true);\n                    }).fail(function() {\n                        console.log('exception');\n                    });\n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n\n        let earlyregistrationelement = e.target.closest(Selectors.actions.createearlyregistration);\n        if (earlyregistrationelement) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = earlyregistrationelement.getAttribute('data-id') ?\n                getString('editearlyregistration', 'local_trainingprogram') :\n                getString('createearlyregistration', 'local_trainingprogram');\n            const form = new TPDynamicForm({\n                formClass: 'local_trainingprogram\\\\form\\\\earlyregistrationform',\n                args: {id: earlyregistrationelement.getAttribute('data-id')},\n                modalConfig: {title},\n                returnFocus: earlyregistrationelement,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        let deleteearlyregistration = e.target.closest(Selectors.actions.deleteearlyregistration);\n        if (deleteearlyregistration) {\n            e.preventDefault();\n            e.stopImmediatePropagation()\n            const earlyregistrationid = deleteearlyregistration.getAttribute('data-earlyregistrationid');\n            const days = deleteearlyregistration.getAttribute('data-days');\n            const discount= deleteearlyregistration.getAttribute('data-discount');\n            var displayparams = {};\n            displayparams.days = days;\n            displayparams.discount = discount;\n            ModalFactory.create({\n                title: getString('earlyregistrationconfirm', 'local_trainingprogram'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('deleteearlyregistrationconfirm', 'local_trainingprogram',displayparams)\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deletetext', 'local_trainingprogram'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.earlyregistrationid = earlyregistrationid;\n                    params.days = days;\n                    params.discount = discount;\n                    var promise = Ajax.call([{\n                        methodname: 'local_trainingprogram_deleteearlyregistration',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        window.location.reload(true);\n                    }).fail(function() {\n                        console.log('exception');\n                    });\n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n        let creatediscountgroups = e.target.closest(Selectors.actions.creatediscountgroups);\n        if (creatediscountgroups) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const title = creatediscountgroups.getAttribute('data-id') ?\n                getString('editgroupdiscount', 'local_trainingprogram') :\n                getString('creategroupdiscount', 'local_trainingprogram');\n            const form = new TPDynamicForm({\n                formClass: 'local_trainingprogram\\\\form\\\\groupdiscountsform',\n                args: {id: creatediscountgroups.getAttribute('data-id')},\n                modalConfig: {title},\n                returnFocus: creatediscountgroups,\n            });\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.show();\n        }\n        let deletediscountgroups = e.target.closest(Selectors.actions.deletediscountgroups);\n        if (deletediscountgroups) {\n            e.preventDefault();\n            e.stopImmediatePropagation()\n            const id = deletediscountgroups.getAttribute('data-id');\n            const count = deletediscountgroups.getAttribute('data-count');\n            const discount= deletediscountgroups.getAttribute('data-discount');\n            var displayparams = {};\n            displayparams.count = count;\n            displayparams.discount = discount;\n            ModalFactory.create({\n                title: getString('deletegroupdiscountconfirm', 'local_trainingprogram'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: getString('deletedeletegroupdiscountconfirm', 'local_trainingprogram',displayparams)\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deletetext', 'local_trainingprogram'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.id = id;\n                    var promise = Ajax.call([{\n                        methodname: 'local_trainingprogram_deletegroupdiscount',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        window.location.reload(true);\n                    }).fail(function() {\n                        console.log('exception');\n                    });\n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n        let viewdiscountentity = e.target.closest(Selectors.actions.viewdiscountentity);\n        if (viewdiscountentity) {\n            const entityid = viewdiscountentity.getAttribute('data-id');\n            const entitytype = viewdiscountentity.getAttribute('data-entitytype');\n            var params = {};\n            params.entityid = entityid;\n            params.entitytype = entitytype;\n            var promise = Ajax.call([{\n                methodname: 'local_trainingprogram_viewdiscountentity',\n                args: params\n            }]);\n            promise[0].done(function(resp) {\n                if(entitytype == 'coupon') {\n                    var titlestring = 'Coupon Discount'\n                } else if(entitytype == 'group') {\n                    var titlestring = 'Group Discount'\n                } else {\n                    var titlestring = 'Earlyregistration Discount'\n                }\n                ModalFactory.create({\n                    title: getString('view_entity', 'local_trainingprogram',titlestring),\n                    type: ModalFactory.types.DEFAULT,\n                    body: resp.options,\n                }).done(function(modal) {\n                    this.modal = modal;\n                    this.modal.setLarge();\n                    modal.show();\n                }.bind(this));\n            }).fail(function() {\n                console.log('exception');\n            });\n        }\n    });\n};\n\n"],"names":["Selectors","createcoupon","couponmail","deletecoupon","createearlyregistration","deleteearlyregistration","creatediscountgroups","deletediscountgroups","viewdiscountentity","document","addEventListener","e","couponElement","target","closest","preventDefault","stopImmediatePropagation","title","getAttribute","form","TPDynamicForm","formClass","args","id","modalConfig","returnFocus","events","FORM_SUBMITTED","window","location","reload","show","couponid","couponcode","create","type","ModalFactory","types","SAVE_CANCEL","body","done","modal","setSaveButtonText","getRoot","on","ModalEvents","save","params","Ajax","call","methodname","resp","fail","console","log","bind","this","earlyregistrationelement","earlyregistrationid","days","discount","displayparams","count","entityid","entitytype","titlestring","DEFAULT","options","setLarge"],"mappings":"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"}