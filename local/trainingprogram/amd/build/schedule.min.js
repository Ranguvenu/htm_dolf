define("local_trainingprogram/schedule",["exports","local_trainingprogram/dynamicform","core/modal_factory","core/modal_events","core/ajax","core_form/modalform","core/str","theme_academy/homepage"],(function(_exports,_dynamicform,_modal_factory,_modal_events,_ajax,_modalform,_str,_homepage){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_modalform=_interopRequireDefault(_modalform),_homepage=_interopRequireDefault(_homepage);var Selectors_actions={schedule:'[data-action="schedule"]',deleteshedule:'[data-action="deleteshedule"]'},HomePage=new _homepage.default;_exports.init=function(){document.addEventListener("click",(function(e){var schedule=e.target.closest(Selectors_actions.schedule);if(schedule){e.preventDefault();var name=schedule.getAttribute("data-programname"),title=schedule.getAttribute("data-id")?(0,_str.get_string)("editschedule","local_trainingprogram",name):(0,_str.get_string)("schedulenew","local_trainingprogram",name),form=new _dynamicform.default({formClass:"local_trainingprogram\\form\\schedule",args:{id:schedule.getAttribute("data-id"),trainingid:schedule.getAttribute("data-traineeid"),entitycode:$("input[name='sesskey']").val()},modalConfig:{title:title},returnFocus:schedule});form.addEventListener(form.events.FORM_SUBMITTED,(function(){return window.location.reload()})),form.addEventListener(form.events.FORM_CANCELLED,(function(e){var params={};params.sessionkey=$("input[name='sesskey']").val(),params.type="tprogram",_ajax.default.call([{methodname:"remove_reservations",args:params}])[0].done((function(resp){$(".entityhalldetails").html(""),console.log("Successfully reservations removed")})).fail((function(){console.log("exception")}))})),form.show()}var deleteshedule=e.target.closest(Selectors_actions.deleteshedule);if(deleteshedule){e.preventDefault();var sheduleid=deleteshedule.getAttribute("data-id"),userroleshortname=deleteshedule.getAttribute("data-userroleshortname"),code=deleteshedule.getAttribute("data-code");_modal_factory.default.create({title:(0,_str.get_string)("deleteconfirm","local_trainingprogram"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("sheduledeleteconfirm","local_trainingprogram")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("deletetext","local_trainingprogram")),modal.getRoot().on(_modal_events.default.save,function(e){var params;(e.preventDefault(),"to"==userroleshortname)?((params={}).rootid=sheduleid,params.etype="offering",_ajax.default.call([{methodname:"local_trainingprogram_tofficialdeleteaction",args:params}])[0].done((function(resp){"success"==resp.response?(modal.hide(),HomePage.confirmbox((0,_str.get_string)("offeringdeletionwaitingfortsuperviser","local_trainingprogram",code)),setTimeout((function(){location.reload()}),4e3)):(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))):((params={}).sheduleid=sheduleid,_ajax.default.call([{methodname:"local_trainingprogram_deleteshedule",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")})))}.bind(this)),modal.show()}.bind(this))}$(document).on("change",'select[name="type"]',(function(e){0==$(this).val()&&($('input[name="halllocation1"]').removeAttr("checked"),$(".entityhall").removeAttr("hidden"),$(".entityhall").css("display","flex"),$('select[name="halladdress"]').removeAttr("disabled"),"offline"==$("select[name='trainingmethod']").val()&&($('*[data-groupname="hallalertgroup"]').removeAttr("hidden"),$('*[data-groupname="hallalertgroup"]').css("display","flex"),$('*[data-groupname="reservationgroup"]').removeAttr("hidden"),$('*[data-groupname="reservationgroup"]').css("display","flex")))})),$(document).on("change",".time_selector select",(function(e){var timeSelector=$(this).parents().find("form").serializeArray(),starttimehour=0,starttimeminute=0,endtimehour=0,endtimeminute=0;$.each(timeSelector,(function(index,value){"starttime[hours]"==value.name?starttimehour=value.value:"starttime[minutes]"==value.name?starttimeminute=value.value:"endtime[hours]"==value.name?endtimehour=value.value:"endtime[minutes]"==value.name&&(endtimeminute=value.value)}));var starttime=3600*starttimehour+60*starttimeminute,endtime=3600*endtimehour+60*endtimeminute,dur_min=Math.abs(starttime-endtime)/60,hours=Math.floor(dur_min/60),minutes=dur_min%60;if(hours>0&&$("#offering_hours").parent().removeClass("hidden"),minutes>0&&$("#offering_minutes").parent().removeClass("hidden"),endtime<=starttime&&($("#offering_hours").parent().addClass("hidden"),$("#offering_minutes").parent().addClass("hidden")),1==hours)var hourtext=(0,_str.get_string)("hour","local_trainingprogram");else hourtext=(0,_str.get_string)("hours","local_trainingprogram");var minutetext=(0,_str.get_string)("minutes","local_trainingprogram");hourtext.done((function(html,js){$("#offering_hours").html(hours+" "+html)})),minutetext.done((function(html,js){$("#offering_minutes").html(minutes+" "+html)}))})),$("select[name='trainingmethod']").on("change",(function(e){"elearning"==$(this).val()&&($("#ofeering_duration").addClass("hidden"),$("#offering_hours").addClass("hidden"),$("#offering_minutes").addClass("hidden"))}));for(var halllocation=document.querySelectorAll('[name="halllocation"]'),addHallButton=document.querySelector("#create_hall"),index=0;index<halllocation.length;index++)halllocation[index].checked&&("outside"==halllocation[index].value?"outside"==halllocation[index].value&&(addHallButton.style.display="block"):addHallButton.style.display="none")}))}}));

//# sourceMappingURL=schedule.min.js.map