define("local_trainingprogram/discount_management",["exports","local_trainingprogram/dynamicform","core_form/modalform","core/modal_factory","core/modal_events","core/ajax","core/str"],(function(_exports,_dynamicform,_modalform,_modal_factory,_modal_events,_ajax,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module discount_management
   *
   * @module     local_trainingprogram/discount_management
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax);var Selectors_actions={createcoupon:'[data-action="createcoupon"]',couponmail:'[data-action="couponmail"]',deletecoupon:'[data-action="deletecoupon"]',createearlyregistration:'[data-action="createearlyregistration"]',deleteearlyregistration:'[data-action="deleteearlyregistration"]',creatediscountgroups:'[data-action="creatediscountgroups"]',deletediscountgroups:'[data-action="deletediscountgroups"]',viewdiscountentity:'[data-action="viewdiscountentity"]'};_exports.init=function(){document.addEventListener("click",(function(e){var couponElement=e.target.closest(Selectors_actions.createcoupon);if(couponElement){e.preventDefault(),e.stopImmediatePropagation();var title=couponElement.getAttribute("data-id")?(0,_str.get_string)("editcoupon","local_trainingprogram"):(0,_str.get_string)("createcoupon","local_trainingprogram"),form=new _dynamicform.default({formClass:"local_trainingprogram\\form\\couponform",args:{id:couponElement.getAttribute("data-id")},modalConfig:{title:title},returnFocus:couponElement});form.addEventListener(form.events.FORM_SUBMITTED,(function(){return window.location.reload()})),form.show()}var couponmail=e.target.closest(Selectors_actions.couponmail);if(couponmail){e.preventDefault(),e.stopImmediatePropagation();var _title=(0,_str.get_string)("couponmail","local_trainingprogram"),_form=new _dynamicform.default({formClass:"local_trainingprogram\\form\\coupon_mail_form",args:{couponid:couponmail.getAttribute("data-couponid"),couponcode:couponmail.getAttribute("data-couponcode")},modalConfig:{title:_title},returnFocus:couponmail});_form.addEventListener(_form.events.FORM_SUBMITTED,(function(){return window.location.reload()})),_form.show()}var deletecoupon=e.target.closest(Selectors_actions.deletecoupon);if(deletecoupon){e.preventDefault(),e.stopImmediatePropagation();var couponid=deletecoupon.getAttribute("data-couponid"),couponcode=deletecoupon.getAttribute("data-couponcode");_modal_factory.default.create({title:(0,_str.get_string)("couponconfirm","local_trainingprogram"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deletecouponconfirm","local_trainingprogram",couponcode)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("deletetext","local_trainingprogram")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.couponid=couponid,params.couponcode=couponcode,_ajax.default.call([{methodname:"local_trainingprogram_deletecoupon",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}var earlyregistrationelement=e.target.closest(Selectors_actions.createearlyregistration);if(earlyregistrationelement){e.preventDefault(),e.stopImmediatePropagation();var _title2=earlyregistrationelement.getAttribute("data-id")?(0,_str.get_string)("editearlyregistration","local_trainingprogram"):(0,_str.get_string)("createearlyregistration","local_trainingprogram"),_form2=new _dynamicform.default({formClass:"local_trainingprogram\\form\\earlyregistrationform",args:{id:earlyregistrationelement.getAttribute("data-id")},modalConfig:{title:_title2},returnFocus:earlyregistrationelement});_form2.addEventListener(_form2.events.FORM_SUBMITTED,(function(){return window.location.reload()})),_form2.show()}var deleteearlyregistration=e.target.closest(Selectors_actions.deleteearlyregistration);if(deleteearlyregistration){e.preventDefault(),e.stopImmediatePropagation();var earlyregistrationid=deleteearlyregistration.getAttribute("data-earlyregistrationid"),days=deleteearlyregistration.getAttribute("data-days"),discount=deleteearlyregistration.getAttribute("data-discount");(displayparams={}).days=days,displayparams.discount=discount,_modal_factory.default.create({title:(0,_str.get_string)("earlyregistrationconfirm","local_trainingprogram"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deleteearlyregistrationconfirm","local_trainingprogram",displayparams)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("deletetext","local_trainingprogram")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.earlyregistrationid=earlyregistrationid,params.days=days,params.discount=discount,_ajax.default.call([{methodname:"local_trainingprogram_deleteearlyregistration",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}var creatediscountgroups=e.target.closest(Selectors_actions.creatediscountgroups);if(creatediscountgroups){e.preventDefault(),e.stopImmediatePropagation();var _title3=creatediscountgroups.getAttribute("data-id")?(0,_str.get_string)("editgroupdiscount","local_trainingprogram"):(0,_str.get_string)("creategroupdiscount","local_trainingprogram"),_form3=new _dynamicform.default({formClass:"local_trainingprogram\\form\\groupdiscountsform",args:{id:creatediscountgroups.getAttribute("data-id")},modalConfig:{title:_title3},returnFocus:creatediscountgroups});_form3.addEventListener(_form3.events.FORM_SUBMITTED,(function(){return window.location.reload()})),_form3.show()}var deletediscountgroups=e.target.closest(Selectors_actions.deletediscountgroups);if(deletediscountgroups){e.preventDefault(),e.stopImmediatePropagation();var displayparams,id=deletediscountgroups.getAttribute("data-id"),count=deletediscountgroups.getAttribute("data-count"),_discount=deletediscountgroups.getAttribute("data-discount");(displayparams={}).count=count,displayparams.discount=_discount,_modal_factory.default.create({title:(0,_str.get_string)("deletegroupdiscountconfirm","local_trainingprogram"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deletedeletegroupdiscountconfirm","local_trainingprogram",displayparams)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("deletetext","local_trainingprogram")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.id=id,_ajax.default.call([{methodname:"local_trainingprogram_deletegroupdiscount",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}var viewdiscountentity=e.target.closest(Selectors_actions.viewdiscountentity);if(viewdiscountentity){var entityid=viewdiscountentity.getAttribute("data-id"),entitytype=viewdiscountentity.getAttribute("data-entitytype"),params={};params.entityid=entityid,params.entitytype=entitytype,_ajax.default.call([{methodname:"local_trainingprogram_viewdiscountentity",args:params}])[0].done((function(resp){if("coupon"==entitytype)var titlestring="Coupon Discount";else if("group"==entitytype)titlestring="Group Discount";else titlestring="Earlyregistration Discount";_modal_factory.default.create({title:(0,_str.get_string)("view_entity","local_trainingprogram",titlestring),type:_modal_factory.default.types.DEFAULT,body:resp.options}).done(function(modal){this.modal=modal,this.modal.setLarge(),modal.show()}.bind(this))})).fail((function(){console.log("exception")}))}}))}}));

//# sourceMappingURL=discount_management.min.js.map