define("local_trainingprogram/entityaction",["exports","core_form/modalform","core/modal_factory","core/modal_events","theme_academy/homepage","core/fragment","core/ajax","core/templates","core/str","jquery"],(function(_exports,_modalform,_modal_factory,_modal_events,_homepage,_fragment,_ajax,_templates,_str,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module entityaction
   *
   * @module     local_trainingprogram/entityaction
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_homepage=_interopRequireDefault(_homepage),_fragment=_interopRequireDefault(_fragment),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery);var Selectors_actions={cancelentity:'[data-action="cancelentity"]',publishorunpublishentity:'[data-action="publishorunpublishentity"]',update_financially_closed_status:'[data-action="update_financially_closed_status"]'},HomePage=new _homepage.default;_exports.init=function(){document.addEventListener("click",(function(e){var cancelentity=e.target.closest(Selectors_actions.cancelentity);if(cancelentity){e.preventDefault(),e.stopImmediatePropagation();var rootid=cancelentity.getAttribute("data-rootid"),fieldid=cancelentity.getAttribute("data-fieldid"),productid=cancelentity.getAttribute("data-productid"),fieldcode=cancelentity.getAttribute("data-fieldcode"),entitytype=cancelentity.getAttribute("data-entitytype"),currentuser=cancelentity.getAttribute("data-currentuser"),costtype=cancelentity.getAttribute("data-costtype"),requestby=cancelentity.getAttribute("data-requestby"),requesttype=cancelentity.getAttribute("data-requesttype"),hasenrollments=cancelentity.getAttribute("data-hasenrollments");if((displayparams={}).rootid=rootid,displayparams.fieldid=fieldid,displayparams.fieldcode=fieldcode,displayparams.type=entitytype,displayparams.requestby=requestby,displayparams.requesttype=requesttype,"cancelentity"==requesttype)var headermessage=(0,_str.get_string)("cancelconfirm","local_trainingprogram"),bodymessage=(0,_str.get_string)("entitycancelconfirmmessage","local_trainingprogram",displayparams);else if("approvecancelrequest"==requesttype)headermessage=(0,_str.get_string)("approveconfirm","local_trainingprogram"),bodymessage=(0,_str.get_string)("approveentitycancelconfirmmessage","local_trainingprogram",displayparams);else headermessage=(0,_str.get_string)("rejectconfirm","local_trainingprogram"),bodymessage=(0,_str.get_string)("rejectentitycancelconfirmmessage","local_trainingprogram",displayparams);_modal_factory.default.create({title:headermessage,type:_modal_factory.default.types.SAVE_CANCEL,body:bodymessage}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("yes","local_trainingprogram")),modal.getRoot().on(_modal_events.default.save,function(e){if(e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((function(_ref){var html=_ref.html,js=_ref.js;_templates.default.appendNodeContents(".modal-content",html,js)})),"cancelentity"==requesttype){var title=(0,_str.get_string)("reasoncancel","local_exams"),form=new _modalform.default({formClass:"local_exams\\form\\reasonform",args:{entitytype:entitytype,userid:0,productid:productid},modalConfig:{title:title},returnFocus:cancelentity});form.addEventListener(form.events.FORM_SUBMITTED,(function(event){event.detail;var params={};params.rootid=rootid,params.fieldid=fieldid,params.productid=productid,params.fieldcode=fieldcode,params.entitytype=entitytype,params.costtype=costtype,params.currentuser=currentuser,params.requesttype=requesttype,params.hasenrollments=hasenrollments,_ajax.default.call([{methodname:"local_trainingprogram_cancelentity",args:params}])[0].done((function(resp){if("success"==resp.response)if("admin"!=currentuser&&("ts"!=currentuser&&"eventmanager"!=currentuser||"approvecancelrequest"!=requesttype&&"rejectcancelrequest"!=requesttype)){if("financial_manager"==currentuser)var bodayMessage=(0,_str.get_string)("tofficialcancelresponse","local_trainingprogram",displayparams);else if("event"==entitytype)bodayMessage=(0,_str.get_string)("emcancelresponse","local_trainingprogram",displayparams);else if(1==hasenrollments)bodayMessage=(0,_str.get_string)("faofficialcancelresponse","local_trainingprogram",displayparams);else bodayMessage=(0,_str.get_string)("tofficialcancelresponse","local_trainingprogram",displayparams);HomePage.confirmbox(bodayMessage),setTimeout((function(){location.reload()}),4e3)}else window.location.href=resp.returnurl;else modal.hide(),HomePage.confirmbox(resp.response)})).fail((function(err){HomePage.confirmbox(err.message)}))})),form.show()}else{var params={};params.rootid=rootid,params.fieldid=fieldid,params.productid=productid,params.fieldcode=fieldcode,params.entitytype=entitytype,params.costtype=costtype,params.currentuser=currentuser,params.requesttype=requesttype,params.hasenrollments=hasenrollments,_ajax.default.call([{methodname:"local_trainingprogram_cancelentity",args:params}])[0].done((function(resp){if("success"==resp.response)if("admin"!=currentuser&&("ts"!=currentuser&&"eventmanager"!=currentuser||"approvecancelrequest"!=requesttype&&"rejectcancelrequest"!=requesttype)){if("financial_manager"==currentuser)var bodayMessage=(0,_str.get_string)("tofficialcancelresponse","local_trainingprogram",displayparams);else if("event"==entitytype)bodayMessage=(0,_str.get_string)("emcancelresponse","local_trainingprogram",displayparams);else if(1==hasenrollments)bodayMessage=(0,_str.get_string)("faofficialcancelresponse","local_trainingprogram",displayparams);else bodayMessage=(0,_str.get_string)("tofficialcancelresponse","local_trainingprogram",displayparams);HomePage.confirmbox(bodayMessage),setTimeout((function(){location.reload()}),4e3)}else window.location.href=resp.returnurl;else modal.hide(),HomePage.confirmbox(resp.response)})).fail((function(err){HomePage.confirmbox(err.message)}))}}.bind(this)),modal.show()}.bind(this))}var publishorunpublishentity=e.target.closest(Selectors_actions.publishorunpublishentity);if(publishorunpublishentity){e.preventDefault();var displayparams,id=publishorunpublishentity.getAttribute("data-id"),code=publishorunpublishentity.getAttribute("data-code"),_entitytype=publishorunpublishentity.getAttribute("data-entitytype"),actiontype=publishorunpublishentity.getAttribute("data-actiontype");if((displayparams={}).code=code,displayparams.entitytype=_entitytype,"publish"==actiontype){headermessage=(0,_str.get_string)("publishconfirm","local_trainingprogram"),bodymessage=(0,_str.get_string)("entitypublishconfirm","local_trainingprogram",displayparams);var footermessage=(0,_str.get_string)("publishtext","local_trainingprogram")}else headermessage=(0,_str.get_string)("unpublishconfirm","local_trainingprogram"),bodymessage=(0,_str.get_string)("entityunpublishconfirm","local_trainingprogram",displayparams),footermessage=(0,_str.get_string)("unpublishtext","local_trainingprogram");_modal_factory.default.create({title:headermessage,type:_modal_factory.default.types.SAVE_CANCEL,body:bodymessage}).done(function(modal){this.modal=modal,modal.setSaveButtonText(footermessage),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.id=id,params.code=code,params.entitytype=_entitytype,params.actiontype=actiontype,_ajax.default.call([{methodname:"local_trainingprogram_publishorunpublishoffering",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}var update_financially_closed_status=e.target.closest(Selectors_actions.update_financially_closed_status);if(update_financially_closed_status){e.preventDefault();var _id=update_financially_closed_status.getAttribute("data-id"),_code=update_financially_closed_status.getAttribute("data-code"),_actiontype=update_financially_closed_status.getAttribute("data-actiontype");if("open_fc_offering"==_actiontype)headermessage=(0,_str.get_string)("open_fc_confirm","local_trainingprogram"),bodymessage=(0,_str.get_string)("openfcofferingconfirm","local_trainingprogram",_code),footermessage=(0,_str.get_string)("yes","local_trainingprogram");else headermessage=(0,_str.get_string)("close_fc_confirm","local_trainingprogram"),bodymessage=(0,_str.get_string)("closefcofferingconfirm","local_trainingprogram",_code),footermessage=(0,_str.get_string)("yes","local_trainingprogram");_modal_factory.default.create({title:headermessage,type:_modal_factory.default.types.SAVE_CANCEL,body:bodymessage}).done(function(modal){this.modal=modal,modal.setSaveButtonText(footermessage),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.id=_id,params.code=_code,params.actiontype=_actiontype,_ajax.default.call([{methodname:"local_trainingprogram_update_offering_financially_closed_status",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}}))}}));

//# sourceMappingURL=entityaction.min.js.map