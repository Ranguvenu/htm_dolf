{"version":3,"file":"exams.min.js","sources":["../src/exams.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\nimport ModalForm from 'core_form/modalform';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalEvents from 'core/modal_events';\r\nimport Ajax from 'core/ajax';\r\nimport {get_string as getString} from 'core/str';\r\n\r\nconst Selectors = {\r\n    actions: {\r\n        createexam: '[data-action=\"createexam\"]',\r\n        deleteexam: '[data-action=\"deleteexam\"]',\r\n    },\r\n};\r\n\r\nexport const init = () => {\r\n    document.addEventListener('click', function(e) {\r\n        e.stopImmediatePropagation();\r\n        let element = e.target.closest(Selectors.actions.createexam);\r\n        if (element) {\r\n            e.preventDefault();\r\n            const title = element.getAttribute('data-id') ?\r\n                getString('editexam', 'local_exams', element.getAttribute('data-name')) :\r\n                getString('createexam', 'local_exams');\r\n            const form = new ModalForm({\r\n                formClass: 'local_exams\\\\form\\\\examsform',\r\n                args: {id: element.getAttribute('data-id')},\r\n                modalConfig: {title},\r\n                returnFocus: element,\r\n            });\r\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\r\n            form.show();\r\n        }\r\n        let deleteexam = e.target.closest(Selectors.actions.deleteexam);\r\n        if (deleteexam) {\r\n            const examid = deleteexam.getAttribute('data-id');\r\n            ModalFactory.create({\r\n                title: getString('deleteexam', 'local_exams'),\r\n                type: ModalFactory.types.SAVE_CANCEL,\r\n                body: getString('deleteallconfirm', 'local_exams')\r\n            }).done(function(modal) {\r\n                this.modal = modal;\r\n                modal.setSaveButtonText(getString('delete', 'local_exams'));\r\n                modal.getRoot().on(ModalEvents.save, function(e) {\r\n                    e.preventDefault();\r\n                    var params = {};\r\n                    params.examid = examid;\r\n                    var promise = Ajax.call([{\r\n                        methodname: 'local_deleteexam',\r\n                        args: params\r\n                    }]);\r\n                    promise[0].done(function() {\r\n                        window.location.reload(true);\r\n                    }).fail(function() {\r\n                        // do something with the exception\r\n                         //console.log('exception');\r\n                    });\r\n                }.bind(this));\r\n                modal.show();\r\n            }.bind(this));\r\n        }\r\n    });\r\n};"],"names":["Selectors","createexam","deleteexam","document","addEventListener","e","stopImmediatePropagation","element","target","closest","preventDefault","title","getAttribute","form","ModalForm","formClass","args","id","modalConfig","returnFocus","events","FORM_SUBMITTED","window","location","reload","show","examid","create","type","ModalFactory","types","SAVE_CANCEL","body","done","modal","setSaveButtonText","getRoot","on","ModalEvents","save","params","Ajax","call","methodname","fail","bind","this"],"mappings":"iiBAqBMA,kBACO,CACLC,WAAY,6BACZC,WAAY,4CAIA,WAChBC,SAASC,iBAAiB,SAAS,SAASC,GACxCA,EAAEC,+BACEC,QAAUF,EAAEG,OAAOC,QAAQT,kBAAkBC,eAC7CM,QAAS,CACTF,EAAEK,qBACIC,MAAQJ,QAAQK,aAAa,YAC/B,mBAAU,WAAY,cAAeL,QAAQK,aAAa,eAC1D,mBAAU,aAAc,eACtBC,KAAO,IAAIC,mBAAU,CACvBC,UAAW,+BACXC,KAAM,CAACC,GAAIV,QAAQK,aAAa,YAChCM,YAAa,CAACP,MAAAA,OACdQ,YAAaZ,UAEjBM,KAAKT,iBAAiBS,KAAKO,OAAOC,gBAAgB,kBAAMC,OAAOC,SAASC,YACxEX,KAAKY,WAELvB,WAAaG,EAAEG,OAAOC,QAAQT,kBAAkBE,eAChDA,WAAY,KACNwB,OAASxB,WAAWU,aAAa,kCAC1Be,OAAO,CAChBhB,OAAO,mBAAU,aAAc,eAC/BiB,KAAMC,uBAAaC,MAAMC,YACzBC,MAAM,mBAAU,mBAAoB,iBACrCC,KAAK,SAASC,YACRA,MAAQA,MACbA,MAAMC,mBAAkB,mBAAU,SAAU,gBAC5CD,MAAME,UAAUC,GAAGC,sBAAYC,KAAM,SAASlC,GAC1CA,EAAEK,qBACE8B,OAAS,GACbA,OAAOd,OAASA,OACFe,cAAKC,KAAK,CAAC,CACrBC,WAAY,mBACZ3B,KAAMwB,UAEF,GAAGP,MAAK,WACZX,OAAOC,SAASC,QAAO,MACxBoB,MAAK,gBAIVC,KAAKC,OACPZ,MAAMT,QACRoB,KAAKC"}