{"version":3,"file":"learningtracksform.min.js","sources":["../src/learningtracksform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\nimport ModalForm from 'core_form/modalform';\r\nimport ModalFactory from 'core/modal_factory';\r\nimport Ajax from 'core/ajax';\r\nimport {get_string as getString} from 'core/str';\r\nimport Templates from 'core/templates';\r\nimport ModalEvents from 'core/modal_events';\r\nimport $ from 'jquery';\r\n\r\nconst Selectors = {\r\n    actions: {\r\n        edittrack: '[data-action=\"edittracker\"]',\r\n        competencylist: '[data-action=\"competencylist\"]',\r\n        addlearningitems: '[data-action=\"addlearningitems\"]',\r\n        mapcompetencies: '[data-action=\"mapcompetencies\"]',\r\n        deletetrack: '[data-action=\"deletetrack\"]',\r\n        deleteitems: '[data-action=\"delete-items\"]'\r\n    },\r\n};\r\nexport const init = () => {\r\n    document.addEventListener('click', function(e) {\r\n            e.stopImmediatePropagation();\r\n            let element = e.target.closest(Selectors.actions.edittrack);\r\n            if (element) {\r\n                e.preventDefault();\r\n                const title = element.getAttribute('data-id') ?\r\n                getString('editlearningpath', 'local_learningtracks', element.getAttribute('data-name')) :\r\n                getString('addlearningpath', 'local_learningtracks');\r\n            const form = new ModalForm({\r\n                formClass: 'local_learningtracks\\\\form\\\\learningtrackform',\r\n                args: {id: element.getAttribute('data-id')},\r\n                modalConfig: {title},\r\n                returnFocus: element,\r\n            });\r\n                form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\r\n                form.show();\r\n            }\r\n\r\n            let viewcompetencies = e.target.closest(Selectors.actions.competencylist);\r\n            if (viewcompetencies) {\r\n            const trackid = viewcompetencies.getAttribute('data-id');\r\n            const addaction = viewcompetencies.getAttribute('data-addaction');\r\n                var options = {};\r\n                options.trackid = trackid;\r\n                options.addaction = addaction;\r\n                var trigger = $(Selectors.actions.viewcompetencies);\r\n                ModalFactory.create({\r\n                    title: getString('competency', 'local_learningtracks'),\r\n                    body: Templates.render('local_learningtracks/competencies_display',options)\r\n                }, trigger)\r\n                .done(function(modal) {\r\n                    modal.setLarge();\r\n                    modal.show();\r\n                    modal.getRoot().on(ModalEvents.hidden, function() {\r\n                    modal.destroy();\r\n                    }.bind(this));\r\n                });\r\n            }\r\n\r\n            let addlearningitems = e.target.closest(Selectors.actions.addlearningitems);\r\n            if (addlearningitems) {\r\n                e.preventDefault();\r\n                const title = getString('assignitems', 'local_learningtracks');\r\n            const form = new ModalForm({\r\n                formClass: 'local_learningtracks\\\\form\\\\learning_items_form',\r\n                args: {id: addlearningitems.getAttribute('data-id'), trackid: addlearningitems.getAttribute('data-trackid')},\r\n                modalConfig: {title},\r\n                returnFocus: addlearningitems,\r\n            });\r\n                form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\r\n                form.show();\r\n            }\r\n            let mapcompetencies = e.target.closest(Selectors.actions.mapcompetencies);\r\n            if (mapcompetencies) {\r\n                e.preventDefault();\r\n                const title = getString('mapcompetencies', 'local_learningtracks');\r\n                const form = new ModalForm({\r\n                    formClass: 'local_learningtracks\\\\form\\\\competenciesform',\r\n                    args: {id: mapcompetencies.getAttribute('data-id')},\r\n                    modalConfig: {title},\r\n                    returnFocus: mapcompetencies,\r\n                });\r\n                form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\r\n                form.show();\r\n            }\r\n            let deletetrack = e.target.closest(Selectors.actions.deletetrack);\r\n            if(deletetrack) {\r\n                const trackid = deletetrack.getAttribute('data-id');\r\n                const trackname = deletetrack.getAttribute('data-name');\r\n                const usercount = deletetrack.getAttribute('data-usercount');\r\n                if (usercount > 0) {\r\n                    ModalFactory.create({\r\n                        title: getString('confirmdelete', 'local_learningtracks'),\r\n                        body: getString('userunenroll', 'local_learningtracks')\r\n                    }).done(function(modal) {\r\n                        modal.show();\r\n                    }.bind(this));\r\n                } else {\r\n                    ModalFactory.create({\r\n                        title: getString('confirmdelete', 'local_learningtracks'),\r\n                        type: ModalFactory.types.SAVE_CANCEL,\r\n                        body: getString('deleteconfirm', 'local_learningtracks', trackname)\r\n                    }).done(function(modal) {\r\n                        this.modal = modal;\r\n                        modal.setSaveButtonText(getString('delete', 'local_learningtracks'));\r\n                        modal.getRoot().on(ModalEvents.save, function(e) {\r\n                            e.preventDefault();\r\n                            var params = {};\r\n                            params.confirm = true;\r\n                            params.trackid = trackid;\r\n                            var promise = Ajax.call([{\r\n                                methodname: 'local_learningtracks_deletetrack',\r\n                                args: params\r\n                            }]);\r\n                            promise[0].done(function() {\r\n                               // window.location.reload(true);\r\n                               window.location.href = M.cfg.wwwroot + '/local/learningtracks/index.php';\r\n                            }).fail(function() {\r\n                                // do something with the exception\r\n                            });\r\n                        }.bind(this));\r\n                        modal.show();\r\n                    }.bind(this));\r\n                }\r\n            }\r\n\r\n            let deleteitems = e.target.closest(Selectors.actions.deleteitems);\r\n            if(deleteitems) {\r\n                const trackid = deleteitems.getAttribute('data-id');\r\n                const trackname = deleteitems.getAttribute('data-name');\r\n                const usercount = deleteitems.getAttribute('data-usercount');\r\n                //if (usercount > 0) {\r\n                    /*ModalFactory.create({\r\n                        title: getString('confirmdelete', 'local_learningtracks'),\r\n                        body: getString('userunenroll', 'local_learningtracks')\r\n                    }).done(function(modal) {\r\n                        modal.show();\r\n                    }.bind(this));*/\r\n               // } else {\r\n                    ModalFactory.create({\r\n                        title: getString('confirmdelete', 'local_learningtracks'),\r\n                        type: ModalFactory.types.SAVE_CANCEL,\r\n                        body: getString('deleteconfirm', 'local_learningtracks', trackname)\r\n                    }).done(function(modal) {\r\n                        this.modal = modal;\r\n                        modal.setSaveButtonText(getString('delete', 'local_learningtracks'));\r\n                        modal.getRoot().on(ModalEvents.save, function(e) {\r\n                            e.preventDefault();\r\n                            var params = {};\r\n                            params.confirm = true;\r\n                            params.trackid = trackid;\r\n                            var promise = Ajax.call([{\r\n                                methodname: 'local_learningtracks_deleteitems',\r\n                                args: params\r\n                            }]);\r\n                            promise[0].done(function() {\r\n                                window.location.reload(true);\r\n                            }).fail(function() {\r\n                                // do something with the exception\r\n                            });\r\n                        }.bind(this));\r\n                        modal.show();\r\n                    }.bind(this));\r\n                //}\r\n            }\r\n    });\r\n};\r\n"],"names":["Selectors","actions","edittrack","competencylist","addlearningitems","mapcompetencies","deletetrack","deleteitems","document","addEventListener","e","stopImmediatePropagation","element","target","closest","preventDefault","title","getAttribute","form","ModalForm","formClass","args","id","modalConfig","returnFocus","events","FORM_SUBMITTED","window","location","reload","show","viewcompetencies","trackid","addaction","options","trigger","create","body","Templates","render","done","modal","setLarge","getRoot","on","ModalEvents","hidden","destroy","bind","this","trackname","type","ModalFactory","types","SAVE_CANCEL","setSaveButtonText","save","params","Ajax","call","methodname","href","M","cfg","wwwroot","fail"],"mappings":"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"}