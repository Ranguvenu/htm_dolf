define("local_learningtracks/learningtracksform",["exports","core_form/modalform","core/modal_factory","core/ajax","core/str","core/templates","core/modal_events","jquery"],(function(_exports,_modalform,_modal_factory,_ajax,_str,_templates,_modal_events,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_modal_events=_interopRequireDefault(_modal_events),_jquery=_interopRequireDefault(_jquery);const Selectors={actions:{edittrack:'[data-action="edittracker"]',competencylist:'[data-action="competencylist"]',addlearningitems:'[data-action="addlearningitems"]',mapcompetencies:'[data-action="mapcompetencies"]',deletetrack:'[data-action="deletetrack"]',deleteitems:'[data-action="delete-items"]'}};_exports.init=()=>{document.addEventListener("click",(function(e){e.stopImmediatePropagation();let element=e.target.closest(Selectors.actions.edittrack);if(element){e.preventDefault();const title=element.getAttribute("data-id")?(0,_str.get_string)("editlearningpath","local_learningtracks",element.getAttribute("data-name")):(0,_str.get_string)("addlearningpath","local_learningtracks"),form=new _modalform.default({formClass:"local_learningtracks\\form\\learningtrackform",args:{id:element.getAttribute("data-id")},modalConfig:{title:title},returnFocus:element});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}let viewcompetencies=e.target.closest(Selectors.actions.competencylist);if(viewcompetencies){const trackid=viewcompetencies.getAttribute("data-id"),addaction=viewcompetencies.getAttribute("data-addaction");var options={};options.trackid=trackid,options.addaction=addaction;var trigger=(0,_jquery.default)(Selectors.actions.viewcompetencies);_modal_factory.default.create({title:(0,_str.get_string)("competency","local_learningtracks"),body:_templates.default.render("local_learningtracks/competencies_display",options)},trigger).done((function(modal){modal.setLarge(),modal.show(),modal.getRoot().on(_modal_events.default.hidden,function(){modal.destroy()}.bind(this))}))}let addlearningitems=e.target.closest(Selectors.actions.addlearningitems);if(addlearningitems){e.preventDefault();const title=(0,_str.get_string)("assignitems","local_learningtracks"),form=new _modalform.default({formClass:"local_learningtracks\\form\\learning_items_form",args:{id:addlearningitems.getAttribute("data-id"),trackid:addlearningitems.getAttribute("data-trackid")},modalConfig:{title:title},returnFocus:addlearningitems});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}let mapcompetencies=e.target.closest(Selectors.actions.mapcompetencies);if(mapcompetencies){e.preventDefault();const title=(0,_str.get_string)("mapcompetencies","local_learningtracks"),form=new _modalform.default({formClass:"local_learningtracks\\form\\competenciesform",args:{id:mapcompetencies.getAttribute("data-id")},modalConfig:{title:title},returnFocus:mapcompetencies});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}let deletetrack=e.target.closest(Selectors.actions.deletetrack);if(deletetrack){const trackid=deletetrack.getAttribute("data-id"),trackname=deletetrack.getAttribute("data-name");deletetrack.getAttribute("data-usercount")>0?_modal_factory.default.create({title:(0,_str.get_string)("confirmdelete","local_learningtracks"),body:(0,_str.get_string)("userunenroll","local_learningtracks")}).done(function(modal){modal.show()}.bind(this)):_modal_factory.default.create({title:(0,_str.get_string)("confirmdelete","local_learningtracks"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deleteconfirm","local_learningtracks",trackname)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("delete","local_learningtracks")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={confirm:!0};params.trackid=trackid,_ajax.default.call([{methodname:"local_learningtracks_deletetrack",args:params}])[0].done((function(){window.location.href=M.cfg.wwwroot+"/local/learningtracks/index.php"})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}let deleteitems=e.target.closest(Selectors.actions.deleteitems);if(deleteitems){const trackid=deleteitems.getAttribute("data-id"),trackname=deleteitems.getAttribute("data-name");deleteitems.getAttribute("data-usercount");_modal_factory.default.create({title:(0,_str.get_string)("confirmdelete","local_learningtracks"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deleteconfirm","local_learningtracks",trackname)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("delete","local_learningtracks")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={confirm:!0};params.trackid=trackid,_ajax.default.call([{methodname:"local_learningtracks_deleteitems",args:params}])[0].done((function(){window.location.reload(!0)})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}}))}}));

//# sourceMappingURL=learningtracksform.min.js.map