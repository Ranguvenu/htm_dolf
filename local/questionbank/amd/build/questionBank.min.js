define("local_questionbank/questionBank",["exports","core_form/modalform","core/modal_factory","core/modal_events","theme_academy/homepage","core/ajax","core/str","jquery","core/templates","theme_academy/cardPaginate","core/config"],(function(_exports,_modalform,_modal_factory,_modal_events,_homepage,_ajax,_str,_jquery,_templates,_cardPaginate,_config){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_homepage=_interopRequireDefault(_homepage),_ajax=_interopRequireDefault(_ajax),_jquery=_interopRequireDefault(_jquery),_templates=_interopRequireDefault(_templates),_cardPaginate=_interopRequireDefault(_cardPaginate),_config=_interopRequireDefault(_config);const HomePage=new _homepage.default,Selectors_actions={deletequestionbank:'[data-action="deletequestionbank"]',viewquestiontopics:'[data-action="viewquestiontopics"]',viewexperts:'[data-action="viewexperts"]',viewcompetencies:'[data-action="viewcompetencies"]',deletecompetency:'[data-action="deletecompetency"]',deletecourse:'[data-action="deletecourse"]',assignexpert:'[data-action="assignexpert"]',unassignexpert:'[data-action="unassignexpert"]',mapcompetencies:'[data-action="mapcompetencies"]',assignopicstocourse:'[data-action="assignopicstocourse"]',unassigntopic:'[data-action="unassigntopic"]',changestatus:'[data-action="changestatus"]',assignreviewer:'[data-action="assignreviewer"]',programtabs:'[data-action="programtabs"]',movetoprodquestionbank:'[data-action="movetoprodquestionbank"]',viewtopics:'[data-action="viewtopics"]',selectedcourses:'[data-action="selectedcourses"]',bulkchangestatus:'[data-action="bulkchangestatus"]',submit:'[data-action="save"]',selectedexperts:'[role="option"]',cancelbtn:'[data-action="cancel"]'};_exports.init=()=>{document.addEventListener("click",(function(e){let deletequestionbank=e.target.closest(Selectors_actions.deletequestionbank);if(deletequestionbank){const workshopid=deletequestionbank.getAttribute("data-id"),workshopname=deletequestionbank.getAttribute("data-name");_modal_factory.default.create({title:(0,_str.get_string)("confirm","local_questionbank"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deleteconfirm","local_questionbank",workshopname)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("deletetext","local_questionbank")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.workshopid=workshopid,params.workshopname=workshopname,_ajax.default.call([{methodname:"local_questionbank_delete",args:params}])[0].done((function(){window.location.reload(!0)})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}let viewquestiontopics=e.target.closest(Selectors_actions.viewquestiontopics);if(viewquestiontopics){const workshopid=viewquestiontopics.getAttribute("data-id"),workshopname=viewquestiontopics.getAttribute("data-name");(params={}).workshopid=workshopid,params.workshopname=workshopname,(promise=_ajax.default.call([{methodname:"local_questionbank_viewtopics",args:params}]))[0].done((function(resp){_modal_factory.default.create({title:(0,_str.get_string)("viewtopics","local_questionbank"),type:_modal_factory.default.types.DEFAULT,body:resp.options}).done(function(modal){this.modal=modal,modal.setLarge(!0),modal.show()}.bind(this))})).fail((function(){}))}let unassigntopic=e.target.closest(Selectors_actions.unassigntopic);if(unassigntopic){const questionbankid=unassigntopic.getAttribute("data-id"),topicid=unassigntopic.getAttribute("data-topicid");_modal_factory.default.create({title:(0,_str.get_string)("unassignconfirmtopic","local_questionbank"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("unassigntopic","local_questionbank")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("unassign","local_questionbank")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.questionbankid=questionbankid,params.topicid=topicid,_ajax.default.call([{methodname:"local_questionbank_unassigntopics",args:params}])[0].done((function(){window.location.reload(!0)})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}let unassignexpert=e.target.closest(Selectors_actions.unassignexpert);if(unassignexpert){const questionbankid=unassignexpert.getAttribute("data-id"),username=unassignexpert.getAttribute("data-user");_modal_factory.default.create({title:(0,_str.get_string)("unassignconfirm","local_questionbank"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("unassignexpert","local_questionbank",username)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("unassign","local_questionbank")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.questionbankid=questionbankid,_ajax.default.call([{methodname:"local_questionbank_assignexperts",args:params}])[0].done((function(){window.location.reload(!0)})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}let assignexpert=e.target.closest(Selectors_actions.assignexpert);if(assignexpert){e.preventDefault();const title=(0,_str.get_string)("assignexperts","local_questionbank"),form=new _modalform.default({formClass:"local_questionbank\\form\\expertsform",args:{questionbankid:assignexpert.getAttribute("data-id")},modalConfig:{title:title},returnFocus:assignexpert});form.show(),form.addEventListener(form.events.FORM_SUBMITTED,(e=>{e.preventDefault();const spanElements=document.querySelectorAll(".badge");let allowed_questions=(0,_jquery.default)("#questionallowed").val();var sum=0,emptyinput=0;if(Array.from(spanElements).forEach((span=>{const dataValue=span.getAttribute("data-value");var selectedexperts=parseInt(dataValue,10);isNaN(selectedexperts)||"INPUT"==(0,_jquery.default)("#noofquestionsfor_"+selectedexperts)[0].tagName&&(isNaN(parseInt((0,_jquery.default)("#noofquestionsfor_"+selectedexperts).val()))?emptyinput++:sum+=parseInt((0,_jquery.default)("#noofquestionsfor_"+selectedexperts).val()))})),0==emptyinput){var savebtn=document.querySelector('div.modal-footer>button[data-action="save"]');console.log(sum);const inputs=document.querySelector(".mform").querySelectorAll("input");if(isNaN(sum))inputs.forEach((input=>{input.classList.add("is-invalid")})),savebtn.disabled=!0,HomePage.confirmbox((0,_str.get_string)("invalidvalue","local_questionbank"));else if(sum<=allowed_questions){let formdata=(0,_jquery.default)("form").serializeArray();var data=JSON.stringify(formdata);_jquery.default.ajax({url:_config.default.wwwroot+"/local/questionbank/process.php",type:"POST",data:{jsonformdata:data},success:function(response){var resp=JSON.parse(response);console.log(resp),1==resp.status?window.location.reload():HomePage.confirmbox((0,_str.get_string)("somethingwentwrong","local_questionbank"))}})}else inputs.forEach((input=>{input.classList.add("is-invalid")})),savebtn.disabled=!0,HomePage.confirmbox((0,_str.get_string)("cannotaddmorequestions","local_questionbank",allowed_questions))}else HomePage.confirmbox((0,_str.get_string)("questionnum_cannotbenull","local_questionbank"))}));var savebtn=document.querySelector('div.modal-footer>button[data-action="save"]');console.log(savebtn),savebtn.disabled=!0}let bulkchangestatus=e.target.closest(Selectors_actions.bulkchangestatus),questionselected=[];if(bulkchangestatus){bulkchangestatus.disabled=!0;document.querySelectorAll('input[type="checkbox"]').forEach((function(checkbox){if(checkbox.checked){let questionid=parseInt(checkbox.value);questionid&&questionselected.push(questionid)}}));let params={};if(0!==questionselected.length)if(status=(0,_jquery.default)("#bulkquestion_statusupdate").val(),""==status)bulkchangestatus.disabled=!1,HomePage.confirmbox((0,_str.get_string)("no_status_selected","local_questionbank"));else{bulkchangestatus.disabled=!0,params.questionids=questionselected.join(","),params.wid=bulkchangestatus.getAttribute("data-wid"),params.status=status;var promise=_ajax.default.call([{methodname:"local_bulk_update_question_status",args:params}]);promise[0].done((function(resp){window.location.reload()})).fail((function(){bulkchangestatus.disabled=!1}))}else bulkchangestatus.disabled=!1,HomePage.confirmbox((0,_str.get_string)("noquestion_selected","local_questionbank"))}let assignopicstocourse=e.target.closest(Selectors_actions.assignopicstocourse);if(assignopicstocourse){e.preventDefault();const title=(0,_str.get_string)("assignopicstocourse","local_questionbank",assignopicstocourse.getAttribute("data-name")),form=new _modalform.default({formClass:"local_questionbank\\form\\topicsform",args:{questionbankid:assignopicstocourse.getAttribute("data-id")},modalConfig:{title:title},returnFocus:assignopicstocourse});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}let viewtopics=e.target.closest(Selectors_actions.viewtopics);if(viewtopics){e.preventDefault();const questionid=viewtopics.getAttribute("data-id"),workshopid=viewtopics.getAttribute("data-workshop"),questionname=viewtopics.getAttribute("data-name");(params={}).workshopid=workshopid,params.questionid=questionid,params.questionname=questionname,(promise=_ajax.default.call([{methodname:"local_questionbank_displaytopics",args:params}]))[0].done((function(resp){_modal_factory.default.create({title:(0,_str.get_string)("targettopic","local_questionbank",viewtopics.getAttribute("data-name")),type:_modal_factory.default.types.DEFAULT,body:resp.options}).done(function(modal){this.modal=modal,modal.show()}.bind(this))})).fail((function(){}))}let viewexperts=e.target.closest(Selectors_actions.viewexperts);if(viewexperts){const workshopid=viewexperts.getAttribute("data-id"),availableseats=viewexperts.getAttribute("data-seats"),qbstatus=(viewexperts.getAttribute("data-name"),viewexperts.getAttribute("data-qbstatus"));(options={}).workshopid=workshopid,options.availableseats=availableseats,options.qbstatus=qbstatus;var trigger=(0,_jquery.default)(Selectors_actions.viewexperts);_modal_factory.default.create({title:(0,_str.get_string)("experts","local_questionbank"),body:_templates.default.render("local_questionbank/viewexperts",options)},trigger).done((function(modal){modal.show(),modal.setLarge(!0),modal.getRoot().on(_modal_events.default.hidden,function(){modal.destroy()}.bind(this))}))}let mapcompetencies=e.target.closest(Selectors_actions.mapcompetencies);if(mapcompetencies){e.preventDefault();const title=(0,_str.get_string)("mapcompetencies","local_trainingprogram"),form=new _modalform.default({formClass:"local_questionbank\\form\\competencieslistform",args:{id:mapcompetencies.getAttribute("data-id")},modalConfig:{title:title},returnFocus:mapcompetencies});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}let viewcompetencies=e.target.closest(Selectors_actions.viewcompetencies);if(viewcompetencies){const workshopid=viewcompetencies.getAttribute("data-id");var options;(options={}).workshopid=workshopid;trigger=(0,_jquery.default)(Selectors_actions.viewcompetencies);_modal_factory.default.create({title:(0,_str.get_string)("viewcompetencies","local_questionbank"),body:_templates.default.render("local_questionbank/competencies_display",options)},trigger).done((function(modal){modal.setLarge(),modal.show(),modal.getRoot().on(_modal_events.default.hidden,function(){modal.destroy()}.bind(this))}))}let deletecompetency=e.target.closest(Selectors_actions.deletecompetency);if(deletecompetency){const competencyid=deletecompetency.getAttribute("data-id"),wid=deletecompetency.getAttribute("data-wid"),competencyname=deletecompetency.getAttribute("data-name");_modal_factory.default.create({title:(0,_str.get_string)("unassigncompetency","local_questionbank"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deletecompetencyconfirm","local_questionbank",competencyname)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("unassign","local_questionbank")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.competencyid=competencyid,params.wid=wid,params.competencyname=competencyname,_ajax.default.call([{methodname:"local_questionbank_deletecompetency",args:params}])[0].done((function(){window.location.reload(!0)})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}let deletecourse=e.target.closest(Selectors_actions.deletecourse);if(deletecourse){const courseid=deletecourse.getAttribute("data-id"),wid=deletecourse.getAttribute("data-wid"),coursename=deletecourse.getAttribute("data-name");_modal_factory.default.create({title:(0,_str.get_string)("unassigncourse","local_questionbank"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deletecourseconfirm","local_questionbank",coursename)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("unassign","local_questionbank")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.courseid=courseid,params.wid=wid,params.coursename=coursename,_ajax.default.call([{methodname:"local_questionbank_deletecourse",args:params}])[0].done((function(){window.location.reload(!0)})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}let changestatus=e.target.closest(Selectors_actions.changestatus);if(changestatus){e.preventDefault();const questionid=changestatus.getAttribute("data-id"),status=(0,_jquery.default)("#status"+questionid).val(),hidestatus=changestatus.getAttribute("data-hidestatus"),statusText=(0,_jquery.default)("#status"+questionid+" option:selected").text(),workshopid=changestatus.getAttribute("data-wid");(params={}).questionid=questionid,params.workshopid=workshopid,params.status=status,(promise=_ajax.default.call([{methodname:"local_questionbank_changestatus",args:params}]))[0].done((function(res){(0,_jquery.default)(".questioncreation_page #status_span"+questionid).text(statusText),"Publish"==statusText&&1!=hidestatus&&(0,_jquery.default)(".questioncreation_page #status_change"+questionid).hide(),"Publish"==statusText&&(0,_jquery.default)(".questioncreation_page #assignreviewerto"+questionid).hide(),HomePage.confirmbox((0,_str.get_string)("questionstatus","local_questionbank",statusText))})).fail((function(){}))}let assignreviewer=e.target.closest(Selectors_actions.assignreviewer);if(assignreviewer){e.preventDefault();const questionid=assignreviewer.getAttribute("data-id"),reviewerid=(0,_jquery.default)("#reviewer"+questionid).val(),dropdown=document.getElementById("reviewer"+questionid),reviewername=dropdown.options[dropdown.selectedIndex].text,workshopid=(assignreviewer.getAttribute("data-status"),assignreviewer.getAttribute("data-wid"));var params;(params={}).reviewerid=reviewerid,params.questionid=questionid,params.workshopid=workshopid,(promise=_ajax.default.call([{methodname:"local_questionbank_assignreviewer",args:params}]))[0].done((function(response){var dropdown=document.querySelector("#reviewer"+params.questionid);dropdown.options=[],dropdown.innerHTML=response.options,(0,_jquery.default)(".questioncreation_page #reviewer_span"+questionid).text(reviewername),HomePage.confirmbox((0,_str.get_string)("reviewerinfo","local_questionbank",reviewername))})).fail((function(){}))}let movetoprodquestionbank=e.target.closest(Selectors_actions.movetoprodquestionbank);if(movetoprodquestionbank){e.preventDefault();const title=(0,_str.get_string)("moveqcategory","local_questionbank"),form=new _modalform.default({formClass:"local_questionbank\\form\\questioncategoryform",args:{workshopid:movetoprodquestionbank.getAttribute("data-id"),qcategoryid:movetoprodquestionbank.getAttribute("data-qcat")},modalConfig:{title:title},returnFocus:movetoprodquestionbank});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}let qtypeform=document.getElementById("chooserform");qtypeform&&(qtypeform.action=M.cfg.wwwroot+"/local/questionbank/editquestion.php")}));let currentuserrole=document.querySelector("#currentuserrole"),id_updatecategory=document.querySelector("#id_updatecategory"),fitem_id_defaultmark=document.querySelector("#fitem_id_defaultmark"),fitem_id_generalfeedback=document.querySelector("#fitem_id_generalfeedback"),fitem_id_idnumber=document.querySelector("#fitem_id_idnumber"),categoryfield=document.querySelector("#fitem_id_category"),fitem_id_usecase=document.querySelector("#fitem_id_usecase"),fitem_id_single=document.querySelector("#fitem_id_single"),fitem_id_answernumbering=document.querySelector("#fitem_id_answernumbering"),fitem_id_showstandardinstruction=document.querySelector("#fitem_id_showstandardinstruction");var checkbox=document.querySelector("#id_generalheadercontainer > div:nth-child(9) > div.col-md-9.checkbox");let fgroup_id_currentgrp=document.querySelector("#fgroup_id_currentgrp"),fitem_id_categorymoveto=document.querySelector("#fitem_id_categorymoveto");if("expert"==currentuserrole.innerText){categoryfield&&(categoryfield.style="display:none"),id_updatecategory&&(id_updatecategory.style="display:none"),fitem_id_defaultmark&&(fitem_id_defaultmark.style="display:none"),fitem_id_generalfeedback&&(fitem_id_generalfeedback.style="display:none"),fitem_id_idnumber&&(fitem_id_idnumber.style="display:none"),fitem_id_usecase&&(fitem_id_usecase.style="display:none"),fitem_id_single&&(fitem_id_single.style="display:none"),fitem_id_answernumbering&&(fitem_id_answernumbering.style="display:none"),fitem_id_showstandardinstruction&&(fitem_id_showstandardinstruction.style="display:none"),fitem_id_usecase&&(fitem_id_usecase.style="display:none"),checkbox&&(checkbox.style.display="none"),fgroup_id_currentgrp&&(fgroup_id_currentgrp.style="display:none"),fitem_id_categorymoveto&&(fitem_id_categorymoveto.style="display:none"),document.querySelectorAll("fieldset").forEach((function(fieldset){if("id_generalheader"!==fieldset.id&&"id_answerhdr"!==fieldset.id){var classes=fieldset.attributes.class.nodeValue;console.log(classes),"clearfix"==classes.split(" ")[0]&&(fieldset.style="display:none")}}))}}}));

//# sourceMappingURL=questionBank.min.js.map