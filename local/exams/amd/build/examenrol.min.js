define("local_exams/examenrol",["exports","local_trainingprogram/dynamicform","core_form/dynamicform","core/str","core/modal_factory","core_form/modalform","core/modal_events","core/ajax","core/templates","core/notification"],(function(_exports,_dynamicform,_dynamicform2,_str,_modal_factory,_modalform,_modal_events,_ajax,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_dynamicform2=_interopRequireDefault(_dynamicform2),_modal_factory=_interopRequireDefault(_modal_factory),_modalform=_interopRequireDefault(_modalform),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);const Selectors_actions={editexamenrol:'[data-action="editexamenrol"]'};_exports.init=()=>{document.addEventListener("click",(function(e){e.stopImmediatePropagation();let element=e.target.closest(Selectors_actions.editexamenrol);if(element){e.preventDefault();const title=element.getAttribute("data-id")?(0,_str.get_string)("editexamenrol","local_exams",element.getAttribute("data-name")):(0,_str.get_string)("editexamenrol","local_exams"),form=new _dynamicform.default({formClass:"local_exams\\form\\examenrolform",args:{id:element.getAttribute("data-id")},modalConfig:{title:title},returnFocus:element});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}}));let selectElement=document.querySelector(".unenrolled_users");const examid=selectElement.getAttribute("data-examid"),productid=selectElement.getAttribute("data-productid"),entitytype=selectElement.getAttribute("data-entitytype"),refundtype=selectElement.getAttribute("data-refundtype"),productprice=selectElement.getAttribute("data-productprice"),ownedby=selectElement.getAttribute("data-ownedby"),examname=selectElement.getAttribute("data-examname"),profileid=selectElement.getAttribute("data-profileid");var is_assessmentop=document.querySelector("#currentuserrole").getAttribute("data-value");"CISI"==ownedby&&"assessmentop"==is_assessmentop&&(document.querySelector(".mform").style="opacity:0.5; pointer-events: none;cursor: not-allowed;");$(".enrollusers").click((function(e){if("assessmentop"==is_assessmentop){e.preventDefault();const userarray=Array.from(selectElement.selectedOptions).map((option=>option.value)),userids=userarray.join(),num_users=userarray.length,form=document.getElementById("user_un_assign"),organization=document.getElementById("id_organizationusers"),selectedOrganization=organization.value;organization.options[organization.selectedIndex].text;if("CISI"==ownedby)document.querySelector(".mform").style="opacity:0.5; pointer-events: none;cursor: not-allowed;";else if(selectedOrganization){var params={};params.productid=productid,params.userid=userids,params.entitytype=entitytype,params.refundtype=refundtype,params.productprice=productprice;let strs={};if(strs.productprice=productprice,strs.num_users=num_users,strs.examname=examname,0==params.productprice){var confrmstring=(0,_str.get_string)("examenrolment_confirm","local_exams",strs);_modal_factory.default.create({title:(0,_str.get_string)("examenrolment","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:confrmstring}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("erollusers","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){form.submit()}.bind(this)),modal.show()}.bind(this))}else{confrmstring=(0,_str.get_string)("paid_examenrolment_confirm","local_exams",strs);_modal_factory.default.create({title:(0,_str.get_string)("examenrolment","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:confrmstring}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("click_continue","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_ajax.default.call([{methodname:"local_exams_get_org_officials",args:{orgid:selectedOrganization}}])[0].done((function(resp){console.log(resp),_modal_factory.default.create({title:(0,_str.get_string)("orgInvoceSummay","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:resp.officials}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("showinvoice","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();const orgOfficial=document.querySelector("#id_org_official"),selectedorgOfficial=orgOfficial.value;console.log(selectedorgOfficial);orgOfficial.options[orgOfficial.selectedIndex].text;selectedorgOfficial&&_ajax.default.call([{methodname:"local_exams_calculate_invoice",args:{productprice:productprice,num_users:num_users,orgid:selectedOrganization,org_officialid:selectedorgOfficial,examid:examid}}])[0].done((function(resp){console.log(resp),_modal_factory.default.create({title:(0,_str.get_string)("invoice","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:resp.invoice}).done(function(modal){modal.setSaveButtonText((0,_str.get_string)("confirmsendinvoice","local_exams")),this.modal=modal,modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_ajax.default.call([{methodname:"local_exams_send_invoice",args:{productprice:productprice,users:userids,profileid:profileid,examid:examid,productid:productid,orgid:selectedOrganization,orgofficial:selectedorgOfficial}}])[0].done((function(resp){console.log(resp),"success"==resp.status&&($("#invoice-container").empty(),$("#invoice-container").append(resp.msg),form.submit(),this.modal.destroy())})).fail((function(exception){var error=(0,_str.get_string)("exception","local_exams"),ok=(0,_str.get_string)("ok");console.log(exception),_notification.default.alert(error,exception.message,ok)}))}.bind(this)),modal.show()}.bind(this))}))}.bind(this)),modal.show()}.bind(this))}))}.bind(this)),modal.show()}.bind(this))}}else{var error=(0,_str.get_string)("error"),message=(0,_str.get_string)("missingorg","local_exams"),ok=(0,_str.get_string)("ok");_notification.default.alert(error,message,ok)}}}))}}));

//# sourceMappingURL=examenrol.min.js.map