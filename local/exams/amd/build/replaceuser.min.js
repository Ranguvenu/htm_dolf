define("local_exams/replaceuser",["exports","local_trainingprogram/dynamicform","core_form/modalform","core/modal_factory","core/modal_events","theme_academy/homepage","core/ajax","core/templates","core/str"],(function(_exports,_dynamicform,_modalform,_modal_factory,_modal_events,_homepage,_ajax,_templates,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_homepage=_interopRequireDefault(_homepage),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates);const Selectors_actions={replaceuser:'[data-action="replaceuser"]',editprofilecode:'[data-action="profilecode"]',edituser:'[data-action="users"]'};let HomePage=new _homepage.default;_exports.init=()=>{document.addEventListener("click",(function(e){let profilecode=e.target.closest(Selectors_actions.editprofilecode);if(profilecode){e.preventDefault();const title=(0,_str.get_string)("updateprofilecode","local_exams"),form=new _modalform.default({formClass:"local_exams\\form\\updateprofilecode",args:{id:profilecode.getAttribute("data-id"),profileid:profilecode.getAttribute("data-profileid"),examid:profilecode.getAttribute("data-examid"),userid:profilecode.getAttribute("data-userid")},modalConfig:{title:title},returnFocus:profilecode});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}let listorg=e.target.closest(Selectors_actions.edituser);if(listorg){e.preventDefault();const title=(0,_str.get_string)("edituser","local_exams"),form=new _modalform.default({formClass:"local_exams\\form\\updateuser",args:{id:listorg.getAttribute("data-id"),examid:listorg.getAttribute("data-examid"),userid:listorg.getAttribute("data-userid")},modalConfig:{title:title},returnFocus:listorg});form.addEventListener(form.events.FORM_SUBMITTED,(()=>window.location.reload())),form.show()}let replaceuser=e.target.closest(Selectors_actions.replaceuser);if(replaceuser){e.preventDefault(),e.stopImmediatePropagation();const productid=replaceuser.getAttribute("data-productid"),userid=replaceuser.getAttribute("data-userid"),username=replaceuser.getAttribute("data-username"),entityname=replaceuser.getAttribute("data-entityname"),costtype=replaceuser.getAttribute("data-costtype"),replacementfee=(replaceuser.getAttribute("data-useridnumber"),replaceuser.getAttribute("data-replacementfee")),isadmin=replaceuser.getAttribute("data-issiteadmin"),entitytype=replaceuser.getAttribute("data-entitytype"),orgofficialenrolled=replaceuser.getAttribute("data-orgofficialenrolled"),ownedby=replaceuser.getAttribute("data-ownedby"),cangenerateinvoice=replaceuser.getAttribute("data-cangenerateinvoice");var displayparams={};displayparams.username=username,displayparams.entityname=entityname,displayparams.isadmin=isadmin,_modal_factory.default.create({title:(0,_str.get_string)("replaceconfirm","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("replaceconfirmmessage","local_exams",displayparams)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("replace","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){if("CISI"==ownedby||"CII"==ownedby)HomePage.confirmbox((0,_str.get_string)("notallowedtoreplacemessage","local_exams"));else if(e.preventDefault(),e.stopImmediatePropagation(),modal.hide(),0==costtype||1==isadmin&&0==orgofficialenrolled||0==cangenerateinvoice){const title=(0,_str.get_string)("replaceuser","local_exams"),form=new _dynamicform.default({formClass:"local_exams\\form\\replaceuserform",args:{productid:replaceuser.getAttribute("data-productid"),userid:replaceuser.getAttribute("data-userid"),username:replaceuser.getAttribute("data-username"),useridnumber:replaceuser.getAttribute("data-useridnumber"),entitytype:replaceuser.getAttribute("data-entitytype"),costtype:replaceuser.getAttribute("data-costtype"),policyconfirm:0},modalConfig:{title:title},returnFocus:replaceuser});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{let productdata;event.preventDefault(),e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref2=>{let{html:html,js:js}=_ref2;_templates.default.appendNodeContents(".modal-content",html,js)})),productdata=event.detail,console.log(productdata);var replaceparams={};replaceparams.productid=productdata.productid,replaceparams.rootid=productdata.rootid,replaceparams.fieldid=productdata.fieldid,replaceparams.fromuserid=productdata.fromuserid,replaceparams.touserid=productdata.touserid,replaceparams.replacementfee=replacementfee,replaceparams.entitytype=entitytype,replaceparams.policyconfirm=0,replaceparams.costtype=costtype,replaceparams.enrollinguserid=productdata.enrollinguserid,replaceparams.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_replaceuser",args:replaceparams}])[0].done((function(resp){"success"==resp.response?window.location="exam"==entitytype?M.cfg.wwwroot+"/local/exams/examusers.php?id="+productdata.rootid:"trainingprogram"==entitytype?M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+productdata.rootid:M.cfg.wwwroot+"/local/events/attendees.php?id="+productdata.rootid:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(err){HomePage.confirmbox(err.message)}))})),form.show()}else if(1==isadmin&&1==orgofficialenrolled){modal.hide();const title=(0,_str.get_string)("reasonreplace","local_exams"),form=new _dynamicform.default({formClass:"local_exams\\form\\reasonform",args:{entitytype:entitytype,userid:userid,productid:productid},modalConfig:{title:title},returnFocus:replaceuser});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{const data=event.detail;if(_templates.default.renderForPromise("tool_product/loader",{}).then((_ref3=>{let{html:html,js:js}=_ref3;_templates.default.appendNodeContents(".modal-content",html,js)})),data.policy>0){_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("replacementproceedmessage","local_exams",replacementfee)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),e.stopImmediatePropagation(),modal.hide();const title=(0,_str.get_string)("replaceuser","local_exams"),form=new _dynamicform.default({formClass:"local_exams\\form\\replaceuserform",args:{productid:replaceuser.getAttribute("data-productid"),userid:replaceuser.getAttribute("data-userid"),username:replaceuser.getAttribute("data-username"),useridnumber:replaceuser.getAttribute("data-useridnumber"),entitytype:replaceuser.getAttribute("data-entitytype"),costtype:replaceuser.getAttribute("data-costtype"),policyconfirm:1},modalConfig:{title:title},returnFocus:replaceuser});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{let productdata;event.preventDefault(),e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref4=>{let{html:html,js:js}=_ref4;_templates.default.appendNodeContents(".modal-content",html,js)})),productdata=event.detail,console.log(productdata);var replaceparams={};replaceparams.productid=productdata.productid,replaceparams.rootid=productdata.rootid,replaceparams.fieldid=productdata.fieldid,replaceparams.fromuserid=productdata.fromuserid,replaceparams.touserid=productdata.touserid,replaceparams.replacementfee=replacementfee,replaceparams.entitytype=entitytype,replaceparams.policyconfirm=1,replaceparams.costtype=costtype,replaceparams.enrollinguserid=productdata.enrollinguserid,replaceparams.cangenerateinvoice=cangenerateinvoice;var promise=_ajax.default.call([{methodname:"local_exams_replaceuser",args:replaceparams}]);_templates.default.render("tool_product/loader"),promise[0].done((function(resp){"success"==resp.response?window.location="exam"==entitytype?M.cfg.wwwroot+"/local/exams/examusers.php?id="+productdata.rootid:"trainingprogram"==entitytype?M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+productdata.rootid:M.cfg.wwwroot+"/local/events/attendees.php?id="+productdata.rootid:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(err){HomePage.confirmbox(err.message)}))})),form.show()}.bind(this)),modal.show()}.bind(this))}else{e.preventDefault(),e.stopImmediatePropagation(),modal.hide();const title=(0,_str.get_string)("replaceuser","local_exams"),form=new _dynamicform.default({formClass:"local_exams\\form\\replaceuserform",args:{productid:replaceuser.getAttribute("data-productid"),userid:replaceuser.getAttribute("data-userid"),username:replaceuser.getAttribute("data-username"),useridnumber:replaceuser.getAttribute("data-useridnumber"),entitytype:replaceuser.getAttribute("data-entitytype"),costtype:replaceuser.getAttribute("data-costtype"),policyconfirm:0},modalConfig:{title:title},returnFocus:replaceuser});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{let productdata;event.preventDefault(),e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref5=>{let{html:html,js:js}=_ref5;_templates.default.appendNodeContents(".modal-content",html,js)})),productdata=event.detail,console.log(productdata);var replaceparams={};replaceparams.productid=productdata.productid,replaceparams.rootid=productdata.rootid,replaceparams.fieldid=productdata.fieldid,replaceparams.fromuserid=productdata.fromuserid,replaceparams.touserid=productdata.touserid,replaceparams.replacementfee=replacementfee,replaceparams.entitytype=entitytype,replaceparams.policyconfirm=0,replaceparams.costtype=costtype,replaceparams.enrollinguserid=productdata.enrollinguserid,replaceparams.cangenerateinvoice=cangenerateinvoice;var promise=_ajax.default.call([{methodname:"local_exams_replaceuser",args:replaceparams}]);_templates.default.render("tool_product/loader"),promise[0].done((function(resp){"success"==resp.response?window.location="exam"==entitytype?M.cfg.wwwroot+"/local/exams/examusers.php?id="+productdata.rootid:"trainingprogram"==entitytype?M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+productdata.rootid:M.cfg.wwwroot+"/local/events/attendees.php?id="+productdata.rootid:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(err){HomePage.confirmbox(err.message)}))})),form.show()}})),form.show()}else _modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("replacementproceedmessage","local_exams",replacementfee)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),e.stopImmediatePropagation(),modal.hide();const title=(0,_str.get_string)("replaceuser","local_exams"),form=new _dynamicform.default({formClass:"local_exams\\form\\replaceuserform",args:{productid:replaceuser.getAttribute("data-productid"),userid:replaceuser.getAttribute("data-userid"),username:replaceuser.getAttribute("data-username"),useridnumber:replaceuser.getAttribute("data-useridnumber"),entitytype:replaceuser.getAttribute("data-entitytype"),costtype:replaceuser.getAttribute("data-costtype")},modalConfig:{title:title},returnFocus:replaceuser});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{let productdata;event.preventDefault(),e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref6=>{let{html:html,js:js}=_ref6;_templates.default.appendNodeContents(".modal-content",html,js)})),productdata=event.detail,console.log(productdata);var replaceparams={};replaceparams.productid=productdata.productid,replaceparams.rootid=productdata.rootid,replaceparams.fieldid=productdata.fieldid,replaceparams.fromuserid=productdata.fromuserid,replaceparams.touserid=productdata.touserid,replaceparams.replacementfee=replacementfee,replaceparams.entitytype=entitytype,replaceparams.policyconfirm=1,replaceparams.costtype=costtype,replaceparams.enrollinguserid=productdata.enrollinguserid,replaceparams.cangenerateinvoice=cangenerateinvoice;var promise=_ajax.default.call([{methodname:"local_exams_replaceuser",args:replaceparams}]);_templates.default.render("tool_product/loader"),promise[0].done((function(resp){"success"==resp.response?window.location="exam"==entitytype?M.cfg.wwwroot+"/local/exams/examusers.php?id="+productdata.rootid:"trainingprogram"==entitytype?M.cfg.wwwroot+"/local/trainingprogram/programenrolleduserslist.php?programid="+productdata.rootid:M.cfg.wwwroot+"/local/events/attendees.php?id="+productdata.rootid:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(err){HomePage.confirmbox(err.message)}))})),form.show()}.bind(this)),modal.show()}.bind(this))}.bind(this)),modal.show()}.bind(this))}}))}}));

//# sourceMappingURL=replaceuser.min.js.map