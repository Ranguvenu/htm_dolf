define("local_exams/attemptpurchase",["exports","core_form/modalform","core/modal_factory","core/modal_events","core/ajax","theme_academy/homepage","core/templates","core/str","jquery"],(function(_exports,_modalform,_modal_factory,_modal_events,_ajax,_homepage,_templates,_str,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_homepage=_interopRequireDefault(_homepage),_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery);const Selectors_actions={purcahsenextattempt:'[data-action="purcahsenextattempt"]'};let HomePage=new _homepage.default;_exports.init=()=>{document.addEventListener("click",(function(e){e.stopImmediatePropagation();let attemptpurchase=e.target.closest(Selectors_actions.purcahsenextattempt);if(attemptpurchase){const examid=attemptpurchase.getAttribute("data-examid"),userid=attemptpurchase.getAttribute("data-tuserid"),profileid=attemptpurchase.getAttribute("data-profileid"),lastattemptprofileid=attemptpurchase.getAttribute("data-lastattemptprofileid"),hallscheduleid=attemptpurchase.getAttribute("data-scheduleid"),purchasinguser=attemptpurchase.getAttribute("data-purchasinguser");_modal_factory.default.create({title:(0,_str.get_string)("confirm","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("purchaseconfirm","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("yes","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_ajax.default.call([{methodname:"local_exams_attempt_request",args:{examid:examid,userid:userid,profileid:profileid,lastattemptprofileid:lastattemptprofileid,hallscheduleid:hallscheduleid}}])[0].done((response=>{response.status?window.location="orgoff"==purchasinguser?M.cfg.wwwroot+"/local/exams/examdetails.php?id="+examid+"&tuserid="+userid:M.cfg.wwwroot+"/local/exams/hallschedule.php?examid="+examid+"&profileid="+profileid+"&tuserid="+userid:HomePage.confirmbox(response.response)})).fail((error=>{HomePage.confirmbox(error.error)}))}.bind(this)),modal.show()}.bind(this))}}))}}));

//# sourceMappingURL=attemptpurchase.min.js.map