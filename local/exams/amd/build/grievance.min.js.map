{"version":3,"file":"grievance.min.js","sources":["../src/grievance.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n// import ModalForm from 'local_trainingprogram/dynamicform';\nimport Modalform from 'core_form/modalform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nimport $ from 'jquery';\n\nconst Selectors = {\n    actions: {\n        addgrievance: '[data-action=\"addgrievance\"]',\n        viewgrievance: '[data-action=\"viewgrievance\"]',\n        grievancestatus: '[data-action=\"grievancestatus\"]',\n        grievancedetails: '[data-action=\"grievancedetails\"]',\n        examschedules: '[data-action=\"examschedules\"]',\n    },\n};\n\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        e.stopImmediatePropagation();\n        let grievance = e.target.closest(Selectors.actions.addgrievance);\n        if (grievance) {\n            e.preventDefault();\n            const title = getString('submitgrievance', 'local_exams');\n            const form = new Modalform({\n                formClass: 'local_exams\\\\form\\\\grievanceform',\n                args: {examid: grievance.getAttribute('data-examid'), userid: grievance.getAttribute('data-userid'), profileid: grievance.getAttribute('data-profileid')},\n                modalConfig: {title},\n                returnFocus: grievance,\n            });\n            // form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n            form.addEventListener(form.events.FORM_SUBMITTED, (event) => {\n                Templates.render('tool_product/add_order_seats',{product_attributes:event.detail.returnparams})\n                .then(function(html, js) {\n\n                    $('[data-region=\"grievance-order-summary\"]').html(html);\n\n                    $('[data-region=\"grievance-order-summary\"]').append(event.detail.returnurlbtn);\n\n                    Templates.runTemplateJS(js);    \n\n                    return;\n                })\n                .always(function() {\n                    return;\n                })\n                .fail();\n\n            });\n            form.show();\n        }\n\n        let viewgrievance = e.target.closest(Selectors.actions.viewgrievance);\n        if (viewgrievance) {\n            const examid = viewgrievance.getAttribute('data-examid');\n            const userid = viewgrievance.getAttribute('data-userid');\n            var params = {};\n            params.examid = examid;\n            params.userid = userid;\n            params.temp = 'grievance_list';\n            params.methodName = 'local_exams_grievance_info';\n            var trigger = $(Selectors.actions.viewgrievance);\n            ModalFactory.create({\n            title: getString('viewgrievance', 'local_exams'),\n            body: Templates.render('local_exams/grievance_cardview',params).done(function(html, js) {\n                        Templates.replaceNodeContents('targetgrievance', html, js);\n                    })\n            }, trigger)\n            .done(function(modal) {\n                modal.show();\n                modal.setLarge();\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                modal.hide();\n                modal.destroy();\n            }.bind(this));\n            });\n        }\n\n        let grievancestatus = e.target.closest(Selectors.actions.grievancestatus);\n        if (grievancestatus) {\n            const grievanceid = grievancestatus.getAttribute('data-id');\n            //const header = grievancestatus.getAttribute('data-title');\n            const status = grievancestatus.getAttribute('data-status');\n            if(status ==\"2\") {\n                var confirm_msg = getString('approveconfirm', 'local_exams');\n                var buttonstring = getString('approve','local_exams');\n            } else {\n                var confirm_msg = getString('rejectconfirm', 'local_exams');\n                var buttonstring = getString('reject', 'local_exams');\n            }\n            ModalFactory.create({\n                title: '',\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: confirm_msg\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(buttonstring);\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.confirm = true;\n                    params.grievanceid = grievanceid;\n                    params.status = status;\n                    var promise = Ajax.call([{\n                        methodname: 'local_exams_grievancestatus',\n                        args: params\n                    }]);\n                    promise[0].done(function() {\n                        window.location.reload(true);\n                    }).fail(function() {\n                        // do something with the exception\n                    });\n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n\n        let grievancedetails = e.target.closest(Selectors.actions.grievancedetails);\n        if (grievancedetails) {\n            const greivanceid = grievancedetails.getAttribute('data-id');\n            const examid = grievancedetails.getAttribute('data-examid');\n            const examname = grievancedetails.getAttribute('data-name');\n            var params = {};\n            params.greivanceid = greivanceid;\n            params.examid = examid;\n            var promise = Ajax.call([{\n                methodname: 'local_exams_view_grievance',\n                args: params\n            }]);\n            promise[0].done(function(resp) {\n                ModalFactory.create({\n                    title: getString('view', 'local_exams', examname),\n                    body: resp.options\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.show();\n                }.bind(this));\n            }).fail(function() {\n                // do something with the exception\n            });\n        }\n\n        let examschedules = e.target.closest(Selectors.actions.examschedules);\n        if (examschedules) {\n            e.preventDefault();\n            const title = getString('createhallschedule', 'local_hall');\n            const form = new Modalform({\n                formClass: 'local_hall\\\\form\\\\schedulehallform',\n                args: {entityid: examschedules.getAttribute('data-examid'), entity: 'exam'},\n                modalConfig: {title},\n                returnFocus: examschedules,\n            });\n            // form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\n\n\n            form.addEventListener(form.events.FORM_SUBMITTED, (event) => {                \n                if (event.detail) {\n                    var type = event.detail.type;\n                    var typeid = event.detail.typeid;\n                    var errors = event.detail.errors;\n                    window.location = M.cfg.wwwroot + '/local/hall/schedulenotices.php?type='+type+'&typeid='+typeid+'&errors='+errors;\n                } else {\n                    window.location.reload();\n                }\n            });\n            form.show();\n        }\n\n\n\n    });\n};\n"],"names":["Selectors","addgrievance","viewgrievance","grievancestatus","grievancedetails","examschedules","document","addEventListener","e","stopImmediatePropagation","grievance","target","closest","preventDefault","title","form","Modalform","formClass","args","examid","getAttribute","userid","profileid","modalConfig","returnFocus","events","FORM_SUBMITTED","event","render","product_attributes","detail","returnparams","then","html","js","append","returnurlbtn","runTemplateJS","always","fail","show","params","temp","methodName","trigger","create","body","Templates","done","replaceNodeContents","modal","setLarge","getRoot","on","ModalEvents","hidden","hide","destroy","bind","this","grievanceid","status","confirm_msg","buttonstring","type","ModalFactory","types","SAVE_CANCEL","setSaveButtonText","save","Ajax","call","methodname","window","location","reload","greivanceid","examname","resp","options","entityid","entity","typeid","errors","M","cfg","wwwroot"],"mappings":"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"}