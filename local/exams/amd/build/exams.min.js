define("local_exams/exams",["exports","local_trainingprogram/dynamicform","core_form/modalform","core/modal_factory","core/modal_events","theme_academy/homepage","core/ajax","core/templates","core/str","jquery"],(function(_exports,_dynamicform,_modalform,_modal_factory,_modal_events,_homepage,_ajax,_templates,_str,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.load=_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_homepage=_interopRequireDefault(_homepage),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery);var Selectors_actions={createexam:'[data-action="createexam"]',deleteexam:'[data-action="deleteexam"]',publishexam:'[data-action="publishexam"]',viewexam:'[data-action="viewexam"]',viewsectors:'[data-action="viewsectors"]',bookhall:'[data-action="bookhall"]',mapcompetencies:'[data-action="mapcompetencies"]',competencies:'[data-action="competencies"]',addprofile:'[data-action="addprofile"]',deleteprofile:'[data-action="deleteprofile"]',viewprofile:'[data-action="viewprofile"]',enrolusertoexam:'[data-action="enrolusertoexam"]',editattempt:'[data-action="editattempt"]',deleteattempt:'[data-action="deleteattempt"]'},HomePage=new _homepage.default;_exports.init=function(){document.addEventListener("click",(function(e){var element=e.target.closest(Selectors_actions.createexam);if(element){e.stopImmediatePropagation();var title=element.getAttribute("data-id")?(0,_str.get_string)("updateexam","local_exams",element.getAttribute("data-name")):(0,_str.get_string)("createexam","local_exams"),form=new _dynamicform.default({formClass:"local_exams\\form\\examsform",args:{id:element.getAttribute("data-id")},modalConfig:{title:title},returnFocus:element});form.addEventListener(form.events.FORM_SUBMITTED,(function(){return window.location.reload()})),form.show()}var deleteexam=e.target.closest(Selectors_actions.deleteexam);if(deleteexam){var examid=deleteexam.getAttribute("data-id");_modal_factory.default.create({title:(0,_str.get_string)("deleteexam","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deleteallconfirm","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("delete","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.examid=examid,_ajax.default.call([{methodname:"local_deleteexam",args:params}])[0].done((function(resp){window.location=M.cfg.wwwroot+"/local/exams/index.php"})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}var publishexam=e.target.closest(Selectors_actions.publishexam);if(publishexam){var _examid=publishexam.getAttribute("data-id");_modal_factory.default.create({title:(0,_str.get_string)("publishexam","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("publishconfirmsg","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("publish","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.examid=_examid,_ajax.default.call([{methodname:"local_publishexam",args:params}])[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}var viewexam=e.target.closest(Selectors_actions.viewexam);if(viewexam){var _examid2=viewexam.getAttribute("data-id");(params={}).examid=_examid2,_ajax.default.call([{methodname:"local_exam_info",args:params}])[0].done((function(resp){_modal_factory.default.create({title:(0,_str.get_string)("viewexam","local_exams"),body:resp.options}).done(function(modal){this.modal=modal,modal.show(),modal.setLarge()}.bind(this))})).fail((function(){console.log("exception")}))}var viewsectors=e.target.closest(Selectors_actions.viewsectors);if(viewsectors){var _examid3=viewsectors.getAttribute("data-id");(params={}).examid=_examid3,_ajax.default.call([{methodname:"local_sectors_info",args:params}])[0].done((function(resp){_modal_factory.default.create({title:(0,_str.get_string)("viewsectors","local_exams"),body:resp.options}).done(function(modal){this.modal=modal,modal.show()}.bind(this))})).fail((function(){console.log("exception")}))}var bookhall=e.target.closest(Selectors_actions.bookhall);if(bookhall){e.preventDefault();var _title=bookhall.getAttribute("data-id"),_form=new _dynamicform.default({formClass:"local_exams\\form\\bookhallform",args:{id:bookhall.getAttribute("data-id")},modalConfig:{title:_title},returnFocus:bookhall});_form.addEventListener(_form.events.FORM_SUBMITTED,(function(){return window.location.reload()})),_form.show()}var mapcompetencies=e.target.closest(Selectors_actions.mapcompetencies);if(mapcompetencies){e.stopImmediatePropagation();var _title2=(0,_str.get_string)("mapcompetencies","local_exams"),_form2=new _dynamicform.default({formClass:"local_exams\\form\\competenciesform",args:{id:mapcompetencies.getAttribute("data-id"),type:mapcompetencies.getAttribute("data-type")},modalConfig:{title:_title2},returnFocus:mapcompetencies});_form2.addEventListener(_form2.events.FORM_SUBMITTED,(function(){return window.location.reload()})),_form2.show()}var competencies=e.target.closest(Selectors_actions.competencies);if(competencies){e.stopImmediatePropagation();var typeid=competencies.getAttribute("data-id"),type=competencies.getAttribute("data-type"),options={};options.typeid=typeid,options.type=type,options.hallid=0,options.examdate=0,options.temp="competencies_view",options.methodName="local_competencies_info";var trigger=(0,_jquery.default)(Selectors_actions.competencies);_modal_factory.default.create({title:(0,_str.get_string)("mapcompetencies","local_exams"),body:_templates.default.render("local_exams/testing",options).done((function(html,js){_templates.default.replaceNodeContents("targetcompetencypc",html,js)}))},trigger).done((function(modal){modal.show(),modal.setLarge(),modal.getRoot().on(_modal_events.default.hidden,function(){modal.hide(),modal.destroy()}.bind(this))}))}var addprofile=e.target.closest(Selectors_actions.addprofile);if(addprofile){var _title3=addprofile.getAttribute("data-id")?(0,_str.get_string)("updateexamprofile","local_exams",addprofile.getAttribute("data-name")):(0,_str.get_string)("createexamprofile","local_exams"),_form3=new _dynamicform.default({formClass:"local_exams\\form\\examprofiles",args:{id:addprofile.getAttribute("data-id"),examid:addprofile.getAttribute("data-examid")},modalConfig:{title:_title3},returnFocus:addprofile});_form3.addEventListener(_form3.events.FORM_SUBMITTED,(function(){return window.location.reload()})),_form3.show()}var deleteprofile=e.target.closest(Selectors_actions.deleteprofile);if(deleteprofile){var profileid=deleteprofile.getAttribute("data-profileid");_modal_factory.default.create({title:(0,_str.get_string)("deleteprofile","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deleteprofileconfirm","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("delete","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.id=profileid,_ajax.default.call([{methodname:"local_deleteprofile",args:params}])[0].done((function(resp){window.location=M.cfg.wwwroot+"/local/exams/examdetails.php?id="+deleteprofile.getAttribute("data-examid")})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}var viewprofile=e.target.closest(Selectors_actions.viewprofile);if(viewprofile){e.stopImmediatePropagation();var params,_profileid=viewprofile.getAttribute("data-id");(params={}).profileid=_profileid,_ajax.default.call([{methodname:"local_exam_profileinfo",args:params}])[0].done((function(resp){_modal_factory.default.create({title:(0,_str.get_string)("viewprofile","local_exams"),body:resp.options}).done(function(modal){this.modal=modal,modal.show(),modal.setLarge()}.bind(this))})).fail((function(){console.log("exception")}))}var enrolusertoexam=e.target.closest(Selectors_actions.enrolusertoexam);if(enrolusertoexam){var _examid4=enrolusertoexam.getAttribute("data-examid"),_profileid2=enrolusertoexam.getAttribute("data-profileid"),scheduleid=enrolusertoexam.getAttribute("data-scheduleid"),_type=enrolusertoexam.getAttribute("data-type"),tuserid=enrolusertoexam.getAttribute("data-tuserid"),damount=enrolusertoexam.getAttribute("data-damount"),productid=enrolusertoexam.getAttribute("data-productid"),organization=enrolusertoexam.getAttribute("data-organization"),orgofficial=enrolusertoexam.getAttribute("data-orgofficial");_modal_factory.default.create({title:"",type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("enrolconfirm","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){if(e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((function(_ref){var html=_ref.html,js=_ref.js;_templates.default.appendNodeContents(".modal-content",html,js)})),isNaN(tuserid)&&"bulkenrollment"==_type){var enrolparams={};enrolparams.examid=_examid4,enrolparams.profileid=_profileid2,enrolparams.scheduleid=scheduleid,enrolparams.type=_type,enrolparams.tuserid=tuserid,enrolparams.orderid=0,enrolparams.productid=productid,enrolparams.organization=organization,_ajax.default.call([{methodname:"local_exam_enrouser",args:enrolparams}])[0].done((function(resp){"success"==resp.response?"bulkenrollment"==_type&&(window.location=M.cfg.wwwroot+"/local/exams/enrollmentconfirmation.php?examid="+_examid4+"&profileid="+_profileid2+"&scheduleid="+scheduleid+"&cusers="+tuserid+"&organization="+organization+"&orgofficial="+orgofficial):(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}else if(isNaN(tuserid)&&"bulkenrollment"!=_type){(params={}).entityid=_examid4,params.referenceid=_profileid2,params.tuserid=tuserid,params.type="exam",_ajax.default.call([{methodname:"local_exams_get_orgorderdetails",args:params}])[0].done((function(orgorderdetailsresp){"success"==orgorderdetailsresp.response?""!=orgorderdetailsresp.returnparams&&1==orgorderdetailsresp.autoapproval?(event.preventDefault(),_ajax.default.call([{methodname:"tool_product_postpaid_payments",args:{products:orgorderdetailsresp.returnparams}}])[0].done((function(response){var params={},p_orderid=response.paymentid;params.orderid=response.paymentid,_ajax.default.call([{methodname:"tool_product_get_orderinfo",args:params}])[0].done((function(resp){resp&&_ajax.default.call([{methodname:"tool_product_generate_sadadbill",args:{products:resp.info}}])[0].done((function(response){var enrolparams={};enrolparams.examid=_examid4,enrolparams.profileid=_profileid2,enrolparams.scheduleid=scheduleid,enrolparams.type=_type,enrolparams.tuserid=tuserid,enrolparams.orderid=p_orderid,enrolparams.productid=productid,enrolparams.organization=organization,enrolparams.discountprice=orgorderdetailsresp.discountprice,enrolparams.discounttype=orgorderdetailsresp.discounttype,enrolparams.discounttableid=orgorderdetailsresp.discounttableid,enrolparams.autoapproval=orgorderdetailsresp.autoapproval,_ajax.default.call([{methodname:"local_exam_enrouser",args:enrolparams}])[0].done((function(resp){if("success"==resp.response)window.location=M.cfg.wwwroot+"/local/exams/index.php";else{_ajax.default.call([{methodname:"local_exam_revert_enroluser",args:enrolparams}]);modal.hide(),HomePage.confirmbox(resp.response)}})).fail((function(){console.log("exception")}))})).fail((function(error){modal.hide(),HomePage.confirmbox(error.message)}))})).fail((function(error){HomePage.confirmbox(error.message)}))})).fail((function(error){HomePage.confirmbox(error.error)}))):_ajax.default.call([{methodname:"tool_product_postpaid_payments",args:{products:orgorderdetailsresp.returnparams}}])[0].done((function(response){if(1==response.success){var enrolparams={};enrolparams.examid=_examid4,enrolparams.profileid=_profileid2,enrolparams.scheduleid=scheduleid,enrolparams.type=_type,enrolparams.tuserid=tuserid,enrolparams.orderid=response.paymentid,enrolparams.productid=productid,enrolparams.organization=organization,enrolparams.discountprice=orgorderdetailsresp.discountprice,enrolparams.discounttype=orgorderdetailsresp.discounttype,enrolparams.discounttableid=orgorderdetailsresp.discounttableid,enrolparams.autoapproval=orgorderdetailsresp.autoapproval,_ajax.default.call([{methodname:"local_exam_enrouser",args:enrolparams}])[0].done((function(resp){if("success"==resp.response)_modal_factory.default.create({title:(0,_str.get_string)("confirm","local_exams"),type:_modal_factory.default.types.DEFAULT,body:(0,_str.get_string)("ordersubmitted","tool_product")}).done(function(modal){this.modal=modal,e.preventDefault(),modal.show(),window.location=M.cfg.wwwroot+"/local/exams/index.php"}.bind(this));else{_ajax.default.call([{methodname:"local_exam_revert_enroluser",args:enrolparams}]);modal.hide(),HomePage.confirmbox(resp.response)}})).fail((function(error){_ajax.default.call([{methodname:"local_exam_revert_enroluser",args:enrolparams}]);HomePage.confirmbox(error.message)}))}})).fail((function(){console.log("exception")})):(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(error){HomePage.confirmbox(error.message)}))}else if(damount>0){(params={}).examid=_examid4,params.profileid=_profileid2,params.scheduleid=scheduleid,params.type=_type,params.tuserid=tuserid,params.orderid=0,params.productid=productid,params.organization=organization,_ajax.default.call([{methodname:"local_exam_enrouser",args:params}])[0].done((function(resp){if("success"==resp.response){var products={};products.userid=tuserid,products.productid=productid,products.deductamount=damount,products.scheduleid=scheduleid,_ajax.default.call([{methodname:"local_exams_rescheduleuser",args:products}])[0].done((function(resp){window.location=M.cfg.wwwroot+"/local/exams/index.php"})).fail((function(err){HomePage.confirmbox(err.message)}))}else modal.hide(),HomePage.confirmbox(resp.response)})).fail((function(){console.log("exception")}))}else{var params;(params={}).examid=_examid4,params.profileid=_profileid2,params.scheduleid=scheduleid,params.type=_type,params.tuserid=tuserid,params.orderid=0,params.productid=productid,params.organization=organization,_ajax.default.call([{methodname:"local_exam_enrouser",args:params}])[0].done((function(resp){"success"==resp.response?window.location=M.cfg.wwwroot+"/local/exams/index.php":(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}}.bind(this)),modal.show()}.bind(this))}var editattempt=e.target.closest(Selectors_actions.editattempt);if(editattempt){e.stopImmediatePropagation();var _title4=editattempt.getAttribute("data-id")?(0,_str.get_string)("updateattempt","local_exams"):(0,_str.get_string)("addattempt","local_exams"),_form4=new _modalform.default({formClass:"local_exams\\form\\attemptform",args:{id:editattempt.getAttribute("data-id"),examid:editattempt.getAttribute("data-examid")},modalConfig:{title:_title4},returnFocus:editattempt});_form4.addEventListener(_form4.events.FORM_SUBMITTED,(function(){return window.location.reload()})),_form4.show()}var deleteattempt=e.target.closest(Selectors_actions.deleteattempt);if(deleteattempt){e.stopImmediatePropagation();var attemptid=deleteattempt.getAttribute("data-id"),_examid5=deleteattempt.getAttribute("data-examid");_modal_factory.default.create({title:(0,_str.get_string)("deleteattempt","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("deleteattemptconfirm","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("delete","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={};params.attemptid=attemptid,_ajax.default.call([{methodname:"local_exam_deleteattempt",args:params}])[0].done((function(resp){resp?window.location=M.cfg.wwwroot+"/local/exams/examattempts.php?id="+_examid5:(HomePage.confirmbox((0,_str.get_string)("attemptpurchasesavailable","local_exams")),modal.destroy())})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}})),(0,_jquery.default)(".profilelanguage").on("change",(function(){var language=(0,_jquery.default)(this).val(),product=(0,_jquery.default)(this).attr("data-product");(0,_jquery.default)(".select_btn").attr("data-language",language),(0,_jquery.default)("#global_filter").attr("data-examvariation",product)}))};_exports.load=function(args){console.log(args),(0,_jquery.default)("#global_filter").attr("data-examvariation",args)}}));

//# sourceMappingURL=exams.min.js.map