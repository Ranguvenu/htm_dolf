define("local_exams/cancelreschedule",["exports","local_trainingprogram/dynamicform","core_form/modalform","core/modal_factory","core/modal_events","theme_academy/homepage","core/fragment","core/ajax","core/templates","core/str","jquery"],(function(_exports,_dynamicform,_modalform,_modal_factory,_modal_events,_homepage,_fragment,_ajax,_templates,_str,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_homepage=_interopRequireDefault(_homepage),_fragment=_interopRequireDefault(_fragment),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery);const Selectors_actions={cancelexam:'[data-action="cancelexam"]',rescheduleexam:'[data-action="rescheduleexam"]',canceluser:'[data-action="canceluser"]',trescheduleexam:'[data-action="trescheduleexam"]'};let HomePage=new _homepage.default;_exports.init=()=>{document.addEventListener("click",(function(e){let cancelexam=e.target.closest(Selectors_actions.cancelexam);if(cancelexam){e.stopImmediatePropagation();const productid=cancelexam.getAttribute("data-productid"),userid=cancelexam.getAttribute("data-currentuser"),entitytype=cancelexam.getAttribute("data-entitytype"),refundtype=cancelexam.getAttribute("data-refundtype"),ownedby=cancelexam.getAttribute("data-ownedby");_modal_factory.default.create({title:(0,_str.get_string)("cancelexam","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("cancelexamconfirm","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){if(e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref2=>{let{html:html,js:js}=_ref2;_templates.default.appendNodeContents(".modal-content",html,js)})),"CISI"==ownedby)modal.hide(),HomePage.confirmbox((0,_str.get_string)("cannotcancelexam","local_exams"));else{var parameters={};parameters.productid=productid,parameters.userid=userid,parameters.entitytype=entitytype,parameters.refundtype=refundtype,parameters.policyconfirm=1,_ajax.default.call([{methodname:"local_exams_cancelexamcalc",args:parameters}])[0].done((function(resp){var data={};if(data.refundamount=resp.refundamount,data.deductamount=resp.deductamount,data.productprice=resp.productprice,data.isorgofficial=resp.isorgofficial,console.log(data),1==resp.isorgofficial)0==resp.productprice?((ceparams={}).userid=userid,ceparams.productid=productid,ceparams.examprice=1,ceparams.amount=resp.productprice,ceparams.refundamount=resp.refundamount,ceparams.newamount=resp.newamount,ceparams.newinvoiceamount=0,ceparams.newamount=0,ceparams.examdate=resp.examdate,ceparams.policyconfirm=1,ceparams.invoicenumber=0,ceparams.entitytype=entitytype,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))):resp.newinvoiceamount<50&&resp.seats>0?HomePage.confirmbox((0,_str.get_string)("invoiceamountcantlower","local_exams")):resp&&_modal_factory.default.create({title:(0,_str.get_string)("cancel","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("traineegenerateinvoiceconfirmation","local_exams",resp)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref3=>{let{html:html,js:js}=_ref3;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var ceparams={};ceparams.userid=userid,ceparams.productid=productid,ceparams.examprice=1,ceparams.amount=resp.productprice,ceparams.refundamount=resp.refundamount,ceparams.newinvoiceamount=resp.newinvoiceamount,ceparams.newamount=resp.newamount,ceparams.examdate=resp.examdate,ceparams.policyconfirm=1,ceparams.invoicenumber=resp.invoicenumber,ceparams.entitytype=entitytype,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this));else if(""==resp.cannotcancel)HomePage.confirmbox((0,_str.get_string)("cannotcancelexam","local_exams")),modal.destroy();else if(0==resp.productprice){var ceparams;(ceparams={}).userid=userid,ceparams.productid=productid,ceparams.examprice=1,ceparams.amount=resp.productprice,ceparams.refundamount=resp.refundamount,ceparams.newamount=resp.newamount,ceparams.newinvoiceamount=0,ceparams.newamount=0,ceparams.examdate=resp.examdate,ceparams.policyconfirm=1,ceparams.invoicenumber=0,ceparams.entitytype=entitytype,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}else resp&&_modal_factory.default.create({title:(0,_str.get_string)("refundpolicies","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("refundamountconfirm","local_exams",data)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref4=>{let{html:html,js:js}=_ref4;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var ceparams={};ceparams.userid=userid,ceparams.productid=productid,ceparams.examprice=1,ceparams.amount=resp.productprice,ceparams.refundamount=resp.refundamount,ceparams.newinvoiceamount=0,ceparams.newamount=0,ceparams.examdate=resp.examdate,ceparams.policyconfirm=1,ceparams.invoicenumber=0,ceparams.entitytype=entitytype,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))})).fail((function(err){HomePage.confirmbox(err.message)}))}}.bind(this)),modal.show()}.bind(this))}let rescheduleexam=e.target.closest(Selectors_actions.rescheduleexam);if(rescheduleexam){const examid=rescheduleexam.getAttribute("data-examid"),productid=rescheduleexam.getAttribute("data-productid"),userid=rescheduleexam.getAttribute("data-currentuser"),entitytype=rescheduleexam.getAttribute("data-entitytype"),refundtype=rescheduleexam.getAttribute("data-refundtype"),profileid=(rescheduleexam.getAttribute("data-ownedby"),rescheduleexam.getAttribute("data-currentuserorgoff"),rescheduleexam.getAttribute("data-enrolledrole"),rescheduleexam.getAttribute("data-examdate"),rescheduleexam.getAttribute("data-profileid")),enrolltype=rescheduleexam.getAttribute("data-enrolltype");_modal_factory.default.create({title:(0,_str.get_string)("rescheduleexam","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("rescheduleconfirm","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("reschedule","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref5=>{let{html:html,js:js}=_ref5;_templates.default.appendNodeContents(".modal-content",html,js)}));var params={};params.productid=productid,params.userid=userid,params.entitytype=entitytype,params.refundtype=refundtype,params.policyconfirm=1,params.enrolltype=enrolltype,_ajax.default.call([{methodname:"local_exams_cancelexamcalc",args:params}])[0].done((function(resp){console.log(resp);var data={};if(data.refundamount=resp.refundamount,data.deductamount=resp.deductamount,data.productprice=resp.productprice,data.isorgofficial=resp.isorgofficial,data.contextid=resp.contextid,2==enrolltype||1==resp.isorgofficial&&1!=resp.loginuseradmin)resp.newinvoiceamount<50&&resp.seats>0?HomePage.confirmbox((0,_str.get_string)("invoiceamountcantlower","local_exams")):resp&&_modal_factory.default.create({title:(0,_str.get_string)("reschedule","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("orgofficialrescheduledetails","local_exams",resp)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){window.location=M.cfg.wwwroot+"/local/exams/hallschedule.php?examid="+resp.entityid+"&profileid="+resp.referenceid+"&tuserid="+resp.tuserid+"&type=reschedule&damount="+resp.deductamount}.bind(this)),modal.show()}.bind(this));else if(0==resp.productprice)window.location=M.cfg.wwwroot+"/local/exams/index.php";else if(1==resp.loginuseradmin){modal.hide();const title=(0,_str.get_string)("reasonreschedule","local_exams"),form=new _modalform.default({formClass:"local_exams\\form\\reasonform",args:{entitytype:entitytype,userid:userid,productid:productid},modalConfig:{title:title},returnFocus:canceluser});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{const data=event.detail;if(console.log(data.policy),data.policy>0){var policyconfirm=1,canceldataparams={};canceldataparams.productid=productid,canceldataparams.userid=userid,canceldataparams.entitytype=entitytype,canceldataparams.refundtype=refundtype,canceldataparams.policyconfirm=policyconfirm,canceldataparams.enrolltype=enrolltype,_ajax.default.call([{methodname:"local_exams_cancelexamcalc",args:canceldataparams}])[0].done((function(resp){var responsedata={};responsedata.amount=resp.productprice,responsedata.refundamount=resp.refundamount,responsedata.newinvoiceamount=resp.newinvoiceamount,responsedata.newamount=resp.newamount,responsedata.invoicenumber=resp.invoicenumber,responsedata.productid=resp.productid,responsedata.orgofficialenrolled=resp.orgofficialenrolled,responsedata.deductamount=resp.deductamount,resp.newinvoiceamount<50&&resp.seats>0?HomePage.confirmbox((0,_str.get_string)("invoiceamountcantlower","local_exams")):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("orgofficialrescheduledetails","local_exams",responsedata)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),window.location=M.cfg.wwwroot+"/local/exams/hallschedule.php?examid="+resp.entityid+"&profileid="+resp.referenceid+"&tuserid="+resp.tuserid+"&type=reschedule&damount="+resp.deductamount}.bind(this)),modal.show()}.bind(this))})).fail((function(err){HomePage.confirmbox(err.message)}))}else{policyconfirm=0;window.location=M.cfg.wwwroot+"/local/exams/hallschedule.php?examid="+examid+"&profileid="+profileid+"&tuserid="+userid+"&type=reschedule"}})),form.show()}else resp&&_modal_factory.default.create({title:(0,_str.get_string)("reschedule","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("rescheduledetails","local_exams",resp)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref6=>{let{html:html,js:js}=_ref6;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var damount=btoa(data.deductamount);window.location=M.cfg.wwwroot+"/local/exams/hallschedule.php?examid="+examid+"&profileid="+profileid+"&tuserid="+userid+"&type=reschedule&status=en&damount="+damount}.bind(this)),modal.show()}.bind(this))})).fail((function(err){HomePage.confirmbox(err.message)}))}.bind(this)),modal.show()}.bind(this))}let canceluser=e.target.closest(Selectors_actions.canceluser);if(canceluser){e.preventDefault(),e.stopImmediatePropagation();const userid=canceluser.getAttribute("data-tobecancelleduserid"),username=canceluser.getAttribute("data-username"),examname=canceluser.getAttribute("data-examname"),examprice=canceluser.getAttribute("data-examprice"),examdate=canceluser.getAttribute("data-examdate"),entitytype=canceluser.getAttribute("data-entitytype"),ownedby=canceluser.getAttribute("data-ownedby"),enrolledrole=canceluser.getAttribute("data-enrolledrole"),productid=canceluser.getAttribute("data-productid"),currentuserorgoff=canceluser.getAttribute("data-currentuserorgoff"),enrolltype=canceluser.getAttribute("data-enrolltype"),cangenerateinvoice=canceluser.getAttribute("data-cangenerateinvoice");var displayparams={};displayparams.userid=userid,displayparams.username=username,displayparams.examname=examname,displayparams.examprice=examprice,_modal_factory.default.create({title:(0,_str.get_string)("cancelconfirm","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("cancelconfirmmessage","local_exams",displayparams)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("yes","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){if(e.preventDefault(),"CISI"==ownedby)modal.hide(),HomePage.confirmbox((0,_str.get_string)("cannotcancelexam","local_exams"));else{var params={};if(0==examprice||0==cangenerateinvoice)params.userid=userid,params.examprice=0,params.amount=0,params.refundamount=0,params.newinvoiceamount=0,params.newamount=0,params.productid=productid,params.examdate=examdate,params.policyconfirm=1,params.invoicenumber=0,params.entitytype=entitytype,params.enrolltype=enrolltype,params.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_canceluser",args:params}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(err){HomePage.confirmbox(err.message)}));else if("admin"==enrolledrole)if(2==enrolltype)if(1==currentuserorgoff){(canceldataparams={}).productid=productid,canceldataparams.entitytype=entitytype,canceldataparams.userid=userid,canceldataparams.refundtype="cancel",canceldataparams.policyconfirm=1,canceldataparams.enrolltype=enrolltype,_ajax.default.call([{methodname:"local_exams_cancelexamcalc",args:canceldataparams}])[0].done((function(resp){var responsedata={};responsedata.productprice=resp.productprice,responsedata.refundamount=resp.refundamount,responsedata.newinvoiceamount=resp.newinvoiceamount,responsedata.newamount=resp.newamount,responsedata.invoicenumber=resp.invoicenumber,responsedata.productid=resp.productid,responsedata.orgofficialenrolled=resp.orgofficialenrolled,responsedata.deductamount=resp.deductamount,0==responsedata.refundamount?_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("generateinvoiceconfirmation","local_exams",responsedata)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref7=>{let{html:html,js:js}=_ref7;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var ceparams={};ceparams.userid=userid,ceparams.productid=productid,ceparams.examprice=0,ceparams.amount=resp.productprice,ceparams.refundamount=0,ceparams.newinvoiceamount=0,ceparams.newamount=0,ceparams.examdate=resp.examdate,ceparams.policyconfirm=1,ceparams.invoicenumber=resp.invoicenumber,ceparams.entitytype=entitytype,ceparams.enrolltype=enrolltype,ceparams.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this)):resp.invoicenumber<=0?HomePage.confirmbox((0,_str.get_string)("nopendinginvoiceavailable","local_exams")):resp.newinvoiceamount<50&&resp.seats>0?HomePage.confirmbox((0,_str.get_string)("invoiceamountcantlower","local_exams")):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("generateinvoiceconfirmation","local_exams",responsedata)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref8=>{let{html:html,js:js}=_ref8;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var ceparams={};ceparams.userid=userid,ceparams.productid=productid,ceparams.examprice=1,ceparams.amount=resp.productprice,ceparams.refundamount=resp.refundamount,ceparams.newinvoiceamount=resp.newinvoiceamount,ceparams.newamount=resp.newamount,ceparams.examdate=resp.examdate,ceparams.policyconfirm=1,ceparams.invoicenumber=resp.invoicenumber,ceparams.entitytype=entitytype,ceparams.enrolltype=enrolltype,ceparams.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))})).fail((function(err){HomePage.confirmbox(err.message)}))}else{const title=(0,_str.get_string)("reasoncancel","local_exams"),form=new _modalform.default({formClass:"local_exams\\form\\reasonform",args:{entitytype:entitytype,userid:userid,productid:productid},modalConfig:{title:title},returnFocus:canceluser});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{const data=event.detail;if(console.log(data.policy),data.policy>0)var policyconfirm=1;else policyconfirm=0;var canceldataparams={};canceldataparams.productid=productid,canceldataparams.entitytype=entitytype,canceldataparams.userid=userid,canceldataparams.refundtype="cancel",canceldataparams.policyconfirm=policyconfirm,canceldataparams.enrolltype=enrolltype,console.log(canceldataparams),_ajax.default.call([{methodname:"local_exams_cancelexamcalc",args:canceldataparams}])[0].done((function(resp){var responsedata={};responsedata.productprice=resp.productprice,responsedata.refundamount=resp.refundamount,responsedata.newinvoiceamount=resp.newinvoiceamount,responsedata.newamount=resp.newamount,responsedata.invoicenumber=resp.invoicenumber,responsedata.productid=resp.productid,responsedata.orgofficialenrolled=resp.orgofficialenrolled,responsedata.deductamount=resp.deductamount,resp.invoicenumber<=0?HomePage.confirmbox((0,_str.get_string)("nopendinginvoiceavailable","local_exams")):resp.newinvoiceamount<50&&resp.seats>0?HomePage.confirmbox((0,_str.get_string)("invoiceamountcantlower","local_exams")):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("generateinvoiceconfirmation","local_exams",responsedata)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref9=>{let{html:html,js:js}=_ref9;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var ceparams={};ceparams.userid=userid,ceparams.productid=productid,ceparams.examprice=1,ceparams.amount=resp.productprice,ceparams.refundamount=resp.refundamount,ceparams.newinvoiceamount=resp.newinvoiceamount,ceparams.newamount=resp.newamount,ceparams.examdate=resp.examdate,ceparams.policyconfirm=policyconfirm,ceparams.invoicenumber=resp.invoicenumber,ceparams.entitytype=entitytype,ceparams.enrolltype=enrolltype,ceparams.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))})).fail((function(err){HomePage.confirmbox(err.message)}))})),form.show()}else{var ceparams={};ceparams.userid=userid,ceparams.productid=productid,ceparams.examprice=1,ceparams.amount=0,ceparams.refundamount=0,ceparams.newinvoiceamount=0,ceparams.newamount=0,ceparams.examdate=examdate,ceparams.policyconfirm=0,ceparams.invoicenumber=0,ceparams.entitytype=entitytype,ceparams.enrolltype=enrolltype,ceparams.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}else if(modal.hide(),"organizationofficial"==enrolledrole&&1==currentuserorgoff){var canceldataparams;(canceldataparams={}).productid=productid,canceldataparams.entitytype=entitytype,canceldataparams.userid=userid,canceldataparams.refundtype="cancel",canceldataparams.policyconfirm=1,canceldataparams.enrolltype=enrolltype,_ajax.default.call([{methodname:"local_exams_cancelexamcalc",args:canceldataparams}])[0].done((function(resp){var responsedata={};responsedata.productprice=resp.productprice,responsedata.refundamount=resp.refundamount,responsedata.newinvoiceamount=resp.newinvoiceamount,responsedata.newamount=resp.newamount,responsedata.invoicenumber=resp.invoicenumber,responsedata.productid=resp.productid,responsedata.orgofficialenrolled=resp.orgofficialenrolled,responsedata.deductamount=resp.deductamount,0==responsedata.refundamount?_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("generateinvoiceconfirmation","local_exams",responsedata)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref10=>{let{html:html,js:js}=_ref10;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var ceparams={};ceparams.userid=userid,ceparams.productid=productid,ceparams.examprice=0,ceparams.amount=resp.productprice,ceparams.refundamount=0,ceparams.newinvoiceamount=0,ceparams.newamount=0,ceparams.examdate=resp.examdate,ceparams.policyconfirm=1,ceparams.invoicenumber=resp.invoicenumber,ceparams.entitytype=entitytype,ceparams.enrolltype=enrolltype,ceparams.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this)):resp.invoicenumber<=0?HomePage.confirmbox((0,_str.get_string)("nopendinginvoiceavailable","local_exams")):resp.newinvoiceamount<50&&resp.seats>0?HomePage.confirmbox((0,_str.get_string)("invoiceamountcantlower","local_exams")):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("generateinvoiceconfirmation","local_exams",responsedata)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref11=>{let{html:html,js:js}=_ref11;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var ceparams={};ceparams.userid=userid,ceparams.productid=productid,ceparams.examprice=1,ceparams.amount=resp.productprice,ceparams.refundamount=resp.refundamount,ceparams.newinvoiceamount=resp.newinvoiceamount,ceparams.newamount=resp.newamount,ceparams.examdate=resp.examdate,ceparams.policyconfirm=1,ceparams.invoicenumber=resp.invoicenumber,ceparams.entitytype=entitytype,ceparams.enrolltype=enrolltype,ceparams.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))})).fail((function(err){HomePage.confirmbox(err.message)}))}else{const title=(0,_str.get_string)("reasoncancel","local_exams"),form=new _modalform.default({formClass:"local_exams\\form\\reasonform",args:{entitytype:entitytype,userid:userid,productid:productid},modalConfig:{title:title},returnFocus:canceluser});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{const data=event.detail;if(console.log(data.policy),data.policy>0)var policyconfirm=1;else policyconfirm=0;var canceldataparams={};canceldataparams.productid=productid,canceldataparams.entitytype=entitytype,canceldataparams.userid=userid,canceldataparams.refundtype="cancel",canceldataparams.policyconfirm=policyconfirm,canceldataparams.enrolltype=enrolltype,_ajax.default.call([{methodname:"local_exams_cancelexamcalc",args:canceldataparams}])[0].done((function(resp){var responsedata={};responsedata.productprice=resp.productprice,responsedata.refundamount=resp.refundamount,responsedata.newinvoiceamount=resp.newinvoiceamount,responsedata.newamount=resp.newamount,responsedata.invoicenumber=resp.invoicenumber,responsedata.productid=resp.productid,responsedata.orgofficialenrolled=resp.orgofficialenrolled,responsedata.deductamount=resp.deductamount,1==resp.trainee?_modal_factory.default.create({title:(0,_str.get_string)("refundpolicies","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("refundamountconfirm","local_exams",responsedata)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref12=>{let{html:html,js:js}=_ref12;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var canceluserparams={};console.log(cangenerateinvoice),canceluserparams.userid=userid,canceluserparams.examprice=1,canceluserparams.amount=resp.productprice,canceluserparams.refundamount=resp.refundamount,canceluserparams.newinvoiceamount=0,canceluserparams.newamount=0,canceluserparams.productid=productid,canceluserparams.policyconfirm=policyconfirm,canceluserparams.examdate=resp.examdate,canceluserparams.invoicenumber=0,canceluserparams.entitytype=entitytype,canceluserparams.enrolltype=enrolltype,canceluserparams.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_canceluser",args:canceluserparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(err){HomePage.confirmbox(err.message)}))}.bind(this)),modal.show()}.bind(this)):resp.invoicenumber<=0?HomePage.confirmbox((0,_str.get_string)("nopendinginvoiceavailable","local_exams")):resp.newinvoiceamount<50&&resp.seats>0?HomePage.confirmbox((0,_str.get_string)("invoiceamountcantlower","local_exams")):_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("generateinvoiceconfirmation","local_exams",responsedata)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref13=>{let{html:html,js:js}=_ref13;_templates.default.appendNodeContents(".modal-content",html,js)})),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var ceparams={};ceparams.userid=userid,ceparams.productid=productid,ceparams.examprice=1,ceparams.amount=resp.productprice,ceparams.refundamount=resp.refundamount,ceparams.newinvoiceamount=resp.newinvoiceamount,ceparams.newamount=resp.newamount,ceparams.examdate=resp.examdate,ceparams.policyconfirm=policyconfirm,ceparams.invoicenumber=resp.invoicenumber,ceparams.entitytype=entitytype,ceparams.enrolltype=enrolltype,ceparams.cangenerateinvoice=cangenerateinvoice,_ajax.default.call([{methodname:"local_exams_canceluser",args:ceparams}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))})).fail((function(err){HomePage.confirmbox(err.message)}))})),form.show()}}}.bind(this)),modal.show()}.bind(this))}let trescheduleexam=e.target.closest(Selectors_actions.trescheduleexam);if(trescheduleexam){const examid=trescheduleexam.getAttribute("data-examid"),productid=trescheduleexam.getAttribute("data-productid"),entitytype="exam",type=trescheduleexam.getAttribute("data-type"),profileid=trescheduleexam.getAttribute("data-profileid"),damount=atob(trescheduleexam.getAttribute("data-damount")),userid=trescheduleexam.getAttribute("data-userid"),contextid=trescheduleexam.getAttribute("data-contextid"),scheduleid=trescheduleexam.getAttribute("data-scheduleid");console.log(profileid),_modal_factory.default.create({title:(0,_str.get_string)("rescheduleexam","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("rescheduleconfirm","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("reschedule","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((_ref14=>{let{html:html,js:js}=_ref14;_templates.default.appendNodeContents(".modal-content",html,js)}));var params={};params.examid=examid,params.profileid=profileid,params.scheduleid=scheduleid,params.type=type,params.tuserid=userid,params.orderid=0,params.productid=productid,_ajax.default.call([{methodname:"local_exam_enrouser",args:params}])[0].done((function(resp){if("success"==resp.response){let products={};products.userid=userid,products.paymenttype="telr",products.productid=productid,products.entitytype=entitytype,products.total=damount,products.scheduleid=scheduleid,products.profileid=profileid,products.processtype="reschedule",_fragment.default.loadFragment("local_exams","productdata",contextid,products).done((function(html,js){let promise=_ajax.default.call([{methodname:"tool_product_telr_begin_trans",args:{products:html}}]);_templates.default.render("tool_product/loader"),promise[0].done((response=>{console.log(response),window.location=response.returnurl})).fail((error=>{HomePage.confirmbox(error.message)}))}))}else modal.hide(),HomePage.confirmbox(resp.response)})).fail((function(){console.log("exception")}))}.bind(this)),modal.show()}.bind(this))}}))}}));

//# sourceMappingURL=cancelreschedule.min.js.map