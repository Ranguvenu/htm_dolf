define("local_exams/bulkenrollment",["exports","core/modal_factory","core/modal_events","theme_academy/homepage","core/fragment","core/ajax","core/templates","core/str","jquery"],(function(_exports,_modal_factory,_modal_events,_homepage,_fragment,_ajax,_templates,_str,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * TODO describe module bulkenrollment
   *
   * @module     local_exams/bulkenrollment
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_homepage=_interopRequireDefault(_homepage),_fragment=_interopRequireDefault(_fragment),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery);var Selectors_actions={removeuserconfirmation:'[data-action="removeuserconfirmation"]',confirmbulkenrolluser:'[data-action="confirmbulkenrolluser"]'},HomePage=new _homepage.default;_exports.init=function(){document.addEventListener("click",(function(e){var removeuserconfirmation=e.target.closest(Selectors_actions.removeuserconfirmation);if(removeuserconfirmation){e.preventDefault(),e.stopImmediatePropagation();var rootid=removeuserconfirmation.getAttribute("data-rootid"),fieldid=removeuserconfirmation.getAttribute("data-fieldid"),userid=removeuserconfirmation.getAttribute("data-id"),type=removeuserconfirmation.getAttribute("data-type"),userfullname=removeuserconfirmation.getAttribute("data-name"),idnumber=removeuserconfirmation.getAttribute("data-idnumber"),displayparams={};displayparams.userid=userid,displayparams.userfullname=userfullname,displayparams.idnumber=idnumber,_modal_factory.default.create({title:(0,_str.get_string)("removeconfirm","local_exams"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("removeenrollmentconfirmmessage","local_exams",displayparams)}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("yes","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),e.stopImmediatePropagation(),modal.hide();var params={};params.rootid=rootid,params.fieldid=fieldid,params.userid=userid,params.type=type;var promise=_ajax.default.call([{methodname:"local_exams_removeenrollmentconfirmation",args:params}]);promise[0].done((function(resp){promise[0].done((function(resp){window.location.reload(!0)})).fail((function(){console.log("exception")}))})).fail((function(err){HomePage.confirmbox(err.message)}))}.bind(this)),modal.show()}.bind(this))}var confirmbulkenrolluser=e.target.closest(Selectors_actions.confirmbulkenrolluser);if(confirmbulkenrolluser){e.preventDefault(),e.stopImmediatePropagation();var _rootid=confirmbulkenrolluser.getAttribute("data-rootid"),_fieldid=confirmbulkenrolluser.getAttribute("data-fieldid"),roleid=confirmbulkenrolluser.getAttribute("data-roleid"),cusers=confirmbulkenrolluser.getAttribute("data-cusers"),organization=confirmbulkenrolluser.getAttribute("data-organization"),scheduleid=confirmbulkenrolluser.getAttribute("data-scheduleid"),orgofficial=confirmbulkenrolluser.getAttribute("data-orgofficial"),actionfor=confirmbulkenrolluser.getAttribute("data-actionfor"),discount=confirmbulkenrolluser.getAttribute("data-discount"),discounttableid=confirmbulkenrolluser.getAttribute("data-discounttableid"),discounttype=confirmbulkenrolluser.getAttribute("data-discounttype");_modal_factory.default.create({title:"",type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("enrolconfirm","local_exams")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("confirm","local_exams")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((function(_ref){var html=_ref.html,js=_ref.js;_templates.default.appendNodeContents(".modal-content",html,js)})),e.preventDefault();var params={};params.rootid=_rootid,params.fieldid=_fieldid,params.roleid=roleid,params.cusers=cusers,params.organization=organization,params.scheduleid=scheduleid,params.orgofficial=orgofficial,params.actionfor=actionfor,_ajax.default.call([{methodname:"local_exams_registerbulkenrollusers",args:params}])[0].done((function(resp){if("success"==resp.response){var params={};params.rootid=_rootid,params.fieldid=_fieldid,params.roleid=roleid,params.scheduleid=scheduleid,params.type="bulkenrollment",params.tuserid=cusers,params.organization=organization,params.orgofficial=orgofficial,params.actionfor=actionfor,params.discount=discount,params.discounttableid=discounttableid,params.discounttype=discounttype,_ajax.default.call([{methodname:"local_exams_generate_sadad_for_bulkenrollusers",args:params}])[0].done((function(resp){"success"==resp.response?window.location.href=resp.returnurl:(modal.hide(),HomePage.confirmbox(resp.response))})).fail((function(error){HomePage.confirmbox(error.message)}))}else modal.hide(),HomePage.confirmbox(resp.response)})).fail((function(err){HomePage.confirmbox(err.message)}))}.bind(this)),modal.show()}.bind(this))}}))}}));

//# sourceMappingURL=bulkenrollment.min.js.map