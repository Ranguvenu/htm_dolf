define("local_exams/grievance",["exports","core_form/modalform","core/modal_factory","core/modal_events","core/ajax","core/templates","core/str","jquery"],(function(_exports,_modalform,_modal_factory,_modal_events,_ajax,_templates,_str,_jquery){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery);const Selectors_actions={addgrievance:'[data-action="addgrievance"]',viewgrievance:'[data-action="viewgrievance"]',grievancestatus:'[data-action="grievancestatus"]',grievancedetails:'[data-action="grievancedetails"]',examschedules:'[data-action="examschedules"]'};_exports.init=()=>{document.addEventListener("click",(function(e){e.stopImmediatePropagation();let grievance=e.target.closest(Selectors_actions.addgrievance);if(grievance){e.preventDefault();const title=(0,_str.get_string)("submitgrievance","local_exams"),form=new _modalform.default({formClass:"local_exams\\form\\grievanceform",args:{examid:grievance.getAttribute("data-examid"),userid:grievance.getAttribute("data-userid"),profileid:grievance.getAttribute("data-profileid")},modalConfig:{title:title},returnFocus:grievance});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{_templates.default.render("tool_product/add_order_seats",{product_attributes:event.detail.returnparams}).then((function(html,js){(0,_jquery.default)('[data-region="grievance-order-summary"]').html(html),(0,_jquery.default)('[data-region="grievance-order-summary"]').append(event.detail.returnurlbtn),_templates.default.runTemplateJS(js)})).always((function(){})).fail()})),form.show()}let viewgrievance=e.target.closest(Selectors_actions.viewgrievance);if(viewgrievance){const examid=viewgrievance.getAttribute("data-examid"),userid=viewgrievance.getAttribute("data-userid");(params={}).examid=examid,params.userid=userid,params.temp="grievance_list",params.methodName="local_exams_grievance_info";var trigger=(0,_jquery.default)(Selectors_actions.viewgrievance);_modal_factory.default.create({title:(0,_str.get_string)("viewgrievance","local_exams"),body:_templates.default.render("local_exams/grievance_cardview",params).done((function(html,js){_templates.default.replaceNodeContents("targetgrievance",html,js)}))},trigger).done((function(modal){modal.show(),modal.setLarge(),modal.getRoot().on(_modal_events.default.hidden,function(){modal.hide(),modal.destroy()}.bind(this))}))}let grievancestatus=e.target.closest(Selectors_actions.grievancestatus);if(grievancestatus){const grievanceid=grievancestatus.getAttribute("data-id"),status=grievancestatus.getAttribute("data-status");if("2"==status)var confirm_msg=(0,_str.get_string)("approveconfirm","local_exams"),buttonstring=(0,_str.get_string)("approve","local_exams");else confirm_msg=(0,_str.get_string)("rejectconfirm","local_exams"),buttonstring=(0,_str.get_string)("reject","local_exams");_modal_factory.default.create({title:"",type:_modal_factory.default.types.SAVE_CANCEL,body:confirm_msg}).done(function(modal){this.modal=modal,modal.setSaveButtonText(buttonstring),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault();var params={confirm:!0};params.grievanceid=grievanceid,params.status=status,_ajax.default.call([{methodname:"local_exams_grievancestatus",args:params}])[0].done((function(){window.location.reload(!0)})).fail((function(){}))}.bind(this)),modal.show()}.bind(this))}let grievancedetails=e.target.closest(Selectors_actions.grievancedetails);if(grievancedetails){const greivanceid=grievancedetails.getAttribute("data-id"),examid=grievancedetails.getAttribute("data-examid"),examname=grievancedetails.getAttribute("data-name");var params;(params={}).greivanceid=greivanceid,params.examid=examid,_ajax.default.call([{methodname:"local_exams_view_grievance",args:params}])[0].done((function(resp){_modal_factory.default.create({title:(0,_str.get_string)("view","local_exams",examname),body:resp.options}).done(function(modal){this.modal=modal,modal.show()}.bind(this))})).fail((function(){}))}let examschedules=e.target.closest(Selectors_actions.examschedules);if(examschedules){e.preventDefault();const title=(0,_str.get_string)("createhallschedule","local_hall"),form=new _modalform.default({formClass:"local_hall\\form\\schedulehallform",args:{entityid:examschedules.getAttribute("data-examid"),entity:"exam"},modalConfig:{title:title},returnFocus:examschedules});form.addEventListener(form.events.FORM_SUBMITTED,(event=>{if(event.detail){var type=event.detail.type,typeid=event.detail.typeid,errors=event.detail.errors;window.location=M.cfg.wwwroot+"/local/hall/schedulenotices.php?type="+type+"&typeid="+typeid+"&errors="+errors}else window.location.reload()})),form.show()}}))}}));

//# sourceMappingURL=grievance.min.js.map