define("tool_product/product",["exports","core/modal_factory","core_form/modalform","core/modal_events","jquery","core/str","core/ajax","core/templates","theme_academy/homepage","tool_product/login-modal"],(function(_exports,_modal_factory,_modalform,_modal_events,_jquery,_str,_ajax,_templates,_homepage8,_loginModal){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.variations=_exports.reset_cart=_exports.paymentsinit=_exports.make_payment=_exports.grouped_products=_exports.default=_exports.checkout=_exports.cart_actions=_exports.cart=_exports.addregister=_exports.addprogramregister=_exports.add_order_seats=_exports.add_learningtrack_order_seats=_exports.add=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modalform=_interopRequireDefault(_modalform),_modal_events=_interopRequireDefault(_modal_events),_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_homepage8=_interopRequireDefault(_homepage8),_loginModal=_interopRequireDefault(_loginModal);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Selectors_actions={paymentsupdate:'[data-action="paymentsupdate"]',approvalseats:'[data-action="approvalseats"]',sendemailtoorgofficial:'[data-action="sendemailtoorgofficial"]',cancelorder:'[data-action="cancelorder"]'},get_attributes=function(selector){return(0,_jquery.default)(selector).data()},product_has_variations=function(args){return args.hasvariations},get_product_id=function(args){return product_has_variations(args)?args.variation:args.product},set_product=function(products){localStorage.setItem("products",JSON.stringify(products))},get_products=function(){var products=localStorage.getItem("products");return(products=JSON.parse(products))||[]},get_productformdata=function(){var productformdata=localStorage.getItem("productformdata");return(productformdata=JSON.parse(productformdata))||[]},set_coupons=function(coupons){localStorage.setItem("coupons",JSON.stringify(coupons))},get_coupons=function(){var coupons=localStorage.getItem("coupons");return(coupons=JSON.parse(coupons))&&(coupons=coupons.filter(Boolean)),coupons||[]},exists_in_coupon=function(couponcode){var coupons=get_coupons();return coupons?coupons.findIndex((function(x){return x.couponcode==couponcode})):-1},get_product_information=function(){var products=get_products();_ajax.default.call([{methodname:"tool_product_view_cart",args:{products:products}}])[0].done((function(response){render_cart_page(response)})).fail((function(error){(new _homepage8.default).confirmbox(error.error)}));var productscount=get_products();(0,_jquery.default)(".basketicon").html('<span class="basketcount">'+productscount.length+"</span>")},add_to_cart=function(args,parent){var incart=exists_in_cart(args),products=get_products(),data={variation:args.variation,product:args.product,grouped:args.grouped,hasvariations:product_has_variations(args),quantity:args.quantity,category:args.category,language:args.language,hallscheduleid:args.hallscheduleid,profileid:args.profileid,processtype:args.processtype,tandcconfirm:args.tandcconfirm};incart>-1&&products[incart]?products[incart]=data:products.push(data),set_product(products);var productscount=get_products();parent&&render_template("tool_product/cart/go-to-cart",parent,{isloggedin:args.loggedin,checkout:args.checkout}),(0,_jquery.default)(".basketicon").html('<span class="basketcount">'+productscount.length+"</span>")},remove_from_cart=function(args){var refresh=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],index=exists_in_cart(args);if(index>-1){var products=get_products();products[index]&&(products.splice(index,1),set_product(products),refresh&&get_product_information())}if(args.couponcode){var couponexist=exists_in_coupon(args.couponcode);if(couponexist>-1){var coupons=get_coupons();coupons[couponexist]&&(coupons.splice(couponexist,1),set_coupons(coupons))}}var productscount=get_products();(0,_jquery.default)(".basketicon").html('<span class="basketcount">'+productscount.length+"</span>")},empty_cart=function(){localStorage.removeItem("products"),localStorage.removeItem("coupons"),localStorage.removeItem("productformdata"),get_product_information(),(0,_jquery.default)(".basketicon").html('<span class="basketcount">0</span>')},get_checkout_summary=function(formdata){var products=get_products();!function(formdata){localStorage.setItem("productformdata",JSON.stringify(formdata))}(formdata);var productformdata=get_productformdata();_ajax.default.call([{methodname:"tool_product_checkout_summary",args:{products:products,formdata:productformdata}}])[0].done((function(response){render_checkout_page(response)})).fail((function(error){(new _homepage8.default).confirmbox(error.error)}))},render_checkout_page=function(response){var productformdata=get_productformdata();render_template("tool_product/checkout/summary",'[data-region="order-summary"]',response,!1),render_template("tool_product/checkout/payment-methods",'[data-region="payment-methods"]',{summary:JSON.stringify(response.productdata),data:response,formdata:JSON.stringify(productformdata)},!1),(0,_jquery.default)("#checkout-loader").empty()},render_paymentsummary_page=function(response){if(1==response.coupondiscounfailed){var productformdata=get_productformdata();render_template("tool_product/checkout/index","#checkout_container",{formdata:JSON.stringify(productformdata),coupondiscounfailed:!0},!1)}else localStorage.removeItem("products"),localStorage.removeItem("coupons"),localStorage.removeItem("productformdata"),render_template("tool_product/paymentsummary","#checkout_container",response,!1)},exists_in_cart=function(args){var products=get_products();return products?products.findIndex((function(x){return x.category==args.category&&x.product==args.product})):-1},render_cart_page=function(response){var formatted_response=format_cart_response(response);response.formatted_response=formatted_response,render_template("tool_product/cart/empty-cart-button",'[data-region="empty-cart-button"]',response,!1),render_template("tool_product/cart/content",'[data-region="cart-body"]',response,!1),(0,_jquery.default)("#cart-loader").empty()},format_cart_response=function(response){var result=[],items=response.items;result=[];for(var elements=[],_loop=function(i){if(0!=items[i].grouped){if(-1==elements.findIndex((function(x){return x===items[i].grouped}))){var group={isgrouped:!0};group.title=get_group_title(response.tracks,items[i].grouped),group.id=items[i].grouped,group.subitems=get_grouped_items(items,items[i].grouped),result.push(group),elements.push(items[i].grouped)}}else items[i].isgrouped=!1,result.push(items[i])},i=0;i<items.length;i++)_loop(i);return result},get_grouped_items=function(response,group){for(var data=[],i=0;i<response.length;i++)response[i].grouped==group&&data.push(response[i]);return data},get_group_title=function(tracks,group){var index=tracks.findIndex((function(x){return x.id==group}));if(-1!=index)return tracks&&tracks[index]?tracks[index].name:""},render_template=function(template,selector,params){var append=arguments.length>3&&void 0!==arguments[3]&&arguments[3];append||(0,_jquery.default)(selector).empty(),_templates.default.renderForPromise(template,params).then((function(_ref){var html=_ref.html,js=_ref.js;_templates.default.appendNodeContents(selector,html,js)}))},loader=function(selector,isloading){var append=arguments.length>2&&void 0!==arguments[2]&&arguments[2];isloading?render_template("tool_product/loader",selector,{},append):(0,_jquery.default)("[data-region='page-loader']").remove()},get_variation_buttons=function(selector){(0,_jquery.default)(selector).each((function(key,value){(0,_str.get_string)("select","tool_product").done((function(html,js){(0,_jquery.default)(value).text(html)}))}))},process_creditcard_payments=function(root,products){var promise=_ajax.default.call([{methodname:"tool_product_telr_begin_trans",args:{products:products}}]);render_template("tool_product/loader"),promise[0].done((function(response){if(response.noseats){var productname=(0,_str.get_string)("noseatsavailable","tool_product",response.productname);_modal_factory.default.create({title:"",type:_modal_factory.default.types.SAVE_CANCEL,body:productname}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("ok","tool_product")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),promise[0].done((function(){for(var i=0;i<response.products.length;i++){var data={};data.category=response.products[i].category,data.product=response.products[i].productid,remove_from_cart(data,!1)}window.location.reload(!0)})).fail((function(){}))}.bind(this)),modal.show()}.bind(undefined))}else window.location.href=response.returnurl})).fail((function(error){(new _homepage8.default).confirmbox(error.message)}))},add=function(root){(0,_jquery.default)(root).on("click",(function(e){e.preventDefault();var args=get_attributes((0,_jquery.default)(root));if(args.language=(0,_jquery.default)(root).data("language"),args.hallscheduleid=(0,_jquery.default)(root).data("hallscheduleid"),args.profileid=(0,_jquery.default)(root).data("profileid"),args.processtype=(0,_jquery.default)(root).data("processtype"),args.loggedin=(0,_jquery.default)(root).data("loggedin"),args.tandc=(0,_jquery.default)(root).data("tandc"),get_product_id(args))if(void 0!==args.hallscheduleid)if(0==args.loggedin)_modal_factory.default.create({type:_loginModal.default.TYPE},(0,_jquery.default)(e.currentTarget));else{var title=(0,_str.get_string)("tandc","local_exams"),form=new _modalform.default({formClass:"local_exams\\form\\termsconditionsform",args:{examid:args.product},modalConfig:{title:title},saveButtonText:(0,_str.get_string)("confirm","local_exams")});if(form.addEventListener(form.events.FORM_SUBMITTED,(function(event){if(event.detail.tandc>0){var tandcconfirm=1;(0,_jquery.default)(event.currentTarget).find('button[data-action="save"]').attr("disabled",!1)}else{tandcconfirm=0;(0,_jquery.default)(event.currentTarget).find('button[data-action="save"]').attr("disabled",!0)}loader("#halls_section",!0,!0),_ajax.default.call([{methodname:"local_exams_validateexamschedule",args:{product_id:args.variation,hallscheduelid:args.hallscheduleid,profileid:args.profileid}}])[0].done((function(response){var homepage=new _homepage8.default;loader("#halls_section",!1),1==response.success?(args.tandcconfirm=tandcconfirm,add_to_cart(args,(0,_jquery.default)(root).parent()),window.location.href=M.cfg.wwwroot+"/admin/tool/product/cart.php"):(homepage.confirmbox(response.messages),(0,_jquery.default)(e.currentTarget).attr("disabled",!0))})).fail((function(error){loader("#halls_section",!1),(new _homepage8.default).confirmbox(error.messages)}))})),1==args.tandc)form.show();else loader("#halls_section",!0,!0),_ajax.default.call([{methodname:"local_exams_validateexamschedule",args:{product_id:args.variation,hallscheduelid:args.hallscheduleid,profileid:args.profileid}}])[0].done((function(response){var homepage=new _homepage8.default;loader("#halls_section",!1),1==response.success?(add_to_cart(args,(0,_jquery.default)(root).parent()),window.location.href=M.cfg.wwwroot+"/admin/tool/product/cart.php"):(homepage.confirmbox(response.messages),(0,_jquery.default)(e.currentTarget).attr("disabled",!0))})).fail((function(error){loader("#halls_section",!1),(new _homepage8.default).confirmbox(error.messages)}))}else add_to_cart(args,(0,_jquery.default)(root).parent());else(new _homepage8.default).confirmbox(args.errortext)}))};_exports.add=add;var addprogramregister=function(root){(0,_jquery.default)(root).on("click",(function(e){e.preventDefault();var args=get_attributes(root);args.tptandc=(0,_jquery.default)(root).data("tptandc"),args.isloggedin=(0,_jquery.default)(root).data("isloggedin"),args.programid=(0,_jquery.default)(root).data("programid");var selector='[data-action="'+args.parent+'"]';get_variation_buttons('[data-type="'+args.type+'"]');if(args.checkout)if(0==args.isloggedin)_modal_factory.default.create({type:_loginModal.default.TYPE},(0,_jquery.default)(e.currentTarget));else if(1==args.tptandc){var title=(0,_str.get_string)("tptandc","local_trainingprogram"),form=new _modalform.default({formClass:"local_trainingprogram\\form\\termsandconditions",args:{programid:args.programid},modalConfig:{title:title},saveButtonText:(0,_str.get_string)("confirm","local_trainingprogram")});form.addEventListener(form.events.FORM_SUBMITTED,(function(event){event.detail.tptandc>0&&((0,_jquery.default)(selector).data("variation",args.variation),(0,_jquery.default)(selector).prop("disabled",!1),(0,_str.get_string)("selected","tool_product").done((function(html,js){(0,_jquery.default)(root).text(html)})),(0,_jquery.default)("[data-action='"+args.parent+"']").trigger("click"),window.location.href=M.cfg.wwwroot+"/admin/tool/product/cart.php")})),1==args.tptandc?form.show():window.location.href=M.cfg.wwwroot+"/admin/tool/product/cart.php"}else{(0,_jquery.default)(selector).data("variation",args.variation),(0,_jquery.default)(selector).prop("disabled",!1),(0,_str.get_string)("selected","tool_product").done((function(html,js){(0,_jquery.default)(root).text(html)})),(0,_jquery.default)("[data-action='"+args.parent+"']").trigger("click"),window.location.href=M.cfg.wwwroot+"/admin/tool/product/cart.php"}}))};_exports.addprogramregister=addprogramregister;var addregister=function(root,targetparent){var args=get_attributes((0,_jquery.default)(root));get_product_id(args)?(add_to_cart(args,(0,_jquery.default)(root).parent()),render_template("tool_product/cart/register",targetparent,{checkout:!0}),window.location=M.cfg.wwwroot+"/admin/tool/product/cart.php"):(new _homepage8.default).confirmbox(args.errortext)};_exports.addregister=addregister;var add_order_seats=function(root){var args=get_attributes((0,_jquery.default)(root));if(get_product_id(args)){var title=(0,_str.get_string)("seatreservation","tool_product"),form=new _modalform.default({formClass:"tool_product\\form\\seatreservationform",args:{seatsdata:args.seatsdata,productid:args.product,autoapproval:args.autoapproval},modalConfig:{title:title}});form.addEventListener(form.events.FORM_SUBMITTED,(function(event){1==args.autoapproval?(event.preventDefault(),_ajax.default.call([{methodname:"tool_product_postpaid_payments",args:{products:event.detail.returnparams}}])[0].done((function(response){var params={};params.orderid=response.paymentid,_ajax.default.call([{methodname:"tool_product_get_orderinfo",args:params}])[0].done((function(resp){if(resp){var promises=_ajax.default.call([{methodname:"tool_product_generate_sadadbill",args:{products:resp.info}}]);render_template("tool_product/loader"),promises[0].done((function(response){window.location.reload()})).fail((function(error){(new _homepage8.default).confirmbox(error.message)}))}})).fail((function(error){homepage.confirmbox(error.message)}))})).fail((function(error){(new _homepage8.default).confirmbox(error.error)}))):_ajax.default.call([{methodname:"tool_product_postpaid_payments",args:{products:event.detail.returnparams}}])[0].done((function(response){(new _homepage8.default).confirmbox((0,_str.get_string)("ordersubmitted","tool_product"))})).fail((function(error){(new _homepage8.default).confirmbox(error.error)}))})),form.show()}else{(new _homepage8.default).confirmbox(args.errortext)}};_exports.add_order_seats=add_order_seats;var add_learningtrack_order_seats=function(root){var args=get_attributes((0,_jquery.default)(root));if(get_product_id(args)){var title=(0,_str.get_string)("seatreservation","tool_product"),form=new _modalform.default({formClass:"tool_product\\form\\learningtrackseatreservationform",args:{seatsdata:args.seatsdata,productid:args.product},modalConfig:{title:title}});form.addEventListener(form.events.FORM_SUBMITTED,(function(event){_templates.default.render("tool_product/add_learningtrack_order_seats",{product_attributes:event.detail.returnparams}).then((function(html,js){(0,_jquery.default)('[data-region="booking-order-summary"]').html(html),(0,_jquery.default)('[data-region="booking-order-summary"]').append(event.detail.returnurlbtn),_templates.default.runTemplateJS(js)})).always((function(){})).fail()})),form.show()}else{(new _homepage8.default).confirmbox(args.errortext)}};_exports.add_learningtrack_order_seats=add_learningtrack_order_seats;var checkout=function(formdata){get_checkout_summary(formdata)};_exports.checkout=checkout;var cart=function(){get_product_information()};_exports.cart=cart;var cart_actions=function(root){(0,_jquery.default)(root).on("click",(function(e){e.preventDefault();var args=get_attributes((0,_jquery.default)(root));switch(args.action){case"remove":remove_from_cart(args);break;case"remove-group":!function(args){for(var products=get_products(),i=0;i<products.length;i++)if(products[i]&&products[i].grouped==args.product){var data={};data.category=products[i].category,data.product=products[i].product,remove_from_cart(data,!1)}get_product_information()}(args);break;case"applycoupon":!function(args){if(exists_in_cart(args)>-1){var data={product:args.product,couponcode:(0,_jquery.default)("#couponcode-"+args.product).val(),category:args.category};_ajax.default.call([{methodname:"tool_product_validate_couponcode",args:{products:data}}])[0].done((function(response){var couponindex=exists_in_coupon(response.couponcode);if(0==response.couponvalid)(0,_jquery.default)("#couponmsg-"+args.product).html(response.couponmsg);else{var couponincart=exists_in_cart(args),productsdata=get_products();if(couponincart>-1&&productsdata[couponincart]){productsdata[couponincart].couponcode=response.couponcode,productsdata[couponincart].couponid=response.couponid,productsdata[couponincart].roles=response.roles,set_product(productsdata);var coupons=get_coupons(),couponcodedata={couponcode:response.couponcode};couponindex>-1&&couponindex==args.product&&coupons[couponindex]?coupons[couponindex]=couponcodedata:coupons[args.product]=couponcodedata,set_coupons(coupons)}if(0==response.roles)render_template("tool_product/cart/index","#cart_container",response,!1);else{var productformdata=get_productformdata();render_template("tool_product/checkout/index","#checkout_container",{formdata:JSON.stringify(productformdata)},!1)}}})).fail((function(error){(new _homepage8.default).confirmbox(error.error)}))}}(args);break;case"removecoupon":!function(args){var couponincart=exists_in_cart(args),productsdata=get_products();if(couponincart>-1&&productsdata[couponincart]){productsdata[couponincart].couponcode=0,productsdata[couponincart].couponid=0,set_product(productsdata);var couponexist=exists_in_coupon(args.couponcode);if(couponexist>-1){var coupons=get_coupons();coupons[couponexist]&&(coupons.splice(couponexist,1),set_coupons(coupons))}}if(0==productsdata[couponincart].roles)render_template("tool_product/cart/index","#cart_container",productsdata,!1);else{var productformdata=get_productformdata();render_template("tool_product/checkout/index","#checkout_container",{formdata:JSON.stringify(productformdata)},!1)}}(args);break;case"empty":empty_cart()}}))};_exports.cart_actions=cart_actions;var variations=function(root){(0,_jquery.default)(root).on("click",(function(e){e.preventDefault();var args=get_attributes(root);args.tptandc=(0,_jquery.default)(root).data("tptandc"),args.isloggedin=(0,_jquery.default)(root).data("isloggedin"),args.programid=(0,_jquery.default)(root).data("programid");var selector='[data-action="'+args.parent+'"]';get_variation_buttons('[data-type="'+args.type+'"]');if(args.checkout)if(0==args.isloggedin)_modal_factory.default.create({type:_loginModal.default.TYPE},(0,_jquery.default)(e.currentTarget));else if(1==args.tptandc){var title=(0,_str.get_string)("tptandc","local_trainingprogram"),form=new _modalform.default({formClass:"local_trainingprogram\\form\\termsandconditions",args:{programid:args.programid},modalConfig:{title:title},saveButtonText:(0,_str.get_string)("confirm","local_trainingprogram")});form.addEventListener(form.events.FORM_SUBMITTED,(function(event){event.detail.tptandc>0&&((0,_jquery.default)(selector).data("variation",args.variation),(0,_jquery.default)(selector).prop("disabled",!0),args.tptandc=0,(0,_str.get_string)("selected","tool_product").done((function(html,js){(0,_jquery.default)(root).text(html)})),(0,_jquery.default)("[data-action='"+args.parent+"']").trigger("click"))})),1==args.tptandc&&form.show()}else{(0,_jquery.default)(selector).data("variation",args.variation),(0,_jquery.default)(selector).prop("disabled",!1),(0,_str.get_string)("selected","tool_product").done((function(html,js){(0,_jquery.default)(root).text(html)})),(0,_jquery.default)("[data-action='"+args.parent+"']").trigger("click")}}))};_exports.variations=variations;var make_payment=function(root){(0,_jquery.default)(root).on("click",(function(e){e.preventDefault(),e.stopImmediatePropagation(),(0,_jquery.default)(e.target).attr("disabled",!0);var method=(0,_jquery.default)("[name=payment-method]:checked").val(),products=(0,_jquery.default)(root).data("summary");switch(void 0===method&&process_creditcard_payments(0,products),method){case"postpaid":!function(root,products){_ajax.default.call([{methodname:"tool_product_postpaid_payments",args:{products:products}}])[0].done((function(response){render_paymentsummary_page(response)})).fail((function(error){(new _homepage8.default).confirmbox(error.error)}))}(0,products);break;case"prepaid":!function(root,products){_ajax.default.call([{methodname:"tool_product_prepaid_payments",args:{products:products}}])[0].done((function(response){render_paymentsummary_page(response)})).fail((function(error){(new _homepage8.default).confirmbox(error.error)}))}(0,products);break;case"telr":case"default":process_creditcard_payments(0,products)}}))};_exports.make_payment=make_payment;var paymentsinit=function(){document.addEventListener("click",(function(e){var paymentsupdate=e.target.closest(Selectors_actions.paymentsupdate);if(paymentsupdate){e.preventDefault();var title=(0,_str.get_string)("paymentsupdatedtls","tool_product",paymentsupdate.getAttribute("data-name")),form=new _modalform.default({formClass:"tool_product\\form\\paymentsupdateform",args:{id:paymentsupdate.getAttribute("data-id")},modalConfig:{title:title},returnFocus:paymentsupdate});form.addEventListener(form.events.FORM_SUBMITTED,(function(){return window.location.reload()})),form.show()}var sendemailtoorgofficial=e.target.closest(Selectors_actions.sendemailtoorgofficial);if(sendemailtoorgofficial){e.preventDefault();var _title=(0,_str.get_string)("sendemailtoorgofficial","tool_product",sendemailtoorgofficial.getAttribute("data-orgoffcialname")),_form=new _modalform.default({formClass:"tool_product\\form\\sendemailform",args:{productid:sendemailtoorgofficial.getAttribute("data-productid")},modalConfig:{title:_title},returnFocus:sendemailtoorgofficial});_form.addEventListener(_form.events.FORM_SUBMITTED,(function(){return window.location.reload()})),_form.show()}var approvalseats=e.target.closest(Selectors_actions.approvalseats);approvalseats&&(e.preventDefault(),e.stopPropagation(),approvalid=approvalseats.getAttribute("data-id"),_modal_factory.default.create({title:(0,_str.get_string)("approveorder","tool_product"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("approveorderconfirm","tool_product")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("approve","tool_product")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((function(_ref2){var html=_ref2.html,js=_ref2.js;_templates.default.appendNodeContents(".modal-content",html,js)})),(0,_jquery.default)(e.currentTarget).find('button[data-action="save"]').attr("disabled",!0);var params={};params.orderid=approvalid,_ajax.default.call([{methodname:"tool_product_get_orderinfo",args:params}])[0].done((function(resp){if(resp)if(resp.seatsinfo){var parsed_data=JSON.parse(resp.seatsinfo);if(parsed_data.seatnotexist){var seats=(0,_str.get_string)("userscountismore","local_exams",parsed_data.availableseats),_homepage5=new _homepage8.default;modal.hide(),_homepage5.confirmbox(seats)}}else{var promises=_ajax.default.call([{methodname:"tool_product_generate_sadadbill",args:{products:resp.info}}]);render_template("tool_product/loader"),promises[0].done((function(response){window.location.href=response.returnurl})).fail((function(error){(new _homepage8.default).confirmbox(error.message)}))}})).fail((function(error){(new _homepage8.default).confirmbox(error.message)}))}.bind(this)),modal.show()}.bind(this)));var cancelorder=e.target.closest(Selectors_actions.cancelorder);cancelorder&&(e.preventDefault(),approvalid=cancelorder.getAttribute("data-id"),_modal_factory.default.create({title:(0,_str.get_string)("rejectorder","tool_product"),type:_modal_factory.default.types.SAVE_CANCEL,body:(0,_str.get_string)("rejectorderconfirm","tool_product")}).done(function(modal){this.modal=modal,modal.setSaveButtonText((0,_str.get_string)("reject","tool_product")),modal.getRoot().on(_modal_events.default.save,function(e){e.preventDefault(),_templates.default.renderForPromise("tool_product/loader",{}).then((function(_ref3){var html=_ref3.html,js=_ref3.js;_templates.default.appendNodeContents(".modal-content",html,js)}));var params={};params.orderid=approvalid,_ajax.default.call([{methodname:"tool_product_rejectorder",args:params}])[0].done((function(resp){(console.log(resp.response),"success"==resp.response)?(modal.hide(),(new _homepage8.default).confirmbox((0,_str.get_string)("ordercancelled","tool_product")),setTimeout((function(){window.location=M.cfg.wwwroot+"/admin/tool/product/orderapproval.php"}),4e3)):(modal.hide(),(new _homepage8.default).confirmbox(resp.response))})).fail((function(error){}))}.bind(this)),modal.show()}.bind(this)))}))};_exports.paymentsinit=paymentsinit;var grouped_products=function(root){(0,_jquery.default)(root).on("click",(function(e){e.preventDefault();var args=get_attributes((0,_jquery.default)(root));if(args.grouped){var radios=(0,_jquery.default)("#user_assign_entities :radio"),values={};radios.each((function(){values[this.name]=(0,_jquery.default)(this).val()})),Object.entries(values).forEach((function(value,index){args.product=value[1],add_to_cart(args,!1)}));get_products();render_template("tool_product/cart/go-to-cart",(0,_jquery.default)(root).parent(),{isloggedin:args.loggedin,checkout:args.checkout})}}))};_exports.grouped_products=grouped_products;var reset_cart=function(){empty_cart()};_exports.reset_cart=reset_cart;var _default={add:add,cart:cart,checkout:checkout,variations:variations,cart_actions:cart_actions,make_payment:make_payment,paymentsinit:paymentsinit,add_order_seats:add_order_seats,addregister:addregister,grouped_products:grouped_products,add_learningtrack_order_seats:add_learningtrack_order_seats,addprogramregister:addprogramregister,reset_cart:reset_cart};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=product.min.js.map