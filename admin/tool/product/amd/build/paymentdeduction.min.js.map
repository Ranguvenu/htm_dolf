{"version":3,"file":"paymentdeduction.min.js","sources":["../src/paymentdeduction.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\nimport Modalform from 'core_form/modalform';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport homepage from 'theme_academy/homepage';\nimport $ from 'jquery';\nimport {get_string as getString} from 'core/str';\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\n\nconst Selectors = {\n    actions: {\n        deducttraineeamount: '[data-action=\"deduct-traineeamount\"]'\n    },\n};\n\nlet HomePage = new homepage();\nexport const init = () => {\n    document.addEventListener('click', function(e) {\n        // e.stopImmediatePropagation();\n        let deducttraineeamount = e.target.closest(Selectors.actions.deducttraineeamount);\n        if (deducttraineeamount) {\n            e.stopImmediatePropagation();\n            const walletid = deducttraineeamount.getAttribute('data-walletid');\n            const walletamount = deducttraineeamount.getAttribute('data-walletamount');\n            var options = {};\n            options.walletid = walletid;\n            options.walletamount = walletamount;\n            var trigger = $(Selectors.actions.deducttraineeamount);\n            ModalFactory.create({\n            title: getString('paymentdeduction', 'tool_product'),\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: Templates.render('tool_product/deductionsettings', options).done(function(html, js) {\n                                        Templates.replaceNodeContents('deductionsettings', html, js);\n                                    })\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('deduct', 'tool_product'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n                    e.preventDefault();\n                    var params = {};\n                    params.walletid = walletid;\n                    params.walletamount = walletamount;\n                    params.deductedamount = $(\"#deductedamount\").val();\n\n                    if(params.deductedamount < 0){\n                        HomePage.confirmbox(getString('deductamountisnegative', 'tool_product'));\n                    } else if(+params.deductedamount > +params.walletamount){\n                        HomePage.confirmbox(getString('deductamountismore', 'tool_product'));\n                    } else if(isNaN(params.deductedamount)){\n                        HomePage.confirmbox(getString('deductcannotbenull', 'tool_product'));\n                    } else {\n                        var promise = Ajax.call([{\n                            methodname: 'tool_product_trainee_walletamount',\n                            args: params\n                        }]);\n                        promise[0].done(function(resp) {\n                            window.location = M.cfg.wwwroot + '/admin/tool/product/financialpayments.php?mode=3';\n                        }).fail(function() {\n                            // do something with the exception\n                             console.log('exception');\n                        });\n                    }\n                }.bind(this));\n                modal.show();\n            }.bind(this));\n        }\n    });  \n};"],"names":["Selectors","deducttraineeamount","HomePage","homepage","document","addEventListener","e","target","closest","stopImmediatePropagation","walletid","getAttribute","walletamount","options","create","title","type","ModalFactory","types","SAVE_CANCEL","body","Templates","render","done","html","js","replaceNodeContents","modal","setSaveButtonText","getRoot","on","ModalEvents","save","preventDefault","params","deductedamount","val","confirmbox","isNaN","Ajax","call","methodname","args","resp","window","location","M","cfg","wwwroot","fail","console","log","bind","this","show"],"mappings":"mwBAuBMA,kBACO,CACLC,oBAAqB,4CAIzBC,SAAW,IAAIC,gCACC,KAChBC,SAASC,iBAAiB,SAAS,SAASC,OAEpCL,oBAAsBK,EAAEC,OAAOC,QAAQR,kBAAkBC,wBACzDA,oBAAqB,CACrBK,EAAEG,iCACIC,SAAWT,oBAAoBU,aAAa,iBAC5CC,aAAeX,oBAAoBU,aAAa,yBAClDE,QAAU,GACdA,QAAQH,SAAWA,SACnBG,QAAQD,aAAeA,cACT,mBAAEZ,kBAAkBC,4CACrBa,OAAO,CACpBC,OAAO,mBAAU,mBAAoB,gBACrCC,KAAMC,uBAAaC,MAAMC,YACzBC,KAAMC,mBAAUC,OAAO,iCAAkCT,SAASU,MAAK,SAASC,KAAMC,uBAChDC,oBAAoB,oBAAqBF,KAAMC,SAElFF,KAAK,SAASI,YACRA,MAAQA,MACbA,MAAMC,mBAAkB,mBAAU,SAAU,iBAC5CD,MAAME,UAAUC,GAAGC,sBAAYC,KAAM,SAAS1B,GAC1CA,EAAE2B,qBACEC,OAAS,MACbA,OAAOxB,SAAWA,SAClBwB,OAAOtB,aAAeA,aACtBsB,OAAOC,gBAAiB,mBAAE,mBAAmBC,MAE1CF,OAAOC,eAAiB,EACvBjC,SAASmC,YAAW,mBAAU,yBAA0B,sBACrD,IAAIH,OAAOC,gBAAkBD,OAAOtB,aACvCV,SAASmC,YAAW,mBAAU,qBAAsB,sBACjD,GAAGC,MAAMJ,OAAOC,gBACnBjC,SAASmC,YAAW,mBAAU,qBAAsB,qBACjD,CACWE,cAAKC,KAAK,CAAC,CACrBC,WAAY,oCACZC,KAAMR,UAEF,GAAGX,MAAK,SAASoB,MACrBC,OAAOC,SAAWC,EAAEC,IAAIC,QAAU,sDACnCC,MAAK,WAEHC,QAAQC,IAAI,kBAGvBC,KAAKC,OACP1B,MAAM2B,QACRF,KAAKC"}