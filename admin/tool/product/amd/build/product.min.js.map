{"version":3,"file":"product.min.js","sources":["../src/product.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Manages shopping cart actions.\r\n *\r\n * @module     tool_product/product\r\n * @copyright  2022 Ranga Reddy <rangareddy@eabyas.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\nimport ModalFactory from 'core/modal_factory';\r\nimport ModalForm from 'core_form/modalform';\r\nimport ModalEvents from 'core/modal_events';\r\n\r\n\r\nimport $ from 'jquery';\r\nimport {get_string as getString} from 'core/str';\r\nimport Ajax from 'core/ajax';\r\nimport Templates from 'core/templates';\r\nimport HomePageJs from \"theme_academy/homepage\";\r\nimport ModalLogin from 'tool_product/login-modal';\r\n\r\nconst Selectors = {\r\n    actions: {\r\n        paymentsupdate: '[data-action=\"paymentsupdate\"]',\r\n        approvalseats: '[data-action=\"approvalseats\"]',\r\n        sendemailtoorgofficial: '[data-action=\"sendemailtoorgofficial\"]',\r\n\t\tcancelorder: '[data-action=\"cancelorder\"]',\r\n    },\r\n};\r\n\r\nconst strings = {\r\n\tselect : 'Select',//getString('select', 'tool_product'),\r\n\tselected: 'Selected',//getString('selected', 'tool_product'),\r\n\tpleaseselectvariation: 'Please Select Variation' //getString('pleaseselectvariation', 'tool_product'),\r\n\r\n}\r\n\r\nconst get_attributes = ( selector ) => {\r\n\tlet attributes = $(selector).data();\r\n\t\r\n\treturn attributes;\r\n}\r\n\r\nconst product_has_variations = ( args ) => {\r\n\treturn args['hasvariations'];\r\n}\r\nconst get_product_id = ( args ) => {\r\n\treturn product_has_variations(args) ? args['variation'] : args['product'];\r\n}\r\n\r\nconst set_product = (products) => {\r\n\tlocalStorage.setItem('products', JSON.stringify(products));\r\n}\r\n\r\nconst get_products = () => {\r\n\tlet products = localStorage.getItem('products');\r\n\tproducts = JSON.parse(products);\r\n\treturn products ? products : [];\r\n}\r\n\r\nconst set_productformdata = (formdata) => {\r\n\tlocalStorage.setItem('productformdata', JSON.stringify(formdata));\r\n}\r\n\r\nconst get_productformdata = () => {\r\n\tlet productformdata = localStorage.getItem('productformdata');\r\n\tproductformdata = JSON.parse(productformdata);\r\n\treturn productformdata ? productformdata : [];\r\n}\r\nconst set_coupons = (coupons) => {\r\n\tlocalStorage.setItem('coupons', JSON.stringify(coupons));\r\n}\r\n\r\nconst get_coupons = () => {\r\n\tlet coupons = localStorage.getItem('coupons');\r\n\r\n\tcoupons = JSON.parse(coupons);\r\n\r\n\tif(coupons){\r\n\r\n\t\tcoupons = coupons.filter(Boolean);\r\n\r\n\t}\r\n\r\n\treturn coupons ? coupons : [];\r\n}\r\n\r\nconst exists_in_coupon = ( couponcode ) => {\r\n\tlet coupons = get_coupons();\r\n\r\n\treturn coupons ? coupons.findIndex(x => (x.couponcode == couponcode)) : -1;\r\n}\r\n\r\n\r\nconst get_product_information = () => {\r\n\tlet products = get_products();\r\n\t\r\n\tlet promise = Ajax.call([{\r\n\t\t\tmethodname: 'tool_product_view_cart',\r\n\t\t\targs: {\r\n\t\t\t\tproducts: products\r\n\t\t\t}\r\n\t\t}]);\r\n\tpromise[0].done((response) => {\r\n\t\trender_cart_page(response);\r\n\t}).fail( (error) => {\r\n\r\n\t\tlet homepage = new HomePageJs();\r\n    \thomepage.confirmbox(error.error);\r\n\t});\r\n\r\n\tlet productscount = get_products();\r\n\r\n\t$('.basketicon').html('<span class=\"basketcount\">'+productscount.length+'</span>');\r\n}\r\n\r\nconst add_to_cart = (args, parent) => {\r\n\r\n\tlet incart = exists_in_cart(args);\r\n\tlet products = get_products();\r\n\tlet data = {\r\n\t\tvariation: args['variation'],\r\n\t\tproduct: args['product'],\r\n\t\tgrouped: args['grouped'],\r\n\t\thasvariations: product_has_variations(args),\r\n\t\tquantity: args['quantity'],\r\n\t\tcategory: args['category'],\r\n\t\tlanguage: args['language'],\r\n\t\thallscheduleid: args['hallscheduleid'],\r\n\t\tprofileid: args['profileid'],\r\n\t\tprocesstype: args['processtype'],\r\n\t\ttandcconfirm: args['tandcconfirm'],\r\n\r\n\t}\r\n\tif(incart > -1 && products[incart]){\r\n\t\r\n\t\tproducts[incart] = data;\r\n\t}else{\r\n\t\tproducts.push(data);\r\n\t}\r\n\t\r\n\tset_product(products);\r\n\r\n\tlet productscount = get_products();\r\n\r\n\tif(parent){\r\n\t\trender_template('tool_product/cart/go-to-cart', parent, {isloggedin: args['loggedin'], checkout: args['checkout']});\r\n\t}\r\n\t$('.basketicon').html('<span class=\"basketcount\">'+productscount.length+'</span>');\r\n}\r\n\r\nconst remove_from_cart = ( args , refresh = true) => {\r\n\tlet index = exists_in_cart( args );\r\n\tif(index > -1){\r\n\t\tlet products = get_products();\r\n\t\tif(products[index]){\r\n\t\t\tproducts.splice(index, 1);\r\n\t\t\tset_product(products);\r\n\t\t\tif(refresh){\r\n\t\t\t\tget_product_information();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif(args['couponcode']) {\r\n\t\tlet couponexist = exists_in_coupon( args['couponcode'] );\r\n\t\tif(couponexist > -1){\r\n\t\t\tlet coupons = get_coupons();\r\n\t\t\tif(coupons[couponexist]){\r\n\t\t\t\tcoupons.splice(couponexist, 1);\r\n\t\t\t\tset_coupons(coupons);\t\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tlet productscount = get_products();\r\n\t$('.basketicon').html('<span class=\"basketcount\">'+productscount.length+'</span>');\r\n}\r\n\r\nconst remove_group_from_cart = ( args ) => {\r\n\tlet products = get_products();\r\n\tfor(let i = 0; i < products.length; i++){\r\n\t\tif(products[i] && (products[i]['grouped'] == args['product'])){\r\n\t\t\tlet data = {};\r\n\t\t\tdata['category'] = products[i]['category'];\r\n\t\t\tdata['product'] = products[i]['product'];\r\n\t\t\tremove_from_cart( data, false );\r\n\t\t}\r\n\t}\r\n\tget_product_information();\r\n}\r\n\r\nconst applycoupon_to_cart = ( args ) => {\r\n\r\n\tlet index = exists_in_cart(args);\r\n\r\n\tif(index > -1){\r\n\r\n\r\n\t\tlet data = {\r\n\t\t\tproduct: args['product'],\r\n\t\t\tcouponcode: $('#couponcode-'+args.product).val(),\r\n\t\t\tcategory: args['category']\r\n\t\t}\r\n\t\r\n\t\tlet promise = Ajax.call([{\r\n\t\t\t\t\tmethodname: 'tool_product_validate_couponcode',\r\n\t\t\t\t\targs: {\r\n\t\t\t\t\t\tproducts: data\r\n\t\t\t\t\t}\r\n\t\t\t\t}]);\r\n\t\tpromise[0].done((response) => {\r\n\r\n\r\n\t\t\tlet couponindex = exists_in_coupon(response.couponcode);\r\n\t\t\t\r\n\t\t\t if(response.couponvalid == false){\r\n\r\n\r\n\t\t\t\t$('#couponmsg-'+args.product).html(response.couponmsg);\r\n\t\t\t\t \r\n\r\n\t\t\t}else{\r\n\r\n\r\n\t\t\t\tlet couponincart = exists_in_cart(args);\r\n\r\n\r\n\t\t\t\tlet productsdata = get_products();\r\n\r\n\r\n\t\t\t\tif(couponincart > -1 && productsdata[couponincart]){\r\n\r\n\t\t\t\t\tproductsdata[couponincart]['couponcode'] = response.couponcode;\r\n\r\n\t\t\t\t\tproductsdata[couponincart]['couponid'] = response.couponid;\r\n\r\n\t\t\t\t\tproductsdata[couponincart]['roles'] = response.roles;\r\n\r\n\t\t\t\t\tset_product(productsdata);\r\n\r\n\t\t\t\t\tlet coupons = get_coupons();\r\n\r\n\t\t\t\t\tlet couponcodedata = {\r\n\t\t\t\t\t\tcouponcode: response.couponcode,\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(couponindex > -1  && couponindex == args['product'] && coupons[couponindex]){\r\n\r\n\t\t\t\t\t\tcoupons[couponindex] = couponcodedata;\r\n\r\n\t\t\t\t\t}else{\r\n\r\n\t\t\t\t\t\tcoupons[args['product']]=couponcodedata;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tset_coupons(coupons);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(response.roles == false){\r\n\r\n\t\t\t\t\trender_template('tool_product/cart/index', '#cart_container', response, false);\r\n\r\n\t\t\t\t}else{\r\n\r\n\t\t\t\t\tlet productformdata = get_productformdata();\r\n\r\n\t\t\t\t\trender_template('tool_product/checkout/index', '#checkout_container',{formdata: JSON.stringify(productformdata)}, false);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\r\n\t\t}).fail( (error) => {\r\n\t\t\tlet homepage = new HomePageJs();\r\n    \t\thomepage.confirmbox(error.error);\r\n\t\t});\r\n\t}\r\n}\r\nconst removecoupon_to_cart = ( args ) => {\r\n\r\n\r\n\tlet couponincart = exists_in_cart(args);\r\n\r\n\r\n\tlet productsdata = get_products();\r\n\r\n\r\n\tif(couponincart > -1 && productsdata[couponincart]){\r\n\r\n\t\tproductsdata[couponincart]['couponcode'] = 0;\r\n\r\n\t\tproductsdata[couponincart]['couponid'] = 0;\r\n\r\n\t\tset_product(productsdata);\r\n\r\n\t\tlet couponexist = exists_in_coupon( args['couponcode'] );\r\n\r\n\t\tif(couponexist > -1){\r\n\r\n\t\t\tlet coupons = get_coupons();\r\n\r\n\t\t\tif(coupons[couponexist]){\r\n\r\n\t\t\t\tcoupons.splice(couponexist, 1);\r\n\r\n\t\t\t\tset_coupons(coupons);\t\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tif(productsdata[couponincart]['roles'] == false){\r\n\r\n\t\trender_template('tool_product/cart/index', '#cart_container', productsdata, false);\r\n\r\n\t}else{\r\n\r\n\t\tlet productformdata = get_productformdata();\r\n\r\n\t\trender_template('tool_product/checkout/index', '#checkout_container',{formdata: JSON.stringify(productformdata)}, false);\r\n\t}\r\n\t\r\n\t\r\n}\r\nconst empty_cart = () => {\r\n\r\n\tlocalStorage.removeItem('products');\r\n\r\n\tlocalStorage.removeItem('coupons');\r\n\r\n\tlocalStorage.removeItem('productformdata');\r\n\r\n\tget_product_information();\r\n\r\n\t$('.basketicon').html('<span class=\"basketcount\">0</span>');\r\n}\r\n\r\nconst get_checkout_summary = (formdata) => {\r\n\r\n\tlet products = get_products();\r\n\r\n\tset_productformdata(formdata);\r\n\r\n\tlet productformdata = get_productformdata();\r\n\r\n\tlet promise = Ajax.call([{\r\n\t\t\tmethodname: 'tool_product_checkout_summary',\r\n\t\t\targs: {\r\n\t\t\t\tproducts: products,\r\n\t\t\t\tformdata:productformdata\r\n\t\t\t}\r\n\t\t}]);\r\n\tpromise[0].done((response) => {\r\n\t\trender_checkout_page(response);\r\n\t}).fail( (error) => {\r\n\t\tlet homepage = new HomePageJs();\r\n   \t\thomepage.confirmbox(error.error);\r\n\t});\r\n}\r\n\r\nconst render_checkout_page = (response) => {\r\n\r\n\r\n\tlet productformdata = get_productformdata();\r\n\t\r\n\trender_template('tool_product/checkout/summary', '[data-region=\"order-summary\"]', response, false);\r\n\trender_template('tool_product/checkout/payment-methods', '[data-region=\"payment-methods\"]', {summary: JSON.stringify(response.productdata), data: response,formdata: JSON.stringify(productformdata)}, false);\r\n\t$('#checkout-loader').empty();\r\n}\r\n\r\nconst render_paymentsummary_page = (response) => {\r\n\r\n\tif(response.coupondiscounfailed == true){\r\n\r\n\t\tlet productformdata = get_productformdata();\r\n\r\n\t\trender_template('tool_product/checkout/index', '#checkout_container',{formdata: JSON.stringify(productformdata),coupondiscounfailed:true}, false);\r\n\r\n\t}else{\r\n\r\n\t\tlocalStorage.removeItem('products');\r\n\r\n\t\tlocalStorage.removeItem('coupons');\r\n\r\n\t\tlocalStorage.removeItem('productformdata');\r\n\r\n\t\trender_template('tool_product/paymentsummary', '#checkout_container', response, false);\r\n\r\n\t}\r\n}\r\n\r\n\r\nconst exists_in_cart = ( args ) => {\r\n\tlet products = get_products();\r\n\treturn products ? products.findIndex(x => (x.category == args['category']) && (x.product == args['product'])) : -1;\r\n}\r\n\r\nconst render_cart_page = ( response ) => {\r\n\tlet formatted_response = format_cart_response( response );\r\n\tresponse['formatted_response'] = formatted_response;\r\n\r\n\trender_template('tool_product/cart/empty-cart-button', '[data-region=\"empty-cart-button\"]', response, false);\r\n\trender_template('tool_product/cart/content', '[data-region=\"cart-body\"]', response, false);\r\n\t$('#cart-loader').empty();\r\n}\r\n\r\nconst format_cart_response = ( response ) => {\r\n\tlet result  = [];\r\n\tlet items = response.items;\r\n\tresult = [];\r\n\tlet elements = [];\r\n\tfor(let i = 0; i < items.length; i++){\r\n\t\tif(items[i]['grouped'] != 0){\r\n\t\t\tlet index = elements.findIndex( x => x === items[i]['grouped']);\r\n\t\t\tif( index == -1 ){\r\n\t\t\t\tlet group = {};\r\n\t\t\t\tgroup['isgrouped'] = true;\r\n\t\t\t\tgroup['title'] = get_group_title(response.tracks, items[i]['grouped']);\r\n\t\t\t\tgroup['id'] = items[i]['grouped'];\r\n\t\t\t\tgroup['subitems'] = get_grouped_items(items, items[i]['grouped']);\r\n\t\t\t\tresult.push(group);\r\n\t\t\t\telements.push(items[i]['grouped']);\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\titems[i]['isgrouped'] = false;\r\n\t\t\tresult.push(items[i]);\r\n\t\t}\r\n\t}\r\n\treturn result;\r\n}\r\n\r\n\r\nconst get_grouped_items = ( response, group) => {\r\n\tlet data = [];\r\n \tfor(let i = 0; i < response.length; i++){ \t\t\r\n \t\tif(response[i]['grouped'] == group){\r\n \t\t\tdata.push(response[i]);\r\n \t\t}\r\n \t}\r\n\treturn data;\r\n}\r\n\r\nconst get_group_title = (tracks, group) => {\r\n\tlet index = tracks.findIndex(x => x.id == group);\r\n\tif(index != -1){\r\n\t\treturn (tracks && tracks[index]) ? tracks[index]['name'] : '';\r\n\t}\r\n}\r\n\r\nconst render_template = (template, selector, params, append = false) => {\r\n\tif(!append){\r\n\t\t$(selector).empty();\r\n\t}\r\n\tTemplates.renderForPromise(template, params).then(({html, js}) => {\r\n\t\tTemplates.appendNodeContents(selector, html, js);\r\n\t});\t\r\n}\r\n\r\nconst loader = (selector, isloading, append = false) => {\r\n\tif(isloading){\r\n\t\trender_template('tool_product/loader', selector, {}, append);\r\n\t}else{\r\n\t\t$(\"[data-region='page-loader']\").remove();\r\n\t}\r\n}\r\n\r\nconst get_variation_buttons = ( selector ) =>{\r\n \t$(selector).each( (key, value) => {\r\n \t    var selectString  = getString('select' ,'tool_product');\r\n\t\tselectString.done(function(html, js){\r\n\t\t\t$(value).text(html);\r\n\t\t});\r\n \t\t////$(value).text(strings.select);\r\n \t});\r\n}\r\n\r\nconst process_postpaid_payments = (root, products) => {\r\n\r\n\tlet promise = Ajax.call([{\r\n\t\t\tmethodname: 'tool_product_postpaid_payments',\r\n\t\t\targs: {\r\n\t\t\t\tproducts: products\r\n\t\t\t\t// paymenttype: 'postpaid'\r\n\t\t\t}\r\n\t\t}]);\r\n\tpromise[0].done((response) => {\r\n\t\trender_paymentsummary_page(response);\r\n\t\t// window.location.href = response.returnurl;\r\n\t}).fail( (error) => {\r\n\r\n\t\tlet homepage = new HomePageJs();\r\n\t\thomepage.confirmbox(error.error);\r\n\r\n\t});\r\n}\r\n\r\nconst process_prepaid_payments = (root, products) => {\r\n\tlet promise = Ajax.call([{\r\n\t\t\tmethodname: 'tool_product_prepaid_payments',\r\n\t\t\targs: {\r\n\t\t\t\tproducts: products\r\n\t\t\t}\r\n\t\t}]);\r\n\tpromise[0].done((response) => {\r\n\t\trender_paymentsummary_page(response);\r\n\t}).fail( (error) => {\r\n\t\tlet homepage = new HomePageJs();\r\n\t\thomepage.confirmbox(error.error);\r\n\t});\r\n}\r\n\r\nconst process_creditcard_payments = (root, products) => {\r\n\tlet promise = Ajax.call([{\r\n\t\tmethodname: 'tool_product_telr_begin_trans',\r\n\t\targs: {\r\n\t\t\tproducts: products\r\n\t\t}\r\n\t}]);\r\n\trender_template('tool_product/loader');\r\n\tpromise[0].done((response) => {\r\n\t\tif(response.noseats) {\r\n\t\t\tlet productname = getString('noseatsavailable', 'tool_product', response.productname);\r\n\t\t\tModalFactory.create({\r\n                title: '',\r\n                type: ModalFactory.types.SAVE_CANCEL,\r\n                body: productname\r\n            }).done(function(modal) {\r\n                this.modal = modal;\r\n                modal.setSaveButtonText(getString('ok', 'tool_product'));\r\n                modal.getRoot().on(ModalEvents.save, function(e) {\r\n                    e.preventDefault();\r\n                    promise[0].done(function() {\r\n\t\t\t\t\t\tfor(let i = 0; i < response.products.length; i++){\r\n\t\t\t\t\t\t\tlet data = {};\r\n\t\t\t\t\t\t\tdata['category'] = response.products[i]['category'];\r\n\t\t\t\t\t\t\tdata['product'] = response.products[i]['productid'];\r\n\t\t\t\t\t\t\tremove_from_cart(data, false );\r\n\t\t\t\t\t\t}\r\n                        window.location.reload(true);\r\n                    }).fail(function() {\r\n                        // do something with the exception\r\n                    });\r\n                }.bind(this));\r\n                modal.show();\r\n            }.bind(this));\r\n\t\t} else {\r\n\t\t\twindow.location.href = response.returnurl;\r\n\t\t}\r\n\t}).fail( (error) => {\r\n\t\tlet homepage = new HomePageJs();\r\n\t\thomepage.confirmbox(error.message);\r\n\t});\r\n}\r\n\r\nexport const add = ( root ) => {\r\n\t$(root).on('click', (e) => {\r\n\t\te.preventDefault();\r\n\t\tvar args = get_attributes($(root));\r\n\t\targs.language = $(root).data('language');\r\n\t\targs.hallscheduleid = $(root).data('hallscheduleid');\r\n\t\targs.profileid = $(root).data('profileid');\r\n\t\targs.processtype = $(root).data('processtype');\r\n\t\targs.loggedin = $(root).data('loggedin');\r\n\t\targs.tandc = $(root).data('tandc');\r\n\t\t\r\n\r\n\t\tif( get_product_id(args)){\r\n\r\n\t\t\tif(args.hallscheduleid !== undefined){\r\n\t\t\t\tif(args.loggedin==false){\r\n\t\t\t\t\tModalFactory.create({type: ModalLogin.TYPE}, $(e.currentTarget)); \r\n\t\t\t\t}else{\r\n\r\n\t\t\t\t\tconst title = getString('tandc', 'local_exams');\r\n\t\t\t\t\tconst form = new ModalForm({\r\n\t\t\t\t\tformClass: 'local_exams\\\\form\\\\termsconditionsform',\r\n\t\t\t\t\targs: {examid:args.product},\r\n\t\t\t\t\tmodalConfig: {title},\r\n\t\t\t\t\tsaveButtonText: getString('confirm', 'local_exams'),\r\n\t\t\t\t\r\n\r\n\t\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tform.addEventListener(form.events.FORM_SUBMITTED, (event) => {\r\n\t\t\t\t\t\r\n\t\t\t\tconst data = event.detail;\r\n\t\t\t\t\tif(data.tandc > 0) {\r\n\r\n\t\t\t\t\tvar tandcconfirm = 1;\r\n\t\t\t\t\t$(event.currentTarget).find('button[data-action=\"save\"]').attr('disabled', false);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar tandcconfirm = 0;\r\n\t\t\t\t\t$(event.currentTarget).find('button[data-action=\"save\"]').attr('disabled', true);\r\n\t\t\t\t}\r\n\t\t\t\t\tloader(\"#halls_section\", true, true);\r\n\t\t\t\t\t\tlet promise = Ajax.call([{\r\n\t\t\t\t\t\t\tmethodname: 'local_exams_validateexamschedule',\r\n\t\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\t\tproduct_id: args.variation,\r\n\t\t\t\t\t\t\t\thallscheduelid: args.hallscheduleid,\r\n\t\t\t\t\t\t\t\tprofileid: args.profileid,\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}]);\r\n\r\n\t\t\t\t\t\t\tpromise[0].done((response) => {\r\n\t\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\tloader(\"#halls_section\", false);\r\n\t\t\t\t\t\t\tif(response.success == true){\r\n\t\t\t\t\t\t\t\targs.tandcconfirm = tandcconfirm;\r\n\t\t\t\t\t\t\t\tadd_to_cart(args, $(root).parent());\r\n\t\t\t\t\t\t\t\twindow.location.href = M.cfg.wwwroot+\"/admin/tool/product/cart.php\";\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\thomepage.confirmbox(response.messages);\r\n\t\t\t\t\t\t\t\t$(e.currentTarget).attr('disabled', true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}).fail( (error) => {\r\n\t\t\t\t\t\t\tloader(\"#halls_section\", false);\r\n\t\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\t\thomepage.confirmbox(error.messages);\r\n\t\t\t\t\t\t});\r\n\r\n\r\n\r\n\t\t});\r\n\t\tif(args.tandc == 1){\r\n\t\tform.show();\r\n\t\t}else{\r\n\t\t\tloader(\"#halls_section\", true, true);\r\n\t\t\t\t\t\tlet promise = Ajax.call([{\r\n\t\t\t\t\t\t\tmethodname: 'local_exams_validateexamschedule',\r\n\t\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\t\tproduct_id: args.variation,\r\n\t\t\t\t\t\t\t\thallscheduelid: args.hallscheduleid,\r\n\t\t\t\t\t\t\t\tprofileid: args.profileid,\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}]);\r\n\r\n\t\t\t\t\t\t\tpromise[0].done((response) => {\r\n\t\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\r\n\t\t\t\t\t\t\tloader(\"#halls_section\", false);\r\n\t\t\t\t\t\t\tif(response.success == true){\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tadd_to_cart(args, $(root).parent());\r\n\t\t\t\t\t\t\t\twindow.location.href = M.cfg.wwwroot+\"/admin/tool/product/cart.php\";\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\thomepage.confirmbox(response.messages);\r\n\t\t\t\t\t\t\t\t$(e.currentTarget).attr('disabled', true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t}).fail( (error) => {\r\n\t\t\t\t\t\t\tloader(\"#halls_section\", false);\r\n\t\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\t\thomepage.confirmbox(error.messages);\r\n\t\t\t\t\t\t});\r\n\r\n\r\n\r\n\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\t\r\n\t\t\t\tadd_to_cart(args, $(root).parent());\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\n\t\t}else{\r\n\t\t\tlet homepage = new HomePageJs();\r\n\t\t\thomepage.confirmbox(args['errortext']);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\n\r\n\r\nexport const addprogramregister = ( root) => {\r\n\r\n\t$(root).on('click', (e) => {\r\n\t\te.preventDefault();\r\n\t\tvar args = get_attributes(root);\r\n\t\targs.tptandc = $(root).data('tptandc');\r\n\t\targs.isloggedin = $(root).data('isloggedin');\r\n\t\targs.programid = $(root).data('programid');\r\n\r\n\t\tlet selector = '[data-action=\"'+args['parent']+'\"]';\r\n\t\tlet buttons = get_variation_buttons('[data-type=\"'+args['type']+'\"]');\r\n\t\t\r\n\t\t\r\n\t\tif(args['checkout']){\r\n\t\t\tif(args.isloggedin==false){\r\n\t\t\t\t\tModalFactory.create({type: ModalLogin.TYPE}, $(e.currentTarget)); \r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif(args.tptandc==1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconst title = getString('tptandc', 'local_trainingprogram');\r\n\t\t\t\t\t\t\tconst form = new ModalForm({\r\n\t\t\t\t\t\t\tformClass: 'local_trainingprogram\\\\form\\\\termsandconditions',\r\n\t\t\t\t\t\t\targs: {programid:args.programid},\r\n\t\t\t\t\t\t\tmodalConfig: {title},\r\n\t\t\t\t\t\t\tsaveButtonText: getString('confirm', 'local_trainingprogram'),\r\n\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tform.addEventListener(form.events.FORM_SUBMITTED, (event) => {\r\n\t\t\t\r\n\t\t\t\t\t\tconst data = event.detail;\r\n\t\t\t\t\t\t\tif(data.tptandc > 0) {\r\n\t\t\t\t\t\t\t$(selector).data('variation', args['variation']);\r\n\t\t\t\t\t\t\t$(selector).prop('disabled', false);\r\n\t\t\t\t\t\t\tvar selectedString  = getString('selected' ,'tool_product');\r\n\t\t\t\t\t\t\tselectedString.done(function(html, js){\r\n\t\t\t\t\t\t\t\t$(root).text(html);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t$(\"[data-action='\"+args['parent']+\"']\").trigger('click');\r\n\t\t\t\t\t\t\twindow.location.href = M.cfg.wwwroot+\"/admin/tool/product/cart.php\";\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif(args.tptandc == 1){\r\n\t\t\t\t\t\t\tform.show();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\twindow.location.href = M.cfg.wwwroot+\"/admin/tool/product/cart.php\";\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$(selector).data('variation', args['variation']);\r\n\t\t\t\t\t\t\t$(selector).prop('disabled', false);\r\n\t\t\t\t\t\t\tvar selectedString  = getString('selected' ,'tool_product');\r\n\t\t\t\t\t\t\tselectedString.done(function(html, js){\r\n\t\t\t\t\t\t\t\t$(root).text(html);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$(\"[data-action='\"+args['parent']+\"']\").trigger('click');\r\n\t\t\t\t\t\twindow.location.href = M.cfg.wwwroot+\"/admin/tool/product/cart.php\";\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\t\r\n\t\t}\r\n\t    \r\n\t});\r\n}\r\nexport const addregister = ( root,targetparent ) => {\r\n\r\n   var args = get_attributes($(root));\r\n\r\n   if(get_product_id(args)){\r\n\r\n   \t    add_to_cart(args, $(root).parent());\r\n\r\n\r\n       render_template('tool_product/cart/register',targetparent, {checkout:true});\r\n\r\n\r\n       window.location = M.cfg.wwwroot + \"/admin/tool/product/cart.php\";\r\n\r\n\r\n   }else{\r\n        let homepage = new HomePageJs();\r\n        homepage.confirmbox(args['errortext']);\r\n    }\r\n}\r\nexport const add_order_seats = ( root ) => {\r\n\r\n\t\tvar args = get_attributes($(root));\r\n\r\n\r\n\t\tif(get_product_id(args)){\r\n\r\n        \r\n            const title = getString('seatreservation', 'tool_product');\r\n\t\t\t\r\n            const form = new ModalForm({\r\n                formClass: 'tool_product\\\\form\\\\seatreservationform',\r\n                args: {seatsdata: args['seatsdata'],productid: args['product'], autoapproval: args['autoapproval']},\r\n                modalConfig: {title},\r\n            });\r\n\t\t\r\n            form.addEventListener(form.events.FORM_SUBMITTED, (event) => {\r\n\t\t\t\tif (args['autoapproval'] == 1) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tlet promise = Ajax.call([{\r\n\t\t\t\t\t\tmethodname: 'tool_product_postpaid_payments',\r\n\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\tproducts: event.detail.returnparams\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}]);\r\n\t\t\t\t\tpromise[0].done((response) => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvar params = {};\r\n\t\t\t\t\t\tparams.orderid = response.paymentid;\r\n\t\t\t\t\t\tvar promise = Ajax.call([{\r\n\t\t\t\t\t\t\tmethodname: 'tool_product_get_orderinfo',\r\n\t\t\t\t\t\t\targs: params\r\n\t\t\t\t\t\t}]);\r\n\t\t\t\t\t\tpromise[0].done(function(resp) {\r\n\t\t\t\t\t\t\tif (resp) {\r\n\t\t\t\t\t\t\t\tlet promises = Ajax.call([{\r\n\t\t\t\t\t\t\t\t\tmethodname: 'tool_product_generate_sadadbill',\r\n\t\t\t\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\t\t\t\tproducts: resp.info\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}]);\r\n\t\t\t\t\t\t\t\trender_template('tool_product/loader');\r\n\t\t\t\t\t\t\t\tpromises[0].done((response) => {\r\n\t\t\t\t\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\t\t\t\t}).fail( (error) => {\r\n\t\t\t\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\t\t\t\thomepage.confirmbox(error.message);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}).fail( (error) => {\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\thomepage.confirmbox(error.message);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).fail( (error) => {\t\t\t\t\r\n\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\thomepage.confirmbox(error.error);\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet promise = Ajax.call([{\r\n\t\t\t\t\t\tmethodname: 'tool_product_postpaid_payments',\r\n\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\tproducts: event.detail.returnparams\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}]);\r\n\t\t\t\t\tpromise[0].done((response) => {\r\n\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\thomepage.confirmbox(getString('ordersubmitted', 'tool_product'));\r\n\t\t\t\t\t}).fail( (error) => {\t\t\t\t\r\n\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\thomepage.confirmbox(error.error);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n            });\r\n            form.show();\r\n\r\n\t\t}else{\r\n\t\t\tlet homepage = new HomePageJs();\r\n\t\t\thomepage.confirmbox(args['errortext']);\r\n\t\t}\r\n\r\n}\r\nexport const add_learningtrack_order_seats = ( root ) => {\r\n\r\n\r\n\t\tvar args = get_attributes($(root));\r\n\r\n\r\n\r\n\t\tif(get_product_id(args)){\r\n\r\n        \r\n            const title = getString('seatreservation', 'tool_product');\r\n            \r\n            const form = new ModalForm({\r\n                formClass: 'tool_product\\\\form\\\\learningtrackseatreservationform',\r\n                args: {seatsdata: args['seatsdata'],productid: args['product']},\r\n                modalConfig: {title},\r\n            });\r\n            form.addEventListener(form.events.FORM_SUBMITTED, (event) => {\r\n\r\n\r\n                Templates.render('tool_product/add_learningtrack_order_seats',{product_attributes:event.detail.returnparams})\r\n                .then(function(html, js) {\r\n\r\n                    $('[data-region=\"booking-order-summary\"]').html(html);\r\n\r\n                    $('[data-region=\"booking-order-summary\"]').append(event.detail.returnurlbtn);\r\n\r\n                   Templates.runTemplateJS(js);    \r\n\r\n                    return;\r\n                })\r\n                .always(function() {\r\n                    return;\r\n                })\r\n                .fail();\r\n                    \r\n\r\n            });\r\n            form.show();\r\n\r\n\t\t}else{\r\n\t\t\tlet homepage = new HomePageJs();\r\n\t\t\thomepage.confirmbox(args['errortext']);\r\n\t\t}\r\n\r\n}\r\nexport const checkout = ( formdata ) => {\r\n\tget_checkout_summary(formdata);\r\n}\r\n\r\nexport const cart = () => {\r\n\tget_product_information();\r\n}\t\r\n\r\nexport const cart_actions = ( root ) => {\r\n\t$(root).on('click', (e) => {\r\n\t\te.preventDefault();\r\n\t\tlet args = get_attributes($(root));\r\n\t\tswitch(args['action']){\r\n\t\t\tcase 'remove':\r\n\t\t\t\tremove_from_cart(args);\r\n\t\t\tbreak;\r\n\t\t\tcase 'remove-group':\r\n\t\t\t\tremove_group_from_cart(args);\r\n\t\t\tbreak;\r\n\t\t\tcase 'applycoupon':\r\n\t\t\t\tapplycoupon_to_cart(args);\r\n\t\t\tbreak;\r\n\t\t\tcase 'removecoupon':\r\n\t\t\t\tremovecoupon_to_cart(args);\r\n\t\t\tbreak;\r\n\t\t\tcase 'empty':\r\n\t\t\t\tempty_cart();\r\n\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n}\r\n\r\nexport const variations = ( root ) => {\r\n\t$(root).on('click', (e) => {\r\n\t\te.preventDefault();\r\n\t\tvar args = get_attributes(root);\r\n\t\targs.tptandc = $(root).data('tptandc');\r\n\t\targs.isloggedin = $(root).data('isloggedin');\r\n\t\targs.programid = $(root).data('programid');\r\n\t\tlet selector = '[data-action=\"'+args['parent']+'\"]';\r\n\t\t//alert(selector);\r\n\t\tlet buttons = get_variation_buttons('[data-type=\"'+args['type']+'\"]');\r\n\t\t\r\n\t\tif(args['checkout']){\r\n\t\t\tif(args.isloggedin==false){\r\n\t\t\t\t\tModalFactory.create({type: ModalLogin.TYPE}, $(e.currentTarget)); \r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t\r\n\t\t\t\t\tif(args.tptandc==1)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconst title = getString('tptandc', 'local_trainingprogram');\r\n\t\t\t\t\t\t\tconst form = new ModalForm({\r\n\t\t\t\t\t\t\tformClass: 'local_trainingprogram\\\\form\\\\termsandconditions',\r\n\t\t\t\t\t\t\targs: {programid:args.programid},\r\n\t\t\t\t\t\t\tmodalConfig: {title},\r\n\t\t\t\t\t\t\tsaveButtonText: getString('confirm', 'local_trainingprogram'),\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tform.addEventListener(form.events.FORM_SUBMITTED, (event) => {\r\n\t\t\t\t\t\t\tconst data = event.detail;\r\n\t\t\t\t\t\t\tif(data.tptandc > 0) {\r\n\t\t\t\t\t\t\t$(selector).data('variation', args['variation']);\r\n\t\t\t\t\t\t\t$(selector).prop('disabled', true);\t\r\n\t\t\t\t\t\t\targs.tptandc = 0;\r\n\t\t\t\t\t\t\tvar selectedString  = getString('selected' ,'tool_product');\r\n\t\t\t\t\t\t\tselectedString.done(function(html, js){\r\n\t\t\t\t\t\t\t\t$(root).text(html);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t$(\"[data-action='\"+args['parent']+\"']\").trigger('click');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif(args.tptandc == 1){\r\n\t\t\t\t\t\t\tform.show();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$(selector).data('variation', args['variation']);\r\n\t\t\t\t\t\t\t$(selector).prop('disabled', false);\t\r\n\t\t\t\t\t\t\tvar selectedString  = getString('selected' ,'tool_product');\r\n\t\t\t\t\t\t\tselectedString.done(function(html, js){\r\n\t\t\t\t\t\t\t\t$(root).text(html);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t$(\"[data-action='\"+args['parent']+\"']\").trigger('click');\r\n\t\t\t\t\t}\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\nexport const make_payment = (root) => {\r\n\t$(root).on('click', (e) => {\r\n\t\te.preventDefault();\r\n\t\te.stopImmediatePropagation();\r\n\t\t$(e.target).attr('disabled', true);\r\n\t\tlet method = $('[name=payment-method]:checked').val();\r\n\t\tlet products = $(root).data('summary');\r\n\r\n\t\tif(typeof method === 'undefined'){\r\n\t\t\tprocess_creditcard_payments(root, products);\r\n\t\t}\r\n\r\n\t\tswitch(method){\r\n\t\t\tcase 'postpaid':\r\n\t\t\t\tprocess_postpaid_payments(root, products);\r\n\t\t\tbreak;\r\n\t\t\tcase 'prepaid':\r\n\t\t\t\tprocess_prepaid_payments(root, products);\r\n\t\t\tbreak;\r\n\t\t\tcase 'telr':\r\n\t\t\tcase 'default':\r\n\t\t\t\tprocess_creditcard_payments(root, products);\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\t});\r\n}\r\nexport const paymentsinit = () => {\r\n    document.addEventListener('click', function(e) {\r\n \r\n        let paymentsupdate = e.target.closest(Selectors.actions.paymentsupdate);\r\n        if (paymentsupdate) {\r\n            e.preventDefault();\r\n            const title = getString('paymentsupdatedtls', 'tool_product',paymentsupdate.getAttribute('data-name'));\r\n            const form = new ModalForm({\r\n                formClass: 'tool_product\\\\form\\\\paymentsupdateform',\r\n                args: {id: paymentsupdate.getAttribute('data-id')},\r\n                modalConfig: {title},\r\n                returnFocus: paymentsupdate,\r\n            });\r\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\r\n            form.show();\r\n        }\r\n\r\n        let sendemailtoorgofficial = e.target.closest(Selectors.actions.sendemailtoorgofficial);\r\n        if (sendemailtoorgofficial) {\r\n        \t\r\n            e.preventDefault();\r\n            const title = getString('sendemailtoorgofficial', 'tool_product',sendemailtoorgofficial.getAttribute('data-orgoffcialname'));\r\n            const form = new ModalForm({\r\n                formClass: 'tool_product\\\\form\\\\sendemailform',\r\n                args: {productid:sendemailtoorgofficial.getAttribute('data-productid')},\r\n                modalConfig: {title},\r\n                returnFocus: sendemailtoorgofficial,\r\n            });\r\n            form.addEventListener(form.events.FORM_SUBMITTED, () => window.location.reload());\r\n            form.show();\r\n\r\n        }\r\n        \r\n        let approvalseats = e.target.closest(Selectors.actions.approvalseats);\r\n        if (approvalseats) {\r\n            e.preventDefault();\r\n\t\t\te.stopPropagation();\r\n\t\t\tapprovalid = approvalseats.getAttribute('data-id');\r\n            ModalFactory.create({\r\n                title: getString('approveorder', 'tool_product'),\r\n                type: ModalFactory.types.SAVE_CANCEL,\r\n                body: getString('approveorderconfirm', 'tool_product')\r\n            }).done(function(modal) {\r\n                this.modal = modal;\r\n\t\t\t\t//$(modal.getRoot()).attr('data-backdrop','static').attr('data-keyboard',false);\r\n                modal.setSaveButtonText(getString('approve', 'tool_product'));\r\n                modal.getRoot().on(ModalEvents.save, function(e) {\r\n                    e.preventDefault();\r\n\t\t\t\t\tTemplates.renderForPromise('tool_product/loader', {}).then(({html, js}) => {\r\n                        Templates.appendNodeContents('.modal-content', html, js);\r\n                    });\r\n\t\t\t\t\t$(e.currentTarget).find('button[data-action=\"save\"]').attr('disabled', true);\r\n                    var params = {};\r\n                    params.orderid = approvalid;\r\n                    var promise = Ajax.call([{\r\n                        methodname: 'tool_product_get_orderinfo',\r\n                        args: params\r\n                    }]);\r\n                    promise[0].done(function(resp) {\r\n                        if (resp) {\r\n\t\t\t\t\t\t\tif(resp.seatsinfo) {\r\n\t\t\t\t\t\t\t\tlet parsed_data = JSON.parse(resp.seatsinfo);\r\n\t\t\t\t\t\t\t\tif(parsed_data.seatnotexist) {\r\n\t\t\t\t\t\t\t\t\tlet seats = getString('userscountismore', 'local_exams', parsed_data.availableseats);\r\n\t\t\t\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\t\t\t\tmodal.hide();\r\n\t\t\t\t\t\t\t\t\thomepage.confirmbox(seats);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tlet promises = Ajax.call([{\r\n\t\t\t\t\t\t\t\t\tmethodname: 'tool_product_generate_sadadbill',\r\n\t\t\t\t\t\t\t\t\targs: {\r\n\t\t\t\t\t\t\t\t\t\tproducts: resp.info\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}]);\r\n\t\t\t\t\t\t\t\trender_template('tool_product/loader');\r\n\t\t\t\t\t\t\t\tpromises[0].done((response) => {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = response.returnurl;\r\n\t\t\t\t\t\t\t\t}).fail( (error) => {\r\n\t\t\t\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\t\t\t\thomepage.confirmbox(error.message);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n                        }\r\n                    }).fail( (error) => {\r\n\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\thomepage.confirmbox(error.message);\r\n\t\t\t\t\t});\r\n                }.bind(this));\r\n                modal.show();\r\n            }.bind(this));\r\n        }\r\n        let cancelorder = e.target.closest(Selectors.actions.cancelorder);\r\n        if (cancelorder) {\r\n            e.preventDefault();\r\n\t\t\tapprovalid = cancelorder.getAttribute('data-id');\r\n            ModalFactory.create({\r\n                title: getString('rejectorder', 'tool_product'),\r\n                type: ModalFactory.types.SAVE_CANCEL,\r\n                body: getString('rejectorderconfirm', 'tool_product')\r\n            }).done(function(modal) {\r\n                this.modal = modal;\r\n                modal.setSaveButtonText(getString('reject', 'tool_product'));\r\n                modal.getRoot().on(ModalEvents.save, function(e) {\r\n                    e.preventDefault();\r\n                    Templates.renderForPromise('tool_product/loader', {}).then(({html, js}) => {\r\n                        Templates.appendNodeContents('.modal-content', html, js);\r\n                    });\r\n                    var params = {};\r\n                    params.orderid = approvalid;\r\n                    var promise = Ajax.call([{\r\n                        methodname: 'tool_product_rejectorder',\r\n                        args: params\r\n                    }]);\r\n                    promise[0].done(function(resp) {\r\n\t\t\t\t\t\tconsole.log(resp.response);\r\n\t\t\t\t\t\tif(resp.response == 'success') {\r\n\t\t\t\t\t\t\tmodal.hide();\r\n\t\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\t\thomepage.confirmbox(getString('ordercancelled', 'tool_product'));\r\n\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\twindow.location = M.cfg.wwwroot + '/admin/tool/product/orderapproval.php';\r\n\t\t\t\t\t\t\t},4000);\r\n                        } else {\r\n\t\t\t\t\t\t\tmodal.hide();\r\n\t\t\t\t\t\t\tlet homepage = new HomePageJs();\r\n\t\t\t\t\t\t\thomepage.confirmbox(resp.response);\r\n\t\t\t\t\t\t}\r\n                    }).fail( (error) => {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t});\r\n                }.bind(this));\r\n                modal.show();\r\n            }.bind(this));\r\n        }\r\n    });\r\n};\r\n\r\nexport const grouped_products = ( root ) => {\r\n\t$(root).on('click', (e) => {\r\n\t\te.preventDefault();\r\n\t\tvar args = get_attributes($(root));\t\r\n\t\tif(args['grouped']){\r\n\t\t\tvar radios = $('#user_assign_entities :radio');\r\n    \t\tvar values = {};\r\n    \t\tradios.each(function() {\r\n    \t\t\tvalues[this.name] = $(this).val();\r\n            });\r\n            Object.entries(values).forEach( function(value, index) {\r\n            \targs['product'] = value[1];\r\n            \tadd_to_cart(args, false);\r\n            });\r\n            let products = get_products();\r\n            render_template('tool_product/cart/go-to-cart', $(root).parent(), {isloggedin: args['loggedin'], checkout: args['checkout']});\r\n        }\r\n\t});\r\n};\r\n\r\nexport const reset_cart = () => {\r\n\tempty_cart();\r\n}\r\n\r\nexport default { add, cart, checkout, variations, cart_actions, make_payment,paymentsinit,add_order_seats,addregister, grouped_products,add_learningtrack_order_seats,addprogramregister, reset_cart};\r\n"],"names":["Selectors","paymentsupdate","approvalseats","sendemailtoorgofficial","cancelorder","get_attributes","selector","data","product_has_variations","args","get_product_id","set_product","products","localStorage","setItem","JSON","stringify","get_products","getItem","parse","get_productformdata","productformdata","set_coupons","coupons","get_coupons","filter","Boolean","exists_in_coupon","couponcode","findIndex","x","get_product_information","Ajax","call","methodname","done","response","render_cart_page","fail","error","HomePageJs","confirmbox","productscount","html","length","add_to_cart","parent","incart","exists_in_cart","variation","product","grouped","hasvariations","quantity","category","language","hallscheduleid","profileid","processtype","tandcconfirm","push","render_template","isloggedin","checkout","remove_from_cart","refresh","index","splice","couponexist","empty_cart","removeItem","get_checkout_summary","formdata","set_productformdata","render_checkout_page","summary","productdata","empty","render_paymentsummary_page","coupondiscounfailed","formatted_response","format_cart_response","result","items","elements","i","group","get_group_title","tracks","get_grouped_items","id","template","params","append","renderForPromise","then","js","appendNodeContents","loader","isloading","remove","get_variation_buttons","each","key","value","text","process_creditcard_payments","root","promise","noseats","productname","create","title","type","ModalFactory","types","SAVE_CANCEL","body","modal","setSaveButtonText","getRoot","on","ModalEvents","save","e","preventDefault","window","location","reload","bind","this","show","href","returnurl","message","add","loggedin","tandc","undefined","ModalLogin","TYPE","currentTarget","form","ModalForm","formClass","examid","modalConfig","saveButtonText","addEventListener","events","FORM_SUBMITTED","event","detail","find","attr","product_id","hallscheduelid","homepage","success","M","cfg","wwwroot","messages","addprogramregister","tptandc","programid","prop","trigger","addregister","targetparent","add_order_seats","seatsdata","productid","autoapproval","returnparams","orderid","paymentid","resp","promises","info","add_learningtrack_order_seats","render","product_attributes","returnurlbtn","runTemplateJS","always","cart","cart_actions","remove_group_from_cart","val","couponindex","couponvalid","couponmsg","couponincart","productsdata","couponid","roles","couponcodedata","applycoupon_to_cart","removecoupon_to_cart","variations","make_payment","stopImmediatePropagation","target","method","process_postpaid_payments","process_prepaid_payments","paymentsinit","document","closest","getAttribute","returnFocus","stopPropagation","approvalid","seatsinfo","parsed_data","seatnotexist","seats","availableseats","hide","console","log","setTimeout","grouped_products","radios","values","name","Object","entries","forEach","reset_cart"],"mappings":"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"}