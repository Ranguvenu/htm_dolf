/**
 * User selector form on modal based on form-potential-user-selector 2016 Damyon Wiese.
 *
 * @module     tool_certificate/form-potential-user-selector
 * @copyright  2018 David Matamoros <davidmc@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_certificate/form-potential-user-selector",["jquery","core/ajax","core/templates","core/str","core/notification"],(function($,Ajax,Templates,Str,Notification){return{processResults:function(selector,results){var users=[];return $.isArray(results)?($.each(results,(function(index,user){users.push({value:user.id,label:user._label})})),users):results},transport:function(selector,query,success,failure){var params={},tempid=$(selector).data("itemid");0==tempid&&(tempid=document.getElementById("cer_templates").value,document.querySelector('input[name="tid"]').value=tempid);var isexams=document.getElementsByName("examlist"),selectedexam=0;isexams.length>0&&(selectedexam=isexams[0].value),tempid?isexams.length>0&&!selectedexam?Notification.alert("Missing Exam","Please select a exam first!","OK"):(params.search=query,params.itemid=tempid,selectedexam&&(params.examid=selectedexam),Ajax.call([{methodname:"tool_certificate_potential_users_selector",args:params}])[0].then((function(results){var promises=[],i=0;return results.length<=100?($.each(results,(function(index,user){var ctx=user,identity=[];$.each(["idnumber","email","phone1","phone2","department","institution"],(function(i,k){void 0!==user[k]&&""!==user[k]&&(ctx.hasidentity=!0,identity.push(user[k]))})),ctx.identity=identity.join(", "),promises.push(Templates.render("tool_certificate/form-user-selector-suggestion",ctx))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,user){user._label=args[i],i++})),success(results)}))):Str.get_string("toomanyuserstoshow","core",">100").then((function(toomanyuserstoshow){success(toomanyuserstoshow)}))})).fail(failure)):Notification.alert("Missing Template","Please select a template first!","OK")}}}));

//# sourceMappingURL=form-potential-user-selector.min.js.map
