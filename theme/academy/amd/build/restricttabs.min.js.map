{"version":3,"file":"restricttabs.min.js","sources":["../src/restricttabs.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport cfg from 'core/config';\nimport {get_string as getString} from 'core/str';\nimport Notification from 'core/notification';\nimport $ from 'jquery';\nconst Selectors = {\n\tactions: {\n\t\tcourseSettings: '[data-key=\"editsettings\"]',\n\t\tcoursereuse: '[data-key=\"coursereuse\"]',\n\t\tSECTIONACTIONMENU: '[class=\"section_action_menu ml-auto\"]',\n\t\tModuleActionOptions: '[class=\"cm_action_menu actions\"]',\n\t\taddSection: '[data-action=\"addSection\"]',\n\t\thide: '[data-action=\"hide\"]',\n\t\tdeleteSection: '[data-action=\"deleteSection\"]',\n\t\tshowmodules: '[data-action=\"show\"]',\n\t\tassignrolesonmoduleoption: '[data-action=\"assignroles\"]',\n\t\tapprove: '[data-action=\"approve\"]',\n\t\treject: '[data-action=\"reject\"]',\n\t}\n}\n\nexport const init = () => {\n\tconst body = document.getElementsByTagName('body');\n\tconst settings = document.querySelector(Selectors.actions.courseSettings);\n\tconst coursereuse = document.querySelector(Selectors.actions.coursereuse);\n\tconst sectionActionMenue = document.querySelectorAll(Selectors.actions.SECTIONACTIONMENU);\n\tconst moduleActionOptions = document.querySelectorAll(Selectors.actions.ModuleActionOptions);\n\tconst addSection = document.querySelector(Selectors.actions.addSection);\n\tconst hide = document.querySelectorAll(Selectors.actions.hide);\n\tconst deleteSection = document.querySelectorAll(Selectors.actions.deleteSection);\n\tconst showmodules = document.querySelectorAll(Selectors.actions.showmodules);\n\tconst assignrolesonmoduleoption = document.querySelectorAll(Selectors.actions.assignrolesonmoduleoption);\n\t\n\n\tfunction hide_edit_option() {\n\t\t$('.fa-pencil').css('display', 'none');\n\t\tvar editoptions = document.querySelectorAll('.fa-pencil');\n\t\tfor (var i = 0; i < editoptions.length; i++) {\n\t\t\t// editoptions[i].style.display = 'none';\n\t\t\teditoptions[i].remove();\n\t\t}\n\t\tif (settings !== undefined) {\n\t\t\tsettings.remove();\n\t\t}\n\t\tif (coursereuse !== undefined) {\n\t\t\tcoursereuse.remove();\n\t\t}\n\t\tfor (var i = 0; i < hide.length; i++) {\n\t\t\thide[i].remove();\n\t\t}\n\t\tfor (var i = 0; i < deleteSection.length; i++) {\n\t\t\tdeleteSection[i].remove();\n\t\t}\n\t\tfor (var i = 0; i < showmodules.length; i++) {\n\t\t\tshowmodules[i].remove();\n\t\t}\n\t\tfor (var i = 0; i < assignrolesonmoduleoption.length; i++) {\n\t\t\tassignrolesonmoduleoption[i].remove();\n\t\t}\n\t}\n\t\n\n\tvar id = body[0].id;\n\tvar idarr = id.split(\"-\");\n\tlet iscoursePage = idarr[0] + '-' + idarr[1] + '-' + idarr[2];\n\tif (iscoursePage == 'page-course-view') {\n\t\tconst currentUser = document.querySelector('.user_role');\n\t\tconst role = currentUser.getAttribute('data-role');\n\t\t// console.log('Current user role: ' + role);\n\t\tif (role == 'editingtrainer') {\n\t\t\thide_edit_option();\n\t\t}\n\t}\n\tfunction approve_or_reject_activity(params){\n\t\tvar confrmstring;\n\t\tif (params.status == 'approve') {\n\t\t\tconfrmstring = getString('confirmapprove', 'local_trainingprogram');\n\t\t}else if(params.status == 'reject'){\n\t\t\tconfrmstring = getString('confirmreject', 'local_trainingprogram');\n\t\t}\n\t\tif (confrmstring) {\n\t\t\tModalFactory.create({\n                title: getString('confirm', 'local_trainingprogram'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: confrmstring\n            }).done(function(modal) {\n                this.modal = modal;\n                modal.setSaveButtonText(getString('yes'));\n                modal.getRoot().on(ModalEvents.save, function(e) {\n\t\t\t\t\tpromise = Ajax.call([{\n\t\t\t\t\t\tmethodname: 'local_trainingprogram_activity_approoved',\n\t\t                args: params\n\t\t\t\t\t}]);\n\t\t\t\t\tpromise[0].done(function(resp) {\n\t\t\t\t\t\tif (resp.status == true) {\n\t\t\t\t\t        window.location.reload();\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tvar error = getString('error');\n\t\t                    var message = getString('approvefailed', 'local_trainingprogram');\n\t\t                    var ok = getString('ok');\n\t\t\t\t\t\t\tNotification.alert(error, message, ok);\n\t\t\t\t\t\t}\n\t\t\t\t    }).fail(function(exception) {\n\t\t\t\t        console.log(exception);\n\t\t\t\t    });\n                }.bind(this));\n                modal.show();\n            }.bind(this));\n\t\t}\n\t}\n\tdocument.addEventListener('click', function(e){\n\t\tif (addSection) {\n\t\t\tconst currentUser = document.querySelector('.user_role');\n\t\t\tconst role = currentUser.getAttribute('data-role');\n\t\t\tif (role == 'editingtrainer') {\n\t\t\t\tsetInterval(hide_edit_option(), 1000);\n\t\t\t}\n\t\t}\n\t\tvar promise =[];\n\t\tvar params = {};\n\t\t// If activity is approved\n\t\tconst approve = e.target.closest(Selectors.actions.approve);\n\t\t// If activity is Rejected\n\t\tconst reject = e.target.closest(Selectors.actions.reject);\n\t\tif (approve) {\n\t\t\tlet cmid = approve.getAttribute('data-id');\n\t\t\tlet status = approve.getAttribute('data-action');\n\t\t\tparams.cmid  = cmid;\n\t\t\tparams.status  = status;\n            approve_or_reject_activity(params);\n\t\t}\n\t\tif (reject) {\n\t\t\tlet cmid = reject.getAttribute('data-id');\n\t\t\tlet status = reject.getAttribute('data-action');\n\t\t\tparams.cmid  = cmid;\n\t\t\tparams.status  = status;\n            approve_or_reject_activity(params);\n\t\t}\n\t});\n}"],"names":["Selectors","courseSettings","coursereuse","SECTIONACTIONMENU","ModuleActionOptions","addSection","hide","deleteSection","showmodules","assignrolesonmoduleoption","approve","reject","body","document","getElementsByTagName","settings","querySelector","querySelectorAll","hide_edit_option","css","editoptions","i","length","remove","undefined","idarr","id","split","getAttribute","approve_or_reject_activity","params","confrmstring","status","create","title","type","ModalFactory","types","SAVE_CANCEL","done","modal","setSaveButtonText","getRoot","on","ModalEvents","save","e","promise","Ajax","call","methodname","args","resp","window","location","reload","error","message","ok","alert","fail","exception","console","log","bind","this","show","addEventListener","setInterval","target","closest","cmid"],"mappings":"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"}